<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¢ÛŒÙ†Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡ X â€” Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² ØªØµÙ…ÛŒÙ…Ø§Øª 2030+</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg1: #0f2027; --bg2: #203a43; --bg3: #2c5364; --bg4: #1a1a2e;
    --glass: rgba(255,255,255,0.08);
    --border: rgba(255,255,255,0.16);
    --text: #f1f5ff; --muted: #b3bed6; --heading: #8f7cff;
    --accent: #7c5cff; --accent-2: #00d2a8; --warn: #ffcd4d; --bad: #ff6b6b;
    --chip-bg: rgba(255,255,255,0.08);
    --input-bg: rgba(0,0,0,0.3);
    --canvas-bg: rgba(0,0,0,0.25);
  }
  /* Light theme overrides */
  .light {
    --bg1: #f7f9fc; --bg2: #e7ecf5; --bg3: #dde6ff; --bg4: #ffffff;
    --glass: rgba(255,255,255,0.7);
    --border: rgba(0,0,0,0.08);
    --text: #0f172a; --muted: #475569; --heading: #5a3fff;
    --accent: #5a3fff; --accent-2: #089981; --warn: #eab308; --bad: #ef4444;
    --chip-bg: rgba(0,0,0,0.06);
    --input-bg: rgba(255,255,255,0.7);
    --canvas-bg: rgba(0,0,0,0.06);
  }

  * { box-sizing: border-box; }
  body {
    margin: 0; font-family: 'Vazirmatn', sans-serif; color: var(--text);
    background: linear-gradient(-45deg, var(--bg1), var(--bg2), var(--bg3), var(--bg4));
    background-size: 400% 400%; animation: gradientBG 18s ease infinite;
    overflow-x: hidden;
  }
  @keyframes gradientBG { 0% {background-position: 0% 50%} 50% {background-position: 100% 50%} 100% {background-position: 0% 50%} }

  /* 3D background canvases */
  canvas#bg, canvas#grid {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; pointer-events: none;
  }
  canvas#grid { z-index: -1; }

  header {
    position: sticky; top: 0; z-index: 5;
    display: flex; align-items: center; justify-content: space-between; gap: 12px;
    padding: 14px 20px; background: var(--glass); backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
  }
  .brand { display:flex; align-items:center; gap:10px; }
  .logo {
    width: 34px; height: 34px; border-radius: 10px;
    background: radial-gradient(120% 120% at 30% 30%, #fff2 0%, #0000 60%), linear-gradient(135deg, var(--accent), var(--accent-2));
    box-shadow: 0 4px 20px rgba(124,92,255,0.45);
  }
  h1 { font-size: 20px; margin: 0; color: var(--heading); }
  .sub { margin: 0; color: var(--muted); font-size: 12px; }

  .theme-toggle {
    display: inline-flex; align-items: center; gap: 8px; cursor: pointer;
    background: var(--chip-bg); border: 1px solid var(--border);
    padding: 8px 12px; border-radius: 999px; color: var(--text); user-select: none;
  }

  .container {
    max-width: 1200px; margin: 20px auto; padding: 0 16px;
    display: grid; gap: 20px;
    grid-template-columns: 1fr; 
  }
  @media (min-width: 980px) { .container { grid-template-columns: 380px 1fr; } }

  .card {
    background: var(--glass); border: 1px solid var(--border); border-radius: 16px;
    padding: 16px; backdrop-filter: blur(12px); box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    animation: fadeInUp 0.8s ease; 
  }
  .card h3 { margin: 0 0 10px; color: var(--heading); font-size: 16px; }

  label { font-size: 12px; color: var(--muted); margin-top: 10px; display: block; }
  input, select, textarea {
    width: 100%; padding: 10px; margin-top: 6px; border-radius: 10px; border: 1px solid var(--border);
    background: var(--input-bg); color: var(--text); outline: none; transition: border 0.2s;
  }
  input:focus, select:focus, textarea:focus { border-color: var(--accent); }

  .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
  .chip {
    padding: 6px 12px; border-radius: 20px; background: var(--chip-bg);
    border: 1px solid var(--border); font-size: 12px; cursor: pointer; transition: 0.25s;
  }
  .chip:hover { transform: translateY(-1px); }
  .chip.active { background: var(--accent); color: #fff; border-color: var(--accent); }

  .btns { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
  .btn {
    background: var(--accent); color: white; border: none; padding: 10px 14px; border-radius: 10px;
    cursor: pointer; font-weight: 600; transition: 0.25s;
  }
  .btn:hover { filter: brightness(1.05); transform: translateY(-1px); }
  .btn.secondary { background: transparent; color: var(--text); border: 1px solid var(--border); }

  .kpi { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin: 10px 0; }
  .k { background: var(--chip-bg); border: 1px solid var(--border); border-radius: 10px; padding: 8px; text-align: center; }
  .k .v { font-weight: 700; font-size: 18px; }
  .k .t { color: var(--muted); font-size: 11px; }

  canvas#radar { width: 100%; height: 280px; background: var(--canvas-bg); border-radius: 12px; }

  .mood-wrap { margin-top: 8px; }
  .mood-label { display:flex; justify-content:space-between; font-size: 12px; color: var(--muted); }
  .mood-bar {
    height: 10px; border-radius: 999px; margin-top: 6px;
    background: linear-gradient(90deg, #ff3b3b, #ffcd4d, #00d2a8);
    position: relative; overflow: hidden; border: 1px solid var(--border);
  }
  .mood-pointer {
    position: absolute; top: -4px; width: 2px; height: 18px; background: var(--text);
    box-shadow: 0 0 8px rgba(255,255,255,0.7);
  }

  .item { background: var(--chip-bg); border: 1px solid var(--border); border-radius: 10px; padding: 10px; margin-top: 8px; }
  .danger { color: var(--bad); } .ok { color: var(--accent-2); }

  /* SVG Timeline */
  .timeline-wrap { margin-top: 10px; }
  svg.timeline { width: 100%; height: 140px; background: var(--canvas-bg); border-radius: 12px; }
  .tl-label { font-size: 11px; fill: var(--text); opacity: 0.85; }
  .tl-year { font-size: 10px; fill: var(--muted); }
  .tl-dot { filter: drop-shadow(0 0 6px rgba(124,92,255,0.7)); }

  /* Quote */
  .quote { font-size: 13px; color: var(--muted); margin-top: 10px; border-right: 3px solid var(--accent); padding-right: 10px; }

  @keyframes fadeInUp { from {opacity:0; transform: translateY(16px)} to {opacity:1; transform: translateY(0)} }
</style>
</head>
<body>

<canvas id="bg"></canvas>
<canvas id="grid"></canvas>

<header>
  <div class="brand">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>Ø¢ÛŒÙ†Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡ X</h1>
      <p class="sub">ØªØµÙ…ÛŒÙ…â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²Øª + Ø±ÙˆÙ†Ø¯Ù‡Ø§ÛŒ Ø¬Ù‡Ø§Ù†ÛŒ = Ø¢ÛŒÙ†Ø¯Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒ Ùˆ Ù…ÛŒâ€ŒØ³Ø§Ø²ÛŒ</p>
    </div>
  </div>
  <div class="theme-toggle" id="themeToggle" role="button" aria-label="ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ø±Ù†Ú¯">
    <span id="themeIcon">ğŸŒ™</span><span id="themeText">Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©</span>
  </div>
</header>

<div class="container">
  <!-- Sidebar -->
  <div class="card" id="sidebar">
    <h3>Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ùˆ ØªØµÙ…ÛŒÙ…</h3>

    <label>Ø³Ù†</label>
    <input id="age" type="number" min="12" max="90" placeholder="Ù…Ø«Ù„Ø§Ù‹ 24">

    <label>Ø´Ù‡Ø±/Ú©Ø´ÙˆØ±</label>
    <input id="location" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ ØªØ¨Ø±ÛŒØ²ØŒ Ø§ÛŒØ±Ø§Ù†">

    <label>Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§</label>
    <input id="skills" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ JavaScript, Ø·Ø±Ø§Ø­ÛŒ Ù…Ø­ØµÙˆÙ„, Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ">

    <label>ØªØ­Ù…Ù„ Ø±ÛŒØ³Ú©</label>
    <select id="risk">
      <option value="low">Ù¾Ø§ÛŒÛŒÙ†</option>
      <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
      <option value="high">Ø¨Ø§Ù„Ø§</option>
    </select>

    <label>Ù‡Ø¯Ù Ø§ØµÙ„ÛŒ ØªØ§ 2030</label>
    <select id="goal">
      <option value="career">Ø¬Ù‡Ø´ Ø´ØºÙ„ÛŒ</option>
      <option value="wealth">Ø«Ø±ÙˆØª Ùˆ Ø³Ø±Ù…Ø§ÛŒÙ‡</option>
      <option value="wellbeing">Ø³Ù„Ø§Ù…Øª Ùˆ Ø±ÙØ§Ù‡</option>
      <option value="sustainability">Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ùˆ Ø§Ø«Ø± Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ</option>
      <option value="resilience">ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ Ùˆ Ø§Ø³ØªÙ‚Ù„Ø§Ù„</option>
    </select>

    <label style="margin-top:12px;">Ù†ÙˆØ¹ ØªØµÙ…ÛŒÙ…</label>
    <div class="chips" id="decisions">
      <div class="chip active" data-id="startup">Ø§Ø³ØªØ§Ø±ØªØ§Ù¾</div>
      <div class="chip" data-id="study">ØªØ­ØµÛŒÙ„</div>
      <div class="chip" data-id="immigrate">Ù…Ù‡Ø§Ø¬Ø±Øª</div>
      <div class="chip" data-id="invest">Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</div>
      <div class="chip" data-id="switch">ØªØºÛŒÛŒØ± Ø´ØºÙ„</div>
    </div>

    <label style="margin-top:12px;">Ø±ÙˆÙ†Ø¯Ù‡Ø§ÛŒ Ø¬Ù‡Ø§Ù†ÛŒ</label>
    <div class="chips" id="trends">
      <div class="chip active" data-id="AI">Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</div>
      <div class="chip active" data-id="Climate">Ø§Ù‚Ù„ÛŒÙ… Ùˆ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ</div>
      <div class="chip" data-id="Geo">Ú˜Ø¦ÙˆÙ¾Ù„ÛŒØªÛŒÚ©</div>
      <div class="chip" data-id="Urban">Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</div>
      <div class="chip" data-id="Demography">Ø¬Ù…Ø¹ÛŒØª Ùˆ Ø³Ø§Ù„Ù…Ù†Ø¯ÛŒ</div>
      <div class="chip" data-id="Culture">Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„</div>
    </div>

    <div class="btns">
      <button class="btn" id="simulate">Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ</button>
      <button class="btn secondary" id="save">Ø°Ø®ÛŒØ±Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆ</button>
      <button class="btn secondary" id="load">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</button>
    </div>

    <div class="quote" id="quote"></div>
  </div>

  <!-- Main -->
  <div class="card">
    <h3>Ù†ØªØ§ÛŒØ¬ Ø³Ù†Ø§Ø±ÛŒÙˆ</h3>

    <div class="kpi">
      <div class="k"><div class="v" id="k-career">â€“</div><div class="t">Ø´ØºÙ„/Ù…Ù‡Ø§Ø±Øª</div></div>
      <div class="k"><div class="v" id="k-wealth">â€“</div><div class="t">Ø«Ø±ÙˆØª/Ø³Ø±Ù…Ø§ÛŒÙ‡</div></div>
      <div class="k"><div class="v" id="k-wellbeing">â€“</div><div class="t">Ø±ÙØ§Ù‡/Ø³Ù„Ø§Ù…Øª</div></div>
      <div class="k"><div class="v" id="k-sustainability">â€“</div><div class="t">Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ</div></div>
      <div class="k"><div class="v" id="k-resilience">â€“</div><div class="t">ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ</div></div>
    </div>

    <canvas id="radar" width="700" height="320"></canvas>

    <div class="mood-wrap">
      <div class="mood-label"><span>Ø±ÛŒØ³Ú© Ø¨Ø§Ù„Ø§</span><span>Ø¢ÛŒÙ†Ø¯Ù‡ Ø§Ù…ÛŒØ¯ÙˆØ§Ø±Ú©Ù†Ù†Ø¯Ù‡</span></div>
      <div class="mood-bar" id="mood"><div class="mood-pointer" id="moodPtr" style="left:50%"></div></div>
    </div>

    <div class="item" id="narrative" style="margin-top:12px;">Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø³Ù†Ø§Ø±ÛŒÙˆ Ø±Ø§ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ù†.</div>

    <h3 style="margin-top:16px;">Ø±ÛŒØ³Ú©â€ŒÙ‡Ø§ Ùˆ ÙØ±ØµØªâ€ŒÙ‡Ø§</h3>
    <div id="risksOps"></div>

    <h3 style="margin-top:16px;">ØªØ§ÛŒÙ…â€ŒÙ„Ø§ÛŒÙ† Ø§Ø­ØªÙ…Ø§Ù„ÛŒ 2025â€“2032</h3>
    <div class="timeline-wrap">
      <svg class="timeline" id="timeline" viewBox="0 0 800 140" preserveAspectRatio="none">
        <!-- Path and nodes will be generated by JS -->
      </svg>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
  // Theme handling
  const root = document.documentElement;
  const savedTheme = localStorage.getItem('fx_theme') || 'dark';
  if (savedTheme === 'light') document.body.classList.add('light');
  document.getElementById('themeIcon').textContent = document.body.classList.contains('light') ? 'ğŸŒ' : 'ğŸŒ™';
  document.getElementById('themeText').textContent = document.body.classList.contains('light') ? 'Ø­Ø§Ù„Øª Ø±ÙˆØ´Ù†' : 'Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©';
  document.getElementById('themeToggle').addEventListener('click', () => {
    document.body.classList.toggle('light');
    const isLight = document.body.classList.contains('light');
    localStorage.setItem('fx_theme', isLight ? 'light' : 'dark');
    document.getElementById('themeIcon').textContent = isLight ? 'ğŸŒ' : 'ğŸŒ™';
    document.getElementById('themeText').textContent = isLight ? 'Ø­Ø§Ù„Øª Ø±ÙˆØ´Ù†' : 'Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©';
  });

  // Motivational quotes (future-centric)
  const QUOTES = [
    "Ø¢ÛŒÙ†Ø¯Ù‡ Ú†ÛŒØ²ÛŒ Ù†ÛŒØ³Øª Ú©Ù‡ ÙˆØ§Ø±Ø¯Ø´ Ù…ÛŒâ€ŒØ´ÙˆÛŒÙ…Ø› Ú†ÛŒØ²ÛŒ Ø§Ø³Øª Ú©Ù‡ Ù…ÛŒâ€ŒØ³Ø§Ø²ÛŒÙ….",
    "ØªØ±Ù†Ø¯Ù‡Ø§ Ø¬Ù‡Øª Ø¨Ø§Ø¯Ù†Ø¯Ø› Ø¨Ø§Ø¯Ø¨Ø§Ù†Øª Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ØŒ Ù†Ù‡ Ø§ÛŒÙ†Ú©Ù‡ Ù…Ù†ØªØ¸Ø± Ø¢Ø±Ø§Ù…Ø´ Ø¯Ø±ÛŒØ§ Ø¨Ø§Ø´ÛŒ.",
    "ØªÙˆØ§Ù†Ø§ÛŒÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø³Ø±ÛŒØ¹ØŒ Ø³ÙˆØ®Øª Ø§ØµÙ„ÛŒ Ù…Ø²ÛŒØª Ø±Ù‚Ø§Ø¨ØªÛŒ ØªÙˆØ³Øª.",
    "Ù‡Ø± ØªØµÙ…ÛŒÙ… Ú©ÙˆÚ†Ú© Ø§Ù…Ø±ÙˆØ²ØŒ Ø§Ù‡Ø±Ù…ÛŒ Ø¨Ø±Ø§ÛŒ ÙØ±Ø¯Ø§ÛŒ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø§Ø³Øª.",
    "Ø´Ø¬Ø§Ø¹ØªØŒ Ù…ÛŒØ§Ù†â€ŒØ¨Ø±Ù Ø¹Ø¨ÙˆØ± Ø§Ø² Ø¹Ø¯Ù… Ù‚Ø·Ø¹ÛŒØª Ø§Ø³Øª."
  ];
  function setQuote() {
    const q = QUOTES[Math.floor(Math.random() * QUOTES.length)];
    document.getElementById('quote').textContent = "Â«" + q + "Â»";
  }
  setQuote();

  // Three.js starfield background
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.z = 6;
  const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg'), alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  const starGeo = new THREE.SphereGeometry(0.04, 12, 12);
  const starMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
  const stars = [];
  for (let i = 0; i < 400; i++) {
    const s = new THREE.Mesh(starGeo, starMat);
    s.position.set(
      THREE.MathUtils.randFloatSpread(100),
      THREE.MathUtils.randFloatSpread(100),
      THREE.MathUtils.randFloatSpread(100)
    );
    scene.add(s); stars.push(s);
  }
  // Subtle movement
  function animateBg() {
    requestAnimationFrame(animateBg);
    stars.forEach(st => { st.rotation.x += 0.001; st.rotation.y += 0.001; });
    renderer.render(scene, camera);
  }
  animateBg();
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });

  // Neon grid canvas background
  const grid = document.getElementById('grid');
  const gctx = grid.getContext('2d');
  function resizeGrid() { grid.width = window.innerWidth; grid.height = window.innerHeight; }
  resizeGrid(); window.addEventListener('resize', resizeGrid);
  function drawGrid(t = 0) {
    gctx.clearRect(0,0,grid.width, grid.height);
    const spacing = 50, speed = 0.02;
    gctx.strokeStyle = 'rgba(124,92,255,0.18)';
    gctx.lineWidth = 1;
    const offset = (t * speed) % spacing;
    // verticals
    for (let x = -spacing; x < grid.width + spacing; x += spacing) {
      gctx.beginPath(); gctx.moveTo(x + offset, 0); gctx.lineTo(x + offset, grid.height); gctx.stroke();
    }
    // horizontals
    for (let y = -spacing; y < grid.height + spacing; y += spacing) {
      gctx.beginPath(); gctx.moveTo(0, y + offset); gctx.lineTo(grid.width, y + offset); gctx.stroke();
    }
    requestAnimationFrame(drawGrid);
  }
  requestAnimationFrame(drawGrid);

  // Data model
  const MEGATRENDS = {
    AI: { impact: { career: 0.9, wealth: 0.7, wellbeing: 0.3, sustainability: 0.4, resilience: 0.5 },
          risks: ["Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ø´ØºÙ„ÛŒ", "Ø´Ú©Ø§Ù Ù…Ù‡Ø§Ø±ØªÛŒ"], ops: ["Ø§ÙØ²Ø§ÛŒØ´ Ø¨Ù‡Ø±Ù‡â€ŒÙˆØ±ÛŒ", "Ø®Ù„Ù‚ Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ù†Ùˆ"] },
    Climate: { impact: { career: 0.5, wealth: 0.6, wellbeing: 0.6, sustainability: 0.95, resilience: 0.7 },
          risks: ["Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ù†Ø·Ø¨Ø§Ù‚", "Ø§Ø®ØªÙ„Ø§Ù„ Ø²Ù†Ø¬ÛŒØ±Ù‡"], ops: ["Ø¨Ø§Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø³Ø¨Ø²", "Ù†ÙˆØ¢ÙˆØ±ÛŒ Ø§Ù†Ø±Ú˜ÛŒ"] },
    Geo: { impact: { career: 0.4, wealth: 0.5, wellbeing: 0.3, sustainability: 0.3, resilience: 0.9 },
          risks: ["Ù†ÙˆØ³Ø§Ù† Ú˜Ø¦ÙˆÙ¾Ù„ÛŒØªÛŒÚ©"], ops: ["ØªÙ†ÙˆØ¹â€ŒØ¨Ø®Ø´ÛŒ Ùˆ Ø¨ÙˆÙ…ÛŒâ€ŒØ³Ø§Ø²ÛŒ"] },
    Urban: { impact: { career: 0.6, wealth: 0.5, wellbeing: 0.7, sustainability: 0.6, resilience: 0.5 },
          risks: ["ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ø²ÛŒØ±Ø³Ø§Ø®ØªÛŒ"], ops: ["Ø®Ø¯Ù…Ø§Øª Ø´Ù‡Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯"] },
    Demography: { impact: { career: 0.5, wealth: 0.4, wellbeing: 0.8, sustainability: 0.3, resilience: 0.6 },
          risks: ["ÙØ´Ø§Ø± Ø±ÙØ§Ù‡ÛŒ"], ops: ["Ø¨Ø§Ø²Ø§Ø± Ø³Ù„Ø§Ù…Øª Ùˆ Ù…Ø±Ø§Ù‚Ø¨Øª"] },
    Culture: { impact: { career: 0.7, wealth: 0.6, wellbeing: 0.7, sustainability: 0.4, resilience: 0.6 },
          risks: ["ÙØ±Ø³ÙˆØ¯Ú¯ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„"], ops: ["Ø§Ù‚ØªØµØ§Ø¯ Ø®Ø§Ù„Ù‚Ø§Ù†ØŒ Ø±ÛŒÙ…ÙˆØª"] }
  };
  const DECISIONS = {
    study:   { career: 0.85, wealth: 0.45, wellbeing: 0.5,  sustainability: 0.4,  resilience: 0.6, verb: "ØªØ­ØµÛŒÙ„/Ù…Ù‡Ø§Ø±Øªâ€ŒØ¢Ù…ÙˆØ²ÛŒ" },
    immigrate:{career: 0.7,  wealth: 0.6,  wellbeing: 0.55, sustainability: 0.45, resilience: 0.7, verb: "Ù…Ù‡Ø§Ø¬Ø±Øª Ù‡Ø¯ÙÙ…Ù†Ø¯" },
    startup: { career: 0.8,  wealth: 0.8,  wellbeing: 0.45, sustainability: 0.55, resilience: 0.7, verb: "Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§Ø³ØªØ§Ø±ØªØ§Ù¾" },
    invest:  { career: 0.5,  wealth: 0.9,  wellbeing: 0.55, sustainability: 0.4,  resilience: 0.65, verb: "Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯" },
    switch:  { career: 0.75, wealth: 0.55, wellbeing: 0.6,  sustainability: 0.45, resilience: 0.7, verb: "ØªØºÛŒÛŒØ± Ø´ØºÙ„/Ø­ÙˆØ²Ù‡" }
  };
  const clamp01 = x => Math.max(0, Math.min(1, x));
  const pct = x => Math.round(clamp01(x) * 100);

  // Chips
  function wireChips(id, single=false) {
    const el = document.getElementById(id);
    el.addEventListener('click', (e) => {
      const chip = e.target.closest('.chip'); if (!chip) return;
      if (single) { [...el.children].forEach(c=>c.classList.remove('active')); chip.classList.add('active'); }
      else chip.classList.toggle('active');
    });
  }
  wireChips('decisions', true); wireChips('trends');

  // Radar chart
  function drawRadar(canvas, values) {
    const ctx = canvas.getContext('2d'); const W = canvas.width, H = canvas.height;
    ctx.clearRect(0,0,W,H);
    const cx = W/2, cy = H/2 + 10; const axes = [
      { key:'career', label:'Ø´ØºÙ„' }, { key:'wealth', label:'Ø«Ø±ÙˆØª' }, { key:'wellbeing', label:'Ø±ÙØ§Ù‡' },
      { key:'sustainability', label:'Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ' }, { key:'resilience', label:'ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ' }
    ];
    const R = Math.min(W,H)/2 - 40;
    // grid rings
    ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--border'); ctx.lineWidth = 1;
    for (let r=0.2; r<=1.0; r+=0.2) {
      ctx.beginPath();
      axes.forEach((a,i)=> {
        const ang = (Math.PI*2/axes.length)*i - Math.PI/2;
        const x = cx + Math.cos(ang)*R*r, y = cy + Math.sin(ang)*R*r;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }); ctx.closePath(); ctx.stroke();
    }
    // axes + labels
    ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--text'); ctx.globalAlpha = 0.85;
    ctx.font = '12px Vazirmatn, sans-serif';
    axes.forEach((a,i)=>{
      const ang = (Math.PI*2/axes.length)*i - Math.PI/2;
      const x = cx + Math.cos(ang)*(R+12), y = cy + Math.sin(ang)*(R+12);
      ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(cx + Math.cos(ang)*R, cy + Math.sin(ang)*R); ctx.stroke();
      ctx.textAlign = Math.cos(ang)>0.1 ? 'left' : (Math.cos(ang)<-0.1 ? 'right' : 'center');
      ctx.fillText(a.label, x, y);
    });
    ctx.globalAlpha = 1;
    // polygon
    ctx.beginPath();
    axes.forEach((a,i)=>{
      const v = clamp01(values[a.key]); const ang = (Math.PI*2/axes.length)*i - Math.PI/2;
      const x = cx + Math.cos(ang)*R*v, y = cy + Math.sin(ang)*R*v;
      if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    });
    ctx.closePath();
    // gradient fill
    const grad = ctx.createRadialGradient(cx, cy, 10, cx, cy, R);
    grad.addColorStop(0, 'rgba(124,92,255,0.35)'); grad.addColorStop(1, 'rgba(0,210,168,0.15)');
    ctx.fillStyle = grad; ctx.fill();
    ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--heading'); ctx.lineWidth = 2; ctx.stroke();
  }

  function getActiveKey(containerId) {
    const el = document.getElementById(containerId); const chip = el.querySelector('.chip.active');
    return chip ? chip.dataset.id : null;
  }
  function getActiveKeys(containerId) {
    return [...document.getElementById(containerId).querySelectorAll('.chip.active')].map(c=>c.dataset.id);
  }

  function score(profile, decisionKey, trendKeys) {
    const base = DECISIONS[decisionKey];
    const trendImpact = trendKeys.reduce((acc,k)=>{
      const imp = MEGATRENDS[k].impact; Object.keys(acc).forEach(d=> acc[d]+=imp[d]); return acc;
    }, { career:0, wealth:0, wellbeing:0, sustainability:0, resilience:0 });
    const n = Math.max(1, trendKeys.length);
    Object.keys(trendImpact).forEach(d=> trendImpact[d]/=n);
    const rMod = profile.risk==='high' ? 0.08 : profile.risk==='low' ? -0.05 : 0;
    const gBoost = { career:0, wealth:0, wellbeing:0, sustainability:0, resilience:0 }; gBoost[profile.goal]=0.1;
    const skills = (profile.skills || "").toLowerCase();
    const synergy = {
      AI: /ai|Ù‡ÙˆØ´|data|Ø¯ÛŒØªØ§/.test(skills) ? 0.08 : 0,
      Climate: /Ù…Ø­ÛŒØ·|energy|esg|Ø§Ù†Ø±Ú˜ÛŒ/.test(skills) ? 0.07 : 0,
      Geo: /supply|logistics|Ø²Ù†Ø¬ÛŒØ±Ù‡/.test(skills) ? 0.05 : 0,
      Urban: /iot|gis|mobility|Ø­Ù…Ù„/.test(skills) ? 0.05 : 0,
      Demography: /health|care|Ø³Ù„Ø§Ù…Øª/.test(skills) ? 0.06 : 0,
      Culture: /content|design|creator|Ø·Ø±Ø§Ø­ÛŒ/.test(skills) ? 0.06 : 0
    };
    const synergySum = trendKeys.reduce((s,k)=> s + (synergy[k]||0), 0);
    const dims = ['career','wealth','wellbeing','sustainability','resilience'];
    const scores = {}; dims.forEach(dim=>{
      const v = base[dim]*0.55 + trendImpact[dim]*0.35 + gBoost[dim] + rMod + synergySum*0.2;
      scores[dim] = clamp01(v);
    });
    return scores;
  }

  function buildNarrative(profile, decisionKey, scores, trendKeys) {
    const verb = DECISIONS[decisionKey].verb;
    const top = Object.entries(scores).sort((a,b)=>b[1]-a[1])[0][0];
    const topTxt = { career:"Ù…Ø³ÛŒØ± Ø´ØºÙ„ÛŒâ€ŒØ§Øª Ø¬Ù‡Ø´ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯.", wealth:"Ø±Ø´Ø¯ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒØ§Øª Ù…Ø¹Ù†Ø§Ø¯Ø§Ø± Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.", wellbeing:"Ú©ÛŒÙÛŒØª Ø²Ù†Ø¯Ú¯ÛŒâ€ŒØ§Øª Ø¨Ù‡ØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯.",
      sustainability:"Ø§Ø«Ø± Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ/Ù…Ø­ÛŒØ·ÛŒâ€ŒØ§Øª Ù¾Ø±Ø±Ù†Ú¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.", resilience:"ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒâ€ŒØ§Øª ØªÙ‚ÙˆÛŒØª Ù…ÛŒâ€ŒØ´ÙˆØ¯." }[top];
    const trendLine = trendKeys.map(k => ({AI:"Ù…ÙˆØ¬ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ",Climate:"Ú¯Ø°Ø§Ø± Ø³Ø¨Ø²",Geo:"Ø¨Ø§Ø²Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ú˜Ø¦ÙˆÙ¾Ù„ÛŒØªÛŒÚ©",Urban:"Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯",Demography:"ØªØ­ÙˆÙ„ Ø¬Ù…Ø¹ÛŒØª",Culture:"Ø³Ø¨Ú© Ø¯ÛŒØ¬ÛŒØªØ§Ù„"}[k])).join("ØŒ ");
    const riskText = profile.risk==='high' ? "Ø±ÛŒØ³Ú©â€ŒÙ¾Ø°ÛŒØ±ÛŒ ØªÙˆ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ø§Ø²Ø¯Ù‡ÛŒ Ø¨Ø²Ø±Ú¯â€ŒØªØ±ÛŒ Ø¨Ø³Ø§Ø²Ø¯."
      : profile.risk==='low' ? "Ø§Ø­ØªÛŒØ§Ø· ØªÙˆ Ø«Ø¨Ø§Øª Ø¨ÛŒØ´ØªØ±ÛŒ Ø¨Ù‡ Ù…Ø³ÛŒØ± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯." : "ØªØ¹Ø§Ø¯Ù„ Ø±ÛŒØ³Ú© Ø±Ø§ Ø­ÙØ¸ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒ.";
    const goalHint =
      profile.goal==='career' ? "Ø±ÙˆÛŒ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ù…ÛŒØ§Ø¨ Ùˆ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ ØªÙ…Ø±Ú©Ø² Ú©Ù†." :
      profile.goal==='wealth' ? "ØªÙ†ÙˆØ¹ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ùˆ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ Ø±Ø§ ÙØ±Ø§Ù…ÙˆØ´ Ù†Ú©Ù†." :
      profile.goal==='wellbeing' ? "Ø±ÛŒØªÙ… Ú©Ø§Ø±/Ø²Ù†Ø¯Ú¯ÛŒ Ø±Ø§ Ù…ØªÙˆØ§Ø²Ù† Ù†Ú¯Ù‡ Ø¯Ø§Ø±." :
      profile.goal==='sustainability' ? "Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§ÛŒ ESG Ø±Ø§ Ø¯Ø± Ù…Ø­ØµÙˆÙ„/Ø´ØºÙ„ Ø¯Ø®ÛŒÙ„ Ú©Ù†." :
      "Ø´Ø¨Ú©Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ú†Ù†Ø¯Ù…Ù†Ø¨Ø¹ÛŒâ€ŒÚ©Ø±Ø¯Ù† Ø¯Ø±Ø¢Ù…Ø¯ØŒ Ø³Ù¾Ø± ØªÙˆØ³Øª.";
    return `Ø¨Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Â«${verb}Â» Ùˆ ØªÙ…Ø±Ú©Ø² Ø¨Ø± ${trendLine}ØŒ ${topTxt} ${riskText} Ø§Ú¯Ø± ${goalHint} Ù…Ø³ÛŒØ±Øª ØªØ§ 2030 Ø§Ù…Ù†â€ŒØªØ± Ùˆ Ù¾Ø±Ø¨Ø§Ø²Ø¯Ù‡â€ŒØªØ± Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`;
  }

  function buildRiskOps(decisionKey, trendKeys) {
    const items = [];
    trendKeys.forEach(k => {
      MEGATRENDS[k].risks.forEach(r => items.push({ type:'risk', text:`(${k}) ${r}` }));
      MEGATRENDS[k].ops.forEach(o => items.push({ type:'op', text:`(${k}) ${o}` }));
    });
    if (decisionKey==='startup') { items.push({type:'risk', text:'Ù†Ù‚Ø¯ÛŒÙ†Ú¯ÛŒ 18â€“24 Ù…Ø§Ù‡ Ø§ÙˆÙ„'}); items.push({type:'op', text:'Ø¨Ø§Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ø¬Ù‡Ø§Ù†ÛŒ'}); }
    if (decisionKey==='immigrate') { items.push({type:'risk', text:'Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ ÙØ±Ù‡Ù†Ú¯ÛŒ/Ù‚Ø§Ù†ÙˆÙ†ÛŒ'}); items.push({type:'op', text:'Ø§Ú©ÙˆØ³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¢ÙˆØ±ÛŒ'}); }
    return items;
  }

  function buildTimeline(decisionKey) {
    const base = [
      { y:'2025', t:'Ø´Ø±ÙˆØ¹ Ùˆ Ø¨Ø§Ø²ØªÙ†Ø¸ÛŒÙ…' },
      { y:'2026', t:'Ø´Ø¨Ú©Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù‡Ø¯ÙÙ…Ù†Ø¯' },
      { y:'2027', t:'MVP/KPI Ùˆ Ø§ØµÙ„Ø§Ø­' },
      { y:'2028', t:'Ú¯Ø³ØªØ±Ø´ Ù…Ù‚ÛŒØ§Ø³' },
      { y:'2029', t:'ØªÙ†ÙˆØ¹â€ŒØ¨Ø®Ø´ÛŒ' },
      { y:'2030â€“2032', t:'ØªØ«Ø¨ÛŒØª Ù…Ø²ÛŒØª' }
    ];
    if (decisionKey==='startup') base[2].t = 'MVP Ùˆ Ø§ÙˆÙ„ÛŒÙ† Ù…Ø´ØªØ±ÛŒØ§Ù†';
    if (decisionKey==='invest') base[1].t = 'ØªØ¯ÙˆÛŒÙ† Ø³ÛŒØ§Ø³Øª Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ';
    if (decisionKey==='immigrate') base[0].t = 'Ø¢Ù…Ø§Ø¯Ú¯ÛŒ Ø²Ø¨Ø§Ù† Ùˆ Ù…Ø¯Ø§Ø±Ú©';
    if (decisionKey==='study') base[1].t = 'Ù…Ø¯Ø§Ø±Ú©/Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ';
    if (decisionKey==='switch') base[0].t = 'Ø¨Ø§Ø²Ø¢Ù…ÙˆØ²ÛŒ Ùˆ Ù†Ù…ÙˆÙ†Ù‡â€ŒÚ©Ø§Ø±';
    return base;
  }

  function renderTimeline(svg, data) {
    while (svg.firstChild) svg.removeChild(svg.firstChild);
    const W = svg.viewBox.baseVal.width || 800, H = svg.viewBox.baseVal.height || 140;
    const pad = 40, yMid = H/2;
    // path
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d', `M ${pad} ${yMid} L ${W-pad} ${yMid}`);
    path.setAttribute('stroke', getComputedStyle(document.body).getPropertyValue('--border')); path.setAttribute('fill','none'); path.setAttribute('stroke-width','2');
    svg.appendChild(path);
    const step = (W - pad*2) / (data.length - 1);
    data.forEach((n,i)=>{
      const x = pad + i*step; const y = yMid + (i%2===0? -18 : 18);
      const g = document.createElementNS('http://www.w3.org/2000/svg','g');
      // line to node
      const l = document.createElementNS('http://www.w3.org/2000/svg','line');
      l.setAttribute('x1', x); l.setAttribute('y1', yMid); l.setAttribute('x2', x); l.setAttribute('y2', y); l.setAttribute('stroke', getComputedStyle(document.body).getPropertyValue('--border'));
      svg.appendChild(l);
      // node
      const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
      c.setAttribute('cx', x); c.setAttribute('cy', y); c.setAttribute('r', '6'); c.setAttribute('fill', getComputedStyle(document.body).getPropertyValue('--heading')); c.setAttribute('class','tl-dot');
      g.appendChild(c);
      // labels
      const txt = document.createElementNS('http://www.w3.org/2000/svg','text');
      txt.setAttribute('x', x); txt.setAttribute('y', y + (i%2===0? -10 : 24)); txt.setAttribute('text-anchor','middle'); txt.setAttribute('class','tl-label'); txt.textContent = n.t;
      g.appendChild(txt);
      const yr = document.createElementNS('http://www.w3.org/2000/svg','text');
      yr.setAttribute('x', x); yr.setAttribute('y', yMid + (i%2===0? -24 : 34)); yr.setAttribute('text-anchor','middle'); yr.setAttribute('class','tl-year'); yr.textContent = n.y;
      svg.appendChild(yr);
      svg.appendChild(g);
    });
  }

  function simulate() {
    const profile = {
      age: parseInt(document.getElementById('age').value || '26', 10),
      location: document.getElementById('location').value || 'â€”',
      skills: document.getElementById('skills').value || '',
      risk: document.getElementById('risk').value,
      goal: document.getElementById('goal').value
    };
    const decisionKey = getActiveKey('decisions') || 'startup';
    const trendKeys = getActiveKeys('trends');
    const scores = score(profile, decisionKey, trendKeys);

    // KPIs
    document.getElementById('k-career').textContent = pct(scores.career);
    document.getElementById('k-wealth').textContent = pct(scores.wealth);
    document.getElementById('k-wellbeing').textContent = pct(scores.wellbeing);
    document.getElementById('k-sustainability').textContent = pct(scores.sustainability);
    document.getElementById('k-resilience').textContent = pct(scores.resilience);

    // Radar
    drawRadar(document.getElementById('radar'), scores);

    // Mood bar pointer
    const overall = (scores.career + scores.wealth + scores.wellbeing + scores.sustainability + scores.resilience)/5;
    document.getElementById('moodPtr').style.left = (pct(overall)) + '%';

    // Narrative
    document.getElementById('narrative').textContent = buildNarrative(profile, decisionKey, scores, trendKeys);

    // Risks & opportunities
    const roEl = document.getElementById('risksOps'); roEl.innerHTML = '';
    buildRiskOps(decisionKey, trendKeys).forEach(x => {
      const d = document.createElement('div'); d.className = 'item';
      d.innerHTML = `<span class="${x.type==='risk'?'danger':'ok'}">${x.type==='risk'?'Ø±ÛŒØ³Ú©':'ÙØ±ØµØª'}:</span> ${x.text}`; roEl.appendChild(d);
    });

    // Timeline
    renderTimeline(document.getElementById('timeline'), buildTimeline(decisionKey));

    // Persist
    localStorage.setItem('future_mirror_last', JSON.stringify({ profile, decisionKey, trendKeys }));
    setQuote();
  }

  document.getElementById('simulate').addEventListener('click', simulate);
  document.getElementById('save').addEventListener('click', () => {
    const name = prompt('Ù†Ø§Ù… Ø³Ù†Ø§Ø±ÛŒÙˆ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†:'); if (!name) return;
    const data = localStorage.getItem('future_mirror_last'); if (!data) return alert('Ø§ÙˆÙ„ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ù†.');
    localStorage.setItem('future_mirror_' + name, data); alert('Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
  });
  document.getElementById('load').addEventListener('click', () => {
    const name = prompt('Ù†Ø§Ù… Ø³Ù†Ø§Ø±ÛŒÙˆ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ:'); if (!name) return;
    const data = localStorage.getItem('future_mirror_' + name); if (!data) return alert('Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.');
    const { profile, decisionKey, trendKeys } = JSON.parse(data);
    document.getElementById('age').value = profile.age;
    document.getElementById('location').value = profile.location;
    document.getElementById('skills').value = profile.skills;
    document.getElementById('risk').value = profile.risk;
    document.getElementById('goal').value = profile.goal;
    // chips
    [...document.getElementById('decisions').children].forEach(c => c.classList.toggle('active', c.dataset.id===decisionKey));
    [...document.getElementById('trends').children].forEach(c => c.classList.toggle('active', trendKeys.includes(c.dataset.id)));
    simulate();
  });

  // Auto simulate once
  simulate();
</script>
</body>
</html>
