<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ØªØµÙ…ÛŒÙ…â€ŒÛŒØ§Ø± Ø¢ÛŒÙ†Ø¯Ù‡â€ŒÙ†Ú¯Ø± (Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„)</title>
<style>
:root{
  --bg:#0b1220; --panel:#0e1522; --muted:#9fb0c3; --text:#e7edf5; --accent:#7ee787; --border:#22304a; --danger:#ff6b6b; --warn:#ffb020;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:radial-gradient(1200px 800px at 80% -10%,#1a2642 0%,rgba(11,18,32,0) 70%),var(--bg);color:var(--text);font:15px/1.7 Vazirmatn,Segoe UI,Roboto,Arial}
.container{max-width:1100px;margin:24px auto;padding:0 16px}
h1{font-size:26px;margin:8px 0 18px}
h2{font-size:18px;margin:18px 0 10px}
h3{font-size:16px;margin:14px 0 8px;color:#cfe6ff}
.section{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:900px){.row{grid-template-columns:1fr}}
.input{display:flex;flex-direction:column;gap:6px}
.input label{font-weight:600}
.input input[type="text"], .input select, .input textarea, .pill{
  background:#0b1322;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:10px
}
.input textarea{min-height:72px}
.small{font-size:12px;color:var(--muted)}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
@media (max-width:700px){.grid{grid-template-columns:1fr 1fr}}
.sliderRow{display:grid;grid-template-columns:120px 1fr 40px;gap:8px;align-items:center}
code.badge{background:#0b1322;border:1px solid var(--border);padding:2px 8px;border-radius:999px;color:var(--muted)}
.kpi{display:flex;gap:12px;flex-wrap:wrap}
.kpi .card{flex:1 1 200px;background:#0b1322;border:1px solid var(--border);border-radius:12px;padding:10px}
.table{width:100%;border-collapse:separate;border-spacing:0 6px}
.table th,.table td{padding:10px;background:#0b1322;border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
.table th:first-child,.table td:first-child{border-right:1px solid var(--border);border-radius:10px 0 0 10px}
.table th:last-child,.table td:last-child{border-left:1px solid var(--border);border-radius:0 10px 10px 0}
.alert{padding:10px;border-radius:10px;border:1px solid var(--border);background:#101828}
.alert.warn{border-color:#4b3a0d;background:rgba(255,176,32,0.07);color:#ffd78a}
.alert.danger{border-color:#4a1a1a;background:rgba(255,107,107,0.07);color:#ffb5b5}
.btn{background:linear-gradient(180deg,#1f6f5d,#145346);border:1px solid #1e5c4c;color:white;padding:10px 14px;border-radius:10px;cursor:pointer}
.btn:disabled{opacity:.6;cursor:not-allowed}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border-radius:16px;border:1px solid var(--border);background:#0b1322;cursor:pointer}
.chip input{margin:0}
.progress{height:8px;background:#0f1a2b;border-radius:6px;overflow:hidden;border:1px solid var(--border)}
.progress > span{display:block;height:100%;background:linear-gradient(90deg,#7ee787,#42b883);width:0%}
.bad{background:linear-gradient(90deg,#ff6b6b,#ff9f7a)!important}
.neutral{background:linear-gradient(90deg,#a0b3c6,#c1cfdb)!important}
.recList{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media (max-width:900px){.recList{grid-template-columns:1fr}}
.recItem{border:1px dashed var(--border);border-radius:12px;padding:10px;background:#0b1322}
.recItem .why{color:var(--muted);font-size:12px;margin-top:6px}
.matrix{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
@media (max-width:900px){.matrix{grid-template-columns:1fr 1fr}}
.box{border:1px solid var(--border);border-radius:12px;padding:10px;background:#0b1322}
.analysisBox{background:linear-gradient(180deg,#0e1522,#0c111b);border:1px solid var(--border);border-radius:14px;padding:12px;line-height:1.9}
.analysisBox .rec{margin-top:10px;padding:8px;border-left:3px solid var(--accent);background:rgba(126,231,135,0.06);border-radius:8px}
.analysisBox .reason{font-size:12px;color:var(--muted);margin-top:4px}
.footer{color:#8ea3b7;font-size:12px;margin-top:6px}
hr.sep{border:none;border-top:1px dashed var(--border);margin:12px 0}
</style>
</head>
<body>
<div class="container">
  <h1>ØªØµÙ…ÛŒÙ…â€ŒÛŒØ§Ø± Ø¢ÛŒÙ†Ø¯Ù‡â€ŒÙ†Ú¯Ø±</h1>
  <div class="section">
    <div class="row">
      <div class="input">
        <label>Ø¹Ù†ÙˆØ§Ù† ØªØµÙ…ÛŒÙ…</label>
        <input id="decision" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: ØªØºÛŒÛŒØ± Ù…Ø³ÛŒØ± Ø´ØºÙ„ÛŒ Ø¨Ù‡ Ø¯ÛŒØªØ§ Ø³Ø§ÛŒÙ†Ø³" />
        <span class="small">Ú©ÙˆØªØ§Ù‡ Ùˆ Ù…Ø´Ø®Øµ Ø¨Ù†ÙˆÛŒØ³.</span>
      </div>
      <div class="row">
        <div class="input">
          <label>Ø§ÙÙ‚ ØªØµÙ…ÛŒÙ… (Ù…Ø§Ù‡)</label>
          <input id="horizon" type="number" min="1" max="60" value="12" />
          <span class="small">Ø¨Ø§Ø²Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ø¯Ø± Ø¢Ù† Ù†ØªÛŒØ¬Ù‡ Ø¨Ø¨ÛŒÙ†ÛŒ.</span>
        </div>
        <div class="input">
          <label>ØªØ­Ù…Ù„ Ø±ÛŒØ³Ú©</label>
          <select id="risk">
            <option value="low">Ú©Ù…</option>
            <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
            <option value="high">Ø²ÛŒØ§Ø¯</option>
          </select>
        </div>
      </div>
    </div>
    <hr class="sep" />
    <h2>Ø¯Ø§Ù…Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¯Ø§Ø± Ùˆ ÙˆØ²Ù†â€ŒØ¯Ù‡ÛŒ</h2>
    <div id="domainWeights" class="grid"></div>
    <div class="footer">Ø¬Ù…Ø¹ ÙˆØ²Ù†â€ŒÙ‡Ø§ Ø§Ù‡Ù…ÛŒØª Ù†Ø³Ø¨ÛŒ Ø­ÙˆØ²Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯Ø› ØªØ¹Ø§Ø¯Ù„ÛŒ Ú©Ù‡ Ù…Ù†Ø·Ù‚ ØªØµÙ…ÛŒÙ… ØªÙˆ Ø±Ø§ ÙˆØ§Ù‚Ø¹â€ŒÚ¯Ø±Ø§ÛŒØ§Ù†Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</div>
  </div>

  <div class="section">
    <h2>ØªØ±Ù†Ø¯Ù‡Ø§ Ùˆ Ù¾ÛŒØ´Ø±Ø§Ù†â€ŒÙ‡Ø§</h2>
    <div id="trendChips" class="chips"></div>
    <div class="footer">ØªØ±Ù†Ø¯Ù‡Ø§ Ø±ÙˆÛŒ Ø§Ù…ØªÛŒØ§Ø² Ø­ÙˆØ²Ù‡â€ŒÙ‡Ø§ Ø§Ø«Ø± Ø¶Ø±Ø¨â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø¯Ø§Ø±Ù†Ø¯Ø› Ø¨Ø§ ØªÙ…Ø±Ú©Ø² Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†.</div>
  </div>

  <div class="section">
    <div class="row">
      <div>
        <h2>Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§</h2>
        <div class="input">
          <label>ÙÙ‡Ø±Ø³Øª Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ</label>
          <textarea id="skills" placeholder="Ù…Ø«Ù„Ø§Ù‹: Python, SQL, Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ, Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡"></textarea>
          <span class="small">Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†.</span>
        </div>
      </div>
      <div>
        <h2>Ù…Ù†Ø§Ø¨Ø¹ Ø¯Ø± Ø¯Ø³ØªØ±Ø³</h2>
        <div class="grid">
          <label class="pill"><input id="res-time" type="checkbox" /> Ø²Ù…Ø§Ù† Ù‡ÙØªÚ¯ÛŒ Ú©Ø§ÙÛŒ</label>
          <label class="pill"><input id="res-budget" type="checkbox" /> Ø¨ÙˆØ¯Ø¬Ù‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ</label>
          <label class="pill"><input id="res-network" type="checkbox" /> Ø´Ø¨Ú©Ù‡ Ø§Ø±ØªØ¨Ø§Ø·ÛŒ</label>
        </div>
        <div class="row" style="margin-top:10px">
          <div class="input">
            <label>Ø³Ø§Ø¹Øª Ø¢Ø²Ø§Ø¯ Ù‡ÙØªÚ¯ÛŒ</label>
            <input id="hours" type="number" min="0" value="6" />
          </div>
          <div class="input">
            <label>Ø¨ÙˆØ¯Ø¬Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡ (ÛŒÙˆØ±Ùˆ)</label>
            <input id="budget" type="number" min="0" value="150" />
          </div>
        </div>
      </div>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
      <button id="run" class="btn">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯</button>
      <code class="badge" id="status">Ø¢Ù…Ø§Ø¯Ù‡</code>
    </div>
  </div>

  <div class="section">
    <h2>Ø®Ù„Ø§ØµÙ‡ ØªØ­Ù„ÛŒÙ„ÛŒ</h2>
    <div class="kpi">
      <div class="card">
        <div class="small">Ø±ÛŒØ³Ú© Ú©Ù„ÛŒ</div>
        <div id="kpiRisk" style="font-weight:700">â€”</div>
      </div>
      <div class="card">
        <div class="small">Ø¯Ø§Ù…Ù†Ù‡ ØºØ§Ù„Ø¨</div>
        <div id="kpiDomain" style="font-weight:700">â€”</div>
      </div>
      <div class="card">
        <div class="small">Ù‚Ø¯Ø±Øª Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ±ÛŒ</div>
        <div class="progress"><span id="kpiFeas" style="width:0%"></span></div>
      </div>
      <div class="card">
        <div class="small">Ù‡Ù…â€ŒØªØ±Ø§Ø²ÛŒ ØªØ±Ù†Ø¯</div>
        <div class="progress"><span id="kpiTrend" class="neutral" style="width:0%"></span></div>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ø±ÛŒØ³Ú©</h2>
    <div id="alerts" class="grid"></div>
  </div>

  <div class="section">
    <h2>Ø§Ù…ØªÛŒØ§Ø² Ø­ÙˆØ²Ù‡â€ŒÙ‡Ø§</h2>
    <table class="table" id="scoreTable">
      <thead>
        <tr><th>Ø­ÙˆØ²Ù‡</th><th>Ø§Ù…ØªÛŒØ§Ø²</th><th>ØªÙˆØ¶ÛŒØ­</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h2>Ú¯Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Û¶ Ù‡ÙØªÙ‡â€ŒØ§ÛŒ</h2>
    <div id="recs" class="recList"></div>
  </div>

  <div class="section">
    <h2>Ù…Ø§ØªØ±ÛŒØ³ Ù…Ù†Ø§Ø¨Ø¹</h2>
    <div class="matrix">
      <div class="box"><strong>Ú©Ù…â€ŒÙ‡Ø²ÛŒÙ†Ù‡/Ú©Ù…â€ŒØ²Ù…Ø§Ù†:</strong><div id="mx-easy"></div></div>
      <div class="box"><strong>Ù¾Ø±Ø§Ø«Ø±/Ú©Ù…â€ŒØ²Ù…Ø§Ù†:</strong><div id="mx-quick"></div></div>
      <div class="box"><strong>Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¹Ù…ÛŒÙ‚:</strong><div id="mx-deep"></div></div>
    </div>
  </div>

  <div class="section">
    <h2>ØªØ­Ù„ÛŒÙ„ Ø¢ÛŒÙ†Ø¯Ù‡ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ù‡Ø§</h2>
    <div id="futureAnalysis" class="analysisBox"></div>
  </div>

  <div class="footer">Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ù…Ú© Ø¨Ù‡ ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø¹Ù†Ø§Ø¯Ø§Ø±Ø› Ø¬Ø§ÛŒÛŒ Ú©Ù‡ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ Ø¨Ø§ Ø¢ÛŒÙ†Ø¯Ù‡ Ú¯ÙØªâ€ŒÙˆÚ¯Ùˆ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.</div>
</div>

<script>
// Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
const DOMAINS = [
  { id:'tech', label:'ÙÙ†Ø§ÙˆØ±ÛŒ Ùˆ Ø¯Ø§Ø¯Ù‡' },
  { id:'market', label:'Ø¨Ø§Ø²Ø§Ø± Ùˆ Ù…Ø­ØµÙˆÙ„' },
  { id:'people', label:'Ø§ÙØ±Ø§Ø¯ Ùˆ Ø´Ø¨Ú©Ù‡' },
  { id:'ops', label:'Ø¹Ù…Ù„ÛŒØ§Øª Ùˆ Ø§Ø¬Ø±Ø§' },
  { id:'learn', label:'ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ùˆ Ù¾Ú˜ÙˆÙ‡Ø´' },
  { id:'brand', label:'Ø¨Ø±Ù†Ø¯ Ø´Ø®ØµÛŒ' }
];

const TRENDS = [
  { id:'ai', name:'Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù…ÙˆÙ„Ø¯', impact:{ tech:1.25, market:1.08, ops:1.1, learn:1.18, brand:1.05 } },
  { id:'data', name:'Ø­Ø§Ú©Ù…ÛŒØª Ø¯Ø§Ø¯Ù‡ Ùˆ Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ', impact:{ tech:1.12, ops:1.15, market:1.05 } },
  { id:'remote', name:'Ø¯ÙˆØ±Ú©Ø§Ø±ÛŒ Ùˆ ØªÛŒÙ…â€ŒÙ‡Ø§ÛŒ ØªÙˆØ²ÛŒØ¹â€ŒØ´Ø¯Ù‡', impact:{ people:1.12, ops:1.1, brand:1.05 } },
  { id:'fin', name:'ÙÙ†Ø§ÙˆØ±ÛŒ Ù…Ø§Ù„ÛŒ', impact:{ market:1.12, tech:1.08 } },
  { id:'sust', name:'Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ùˆ ESG', impact:{ market:1.08, ops:1.1, brand:1.06 } },
  { id:'ed', name:'EdTech Ùˆ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ ØªØ·Ø¨ÛŒÙ‚ÛŒ', impact:{ learn:1.2, tech:1.06, brand:1.04 } }
];

const SOURCES = [
  { domain:'tech', name:'McKinsey Tech Trends' },
  { domain:'market', name:'Gartner Market Guide' },
  { domain:'people', name:'Deloitte Human Capital' },
  { domain:'ops', name:'MIT Sloan Ops Review' },
  { domain:'learn', name:'OECD Skills Outlook' },
  { domain:'brand', name:'HBR Personal Branding' }
];

// Ø³Ø§Ø®Øª UI ÙˆØ²Ù†â€ŒÙ‡Ø§
const weightsEl = document.getElementById('domainWeights');
const sliders = {};
DOMAINS.forEach(d=>{
  const wrap = document.createElement('div');
  wrap.className='box';
  wrap.innerHTML = `
    <div class="sliderRow">
      <div>${d.label}</div>
      <input type="range" min="0" max="100" value="${d.id==='tech'||d.id==='learn'?60:40}" id="w-${d.id}" />
      <div><span id="v-${d.id}">0</span>%</div>
    </div>`;
  weightsEl.appendChild(wrap);
  sliders[d.id]=wrap.querySelector(`#w-${d.id}`);
  const v=wrap.querySelector(`#v-${d.id}`);
  const sync=()=>{v.textContent=sliders[d.id].value;}
  sliders[d.id].addEventListener('input',sync); sync();
});

// ØªØ±Ù†Ø¯Ù‡Ø§
const trendChips = document.getElementById('trendChips');
const selectedTrends = new Set();
TRENDS.forEach(t=>{
  const lbl = document.createElement('label');
  lbl.className='chip';
  lbl.innerHTML = `<input type="checkbox" value="${t.id}" /> ${t.name}`;
  lbl.querySelector('input').addEventListener('change',e=>{
    if(e.target.checked) selectedTrends.add(t.id); else selectedTrends.delete(t.id);
  });
  trendChips.appendChild(lbl);
});

// Ø¹Ù†Ø§ØµØ±
const decisionEl = document.getElementById('decision');
const horizonEl = document.getElementById('horizon');
const riskEl = document.getElementById('risk');
const skillsEl = document.getElementById('skills');
const hoursEl = document.getElementById('hours');
const budgetEl = document.getElementById('budget');
const statusEl = document.getElementById('status');

// Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§
const kpiRiskEl = document.getElementById('kpiRisk');
const kpiDomainEl = document.getElementById('kpiDomain');
const kpiFeasBar = document.getElementById('kpiFeas');
const kpiTrendBar = document.getElementById('kpiTrend');
const alertsEl = document.getElementById('alerts');
const scoreTableBody = document.querySelector('#scoreTable tbody');
const recsEl = document.getElementById('recs');

// Ø§Ø¨Ø²Ø§Ø±Ú©â€ŒÙ‡Ø§
function parseSkills(){
  return skillsEl.value.split(/[,\n]/).map(s=>s.trim()).filter(Boolean).map(s=>s.toLowerCase());
}
function norm(x, min, max){ return max===min?0: (x-min)/(max-min); }
function clamp(x,min,max){ return Math.max(min, Math.min(max,x)); }

// Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø§ØµÙ„ÛŒ
function computeScores(){
  const domainW = {};
  let sumW=0;
  DOMAINS.forEach(d=>{
    domainW[d.id]=Number(sliders[d.id].value)/100;
    sumW += domainW[d.id];
  });
  // Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù†Ø±Ù… (Ø¨Ø¯ÙˆÙ† Ø¬Ù…Ø¹ Ø§Ù„Ø²Ø§Ù…ÛŒ = 1)
  const risk = riskEl.value;
  const horizon = Number(horizonEl.value);
  const skills = parseSkills();
  const hours = Number(hoursEl.value)||0;
  const budget = Number(budgetEl.value)||0;

  // ØªØ§Ø«ÛŒØ± ØªØ±Ù†Ø¯Ù‡Ø§
  const mult = {};
  DOMAINS.forEach(d=>mult[d.id]=1);
  selectedTrends.forEach(tr=>{
    const t = TRENDS.find(x=>x.id===tr);
    if(!t) return;
    Object.entries(t.impact).forEach(([k,v])=>{ mult[k] *= v; });
  });

  // Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ù…Ù‡Ø§Ø±Øª
  const skillHints = {
    tech:['python','sql','ml','ai','cloud','api','etl','javascript','typescript'],
    market:['product','Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ','marketing','seo','discovery','pmf','pricing'],
    people:['communication','Ø§Ø±ØªØ¨Ø§Ø·','negotiation','coaching','leadership','mentoring'],
    ops:['project','Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡','kanban','scrum','automation','devops'],
    learn:['research','ØªØ­Ù‚ÛŒÙ‚','statistics','Ø¢Ù…Ø§Ø±','teaching','teaching assistant','writing'],
    brand:['content','Ù†ÙˆØ´ØªÙ†','linkedin','twitter','community','speaking','presentation']
  };
  const skillFit = {};
  DOMAINS.forEach(d=>{
    const ref = skillHints[d.id]||[];
    const match = skills.filter(s=>ref.some(r=>s.includes(r))).length;
    skillFit[d.id] = clamp(0.6 + match*0.08, 0.6, 1.2);
  });

  // Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ±ÛŒ Ù…Ù†Ø§Ø¨Ø¹
  const hasTime = document.getElementById('res-time').checked;
  const hasBudget = document.getElementById('res-budget').checked;
  const hasNetwork = document.getElementById('res-network').checked;
  const feas = clamp(
    (hasTime?0.25:0) + (hasBudget?0.25:0) + (hasNetwork?0.2:0) +
    clamp(hours/12,0,0.2) + clamp(budget/200,0,0.1),
    0, 1
  );

  // Ø±ÛŒØ³Ú© Ù¾Ø§ÛŒÙ‡
  const baseRisk = {low:0.25, medium:0.5, high:0.75}[risk];
  const riskAdj = clamp(baseRisk + (selectedTrends.size>=3?0.05:0) + (horizon>=18?0.05:0), 0, 1);

  // Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ Ù‡Ø± Ø­ÙˆØ²Ù‡
  const scores = {};
  DOMAINS.forEach(d=>{
    const s = (0.5*domainW[d.id] + 0.25*feas + 0.25*norm(skillFit[d.id],0.6,1.2)) * mult[d.id];
    scores[d.id]= Number((s*100).toFixed(1));
  });

  // KPI ØªØ±Ù†Ø¯
  const trendAlign = clamp(Object.values(mult).reduce((a,b)=>a+b,0)/DOMAINS.length - 1, 0, 0.4) / 0.4; // 0..1

  return { domainW, mult, skillFit, scores, feas, riskAdj, trendAlign,
           profile:{risk, horizon, hours, budget, hasTime, hasBudget, hasNetwork, skills} };
}

// Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§
function buildAlerts(ctx){
  const arr=[];
  const {profile, feas, riskAdj} = ctx;
  if(profile.horizon<6) arr.push({lvl:'warn', text:'Ø§ÙÙ‚ Ø²ÛŒØ± Û¶ Ù…Ø§Ù‡: Ø§Ù†ØªØ¸Ø§Ø± Ù†ØªÛŒØ¬Ù‡ Ø¨Ø²Ø±Ú¯ ØºÛŒØ±ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³Øª. Ø¯Ø§Ù…Ù†Ù‡ Ú¯Ø§Ù…â€ŒÙ‡Ø§ Ø±Ø§ Ú©ÙˆÚ†Ú© Ú©Ù†.'});
  if(!profile.hasTime && profile.hours<5) arr.push({lvl:'danger', text:'Ú©Ù…Ø¨ÙˆØ¯ Ø²Ù…Ø§Ù†: Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØª Ù¾Ø§ÛŒØ¯Ø§Ø± Ø­Ø¯Ø§Ù‚Ù„ Ûµâ€“Û¸ Ø³Ø§Ø¹Øª Ø¯Ø± Ù‡ÙØªÙ‡ Ù„Ø§Ø²Ù… Ø§Ø³Øª.'});
  if(!profile.hasBudget && profile.budget<50) arr.push({lvl:'warn', text:'Ø¨ÙˆØ¯Ø¬Ù‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ù…Ø­Ø¯ÙˆØ¯: Ø§Ø² Ù…Ù†Ø§Ø¨Ø¹ Ø±Ø§ÛŒÚ¯Ø§Ù† Ùˆ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.'});
  if(riskAdj>0.7 && selectedTrends.size>=3) arr.push({lvl:'warn', text:'Ù¾Ø±Ø§Ú©Ù†Ø¯Ú¯ÛŒ ØªØ±Ù†Ø¯Ù‡Ø§ Ø¯Ø± Ø±ÛŒØ³Ú© Ø¨Ø§Ù„Ø§: ØªÙ…Ø±Ú©Ø² Ø±Ø§ Ø¨Ù‡ Û±â€“Û² ØªØ±Ù†Ø¯ Ú©Ø§Ù‡Ø´ Ø¨Ø¯Ù‡.'});
  if(feas<0.35) arr.push({lvl:'danger', text:'Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ±ÛŒ Ù¾Ø§ÛŒÛŒÙ†: Ø§Ø¨ØªØ¯Ø§ Ù…Ù†Ø§Ø¨Ø¹ Ù¾Ø§ÛŒÙ‡ (Ø²Ù…Ø§Ù†/Ø¨ÙˆØ¯Ø¬Ù‡/Ø´Ø¨Ú©Ù‡) Ø±Ø§ ØªÙ‚ÙˆÛŒØª Ú©Ù†.'});
  return arr;
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ù…ØªÛŒØ§Ø²
function renderScores(scores, mult, domainW, skillFit){
  scoreTableBody.innerHTML='';
  const entries = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  entries.forEach(([id,score])=>{
    const tr=document.createElement('tr');
    const d=DOMAINS.find(x=>x.id===id);
    const why = `ÙˆØ²Ù†: ${(domainW[id]*100).toFixed(0)}% | ØªØ±Ù†Ø¯: ${(mult[id]).toFixed(2)}Ã— | Ù…Ù‡Ø§Ø±Øª: ${(skillFit[id]).toFixed(2)}Ã—`;
    tr.innerHTML=`<td>${d.label}</td><td>${score}</td><td>${why}</td>`;
    scoreTableBody.appendChild(tr);
  });
}

// ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Û¶ Ù‡ÙØªÙ‡â€ŒØ§ÛŒ
function buildRecs(topDomain, profile){
  const list=[];
  const week = (t)=>`ØªØ§ ${t} Ø±ÙˆØ²`;
  const push=(title, why)=>list.push({title, why});
  if(topDomain==='tech'){
    push('Ù¾Ø±ÙˆÚ˜Ù‡ Ø¹Ù…Ù„ÛŒ Ú©ÙˆÚ†Ú© Ø¨Ø§ Ø¯Ø§Ø¯Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ', `ÛŒÚ© Ø¯ÛŒØªØ§Ø³Øª Ø¹Ù…ÙˆÙ…ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ØŒ Ø®Ø±ÙˆØ¬ÛŒ Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø§ÛŒØ´ GitHub ${week(10)}`);
    push('Ù…Ø¯Ø±Ú© Ú©ÙˆØªØ§Ù‡â€ŒÙ…Ø¯Øª Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ', `ÛŒÚ© Ù…ÛŒÚ©Ø±ÙˆÙ„ÙØ±Ù†ÛŒÙ†Ú¯ Û±Ûµâ€“Û²Û° Ø³Ø§Ø¹ØªÙ‡ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ù‡Ø¯Ù ØªÙˆ ${week(20)}`);
  } else if(topDomain==='market'){
    push('Ù…ØµØ§Ø­Ø¨Ù‡ Ø§Ú©ØªØ´Ø§ÙÛŒ Ø¨Ø§ Û±Û° Ú©Ø§Ø±Ø¨Ø±', `ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø¹Ù…ÛŒÙ‚ Ù…Ø³Ø¦Ù„Ù‡ Ù…Ø´ØªØ±ÛŒ Ùˆ ØªØ±Ø³ÛŒÙ… ÙØ±Ø¶ÛŒØ§Øª PMF ${week(14)}`);
    push('MVP Ø³Ø¨Ú©â€ŒÙˆØ²Ù†', `ÛŒÚ© ØµÙØ­Ù‡ Ù„Ù†Ø¯ÛŒÙ†Ú¯ + ÙØ±Ù… Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ù†Ø¬Ø´ ØªÙ‚Ø§Ø¶Ø§ ${week(28)}`);
  } else if(topDomain==='people'){
    push('Ø´Ø¨Ú©Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù‡Ø¯ÙÙ…Ù†Ø¯ Û²Û° ØªÙ…Ø§Ø³', `Warm intro Ø§Ø² Ø¯ÙˆØ³ØªØ§Ù† Ø¯Ø±Ø¬Ù‡ Ø¯Ùˆ LinkedIn ${week(21)}`);
    push('ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ù…Ø´Ø§ÙˆØ±Ù‡ Ù…Ø¹Ú©ÙˆØ³', `Ø§Ø² ÛŒÚ© Ù…Ù†ØªÙˆØ± Ø¨Ø®ÙˆØ§Ù‡ Ø±ÙˆÛŒ Ù…Ø³ÛŒØ±Øª ÙÛŒØ¯Ø¨Ú© Ø¯Ù‡Ø¯ ${week(10)}`);
  } else if(topDomain==='ops'){
    push('Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù†Ø¨Ø§Ù† Ø´Ø®ØµÛŒ', `Ù¾ÛŒØ´Ø¨Ø±Ø¯ Ú©Ø§Ø± Ø¨Ø§ WIP Ù…Ø­Ø¯ÙˆØ¯ + Ø¨Ø§Ø²Ø¨ÛŒÙ†ÛŒ Ù‡ÙØªÚ¯ÛŒ ${week(7)}`);
    push('Ø§ØªÙˆÙ…Ø§Ø³ÛŒÙˆÙ† ÛŒÚ© ØªØ³Ú© ØªÚ©Ø±Ø§Ø±ÛŒ', `ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ø­Ø¯Ø§Ù‚Ù„ Û² Ø³Ø§Ø¹Øª Ù‡ÙØªÚ¯ÛŒ Ø¨Ø§ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø³Ø§Ø¯Ù‡ ${week(21)}`);
  } else if(topDomain==='learn'){
    push('Ù†Ù‚Ø´Ù‡ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Û¸ Ù‡ÙØªÙ‡â€ŒØ§ÛŒ', `Ø³Ø±ÙØµÙ„â€ŒÙ‡Ø§ÛŒ Ù‡ÙØªÚ¯ÛŒ + Ù¾Ø±ÙˆÚ˜Ù‡ Ù¾Ø§ÛŒØ§Ù†ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ø±Ø§Ø¦Ù‡ ${week(7)}`);
    push('Ø«Ø¨Øª Ùˆ Ø¨Ù‡â€ŒØ§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ', `Ù‡Ø± Ù‡ÙØªÙ‡ ÛŒÚ© ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ù†ØªØ´Ø± Ú©Ù† Ø¨Ø±Ø§ÛŒ ØªØ«Ø¨ÛŒØª Ùˆ Ø¨Ø±Ù†Ø¯ ${week(14)}`);
  } else if(topDomain==='brand'){
    push('Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ÙˆÛŒØªØ±ÛŒÙ† Ø¢Ù†Ù„Ø§ÛŒÙ†', `Ø¨Ù‡â€ŒØ±ÙˆØ² Ú©Ø±Ø¯Ù† LinkedIn/GitHub/ÙˆØ¨â€ŒØ³Ø§ÛŒØª Ùˆ Ù†Ù…ÙˆÙ†Ù‡â€ŒÚ©Ø§Ø± ${week(10)}`);
    push('Ø³Ø±ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Û´ Ø¨Ø®Ø´ÛŒ', `ÛŒÚ© Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø­ÙˆØ±ÛŒ Ùˆ Ø§Ù†ØªØ´Ø§Ø± Ù…Ù†Ø¸Ù… Ø¨Ø±Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ø§Ø²ÛŒ ${week(28)}`);
  }
  // ØªÙ†Ø¸ÛŒÙ… Ø¨Ø§ Ø±ÛŒØ³Ú©
  if(profile.risk==='low') list.push({title:'Ø®Ø±Ø¯Ù‡â€ŒÙ¾ÛŒØ´Ø±ÙØª Ø±ÙˆØ²Ø§Ù†Ù‡ Û³Û° Ø¯Ù‚ÛŒÙ‚Ù‡',
    why:'ØªØ¯Ø§ÙˆÙ… Ú©Ù…â€ŒØ±ÛŒØ³Ú© Ø§Ù…Ø§ Ù¾Ø§ÛŒØ¯Ø§Ø±Ø› Ø¹Ø§Ø¯Øªâ€ŒØ³Ø§Ø²ÛŒ Ù…Ù‡Ù…â€ŒØªØ± Ø§Ø² Ø´Ø¯Øª Ø§Ø³Øª.'});
  if(profile.risk==='high') list.push({title:'ÙØ±Ø¶ÛŒÙ‡ Ø¨Ø²Ø±Ú¯ Ø¨Ø§ Pilot Ø³Ø±ÛŒØ¹',
    why:'ÛŒÚ© Ø¢Ø²Ù…Ø§ÛŒØ´ Ø¬Ø³ÙˆØ±Ø§Ù†Ù‡ Ø§Ù…Ø§ Ú©ÙˆØªØ§Ù‡â€ŒÙ…Ø¯Øª Ø¨Ø±Ø§ÛŒ Ú©Ø´Ù Ø¨Ø§Ø²Ø¯Ù‡ Ù†Ø§Ù…ØªÙ‚Ø§Ø±Ù†.'});
  return list;
}

// Ù…Ø§ØªØ±ÛŒØ³ Ù…Ù†Ø§Ø¨Ø¹
function renderMatrix(topDomain, profile){
  const easy = document.getElementById('mx-easy');
  const quick = document.getElementById('mx-quick');
  const deep = document.getElementById('mx-deep');
  const items = {
    tech:{
      easy:['Ù…Ø±ÙˆØ± Û³ Ø±ÛŒÙ¾ÙˆÛŒ Ø¨Ø±ØªØ± GitHub','Ø­Ù„ 10 Ù…Ø³Ø¦Ù„Ù‡ Leet Ø³Ø§Ø¯Ù‡'],
      quick:['Ù†Ù…ÙˆÙ†Ù‡ API Ú©ÙˆÚ†Ú© Ø¨Ø§ Ù…Ø³ØªÙ†Ø¯Ø§Øª','Ø¯ÛŒÙ¾Ù„ÙˆÛŒ ÛŒÚ© Ø³Ø±ÙˆÛŒØ³ Ú©ÙˆÚ†Ú©'],
      deep:['Ø¯ÙˆØ±Ù‡ ØªØ®ØµØµÛŒ 40 Ø³Ø§Ø¹ØªÙ‡','Ø³Ø§Ø®Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ù¾Ø±ØªÙÙˆÛŒ Ø¨Ø§ ØªØ³Øª']
    },
    market:{
      easy:['ØªØ­Ù„ÛŒÙ„ Û³ Ø±Ù‚ÛŒØ¨ Ø¨Ø§ Ø¬Ø¯ÙˆÙ„ Ø³Ø§Ø¯Ù‡','Ø³Ø§Ø®Øª Ù¾Ø±Ø³Ø´Ù†Ø§Ù…Ù‡ Û¸ Ø³ÙˆØ§Ù„ÛŒ'],
      quick:['ØµÙØ­Ù‡ Ù„Ù†Ø¯ÛŒÙ†Ú¯ Ùˆ A/B Ø³Ø§Ø¯Ù‡','Ú©Ù…Ù¾ÛŒÙ† Ú©ÙˆÚ†Ú© Ø§ÛŒÙ…ÛŒÙ„ 50 Ù†ÙØ±'],
      deep:['Case Study Ú©Ø§Ù…Ù„ Ù…Ø´ØªØ±ÛŒ','Roadmap Ø³Ù‡â€ŒÙ…Ø§Ù‡Ù‡ Ù…Ø­ØµÙˆÙ„']
    },
    people:{
      easy:['Ø¨Ù‡Ø¨ÙˆØ¯ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ LinkedIn','Ù¾ÛŒØ§Ù… Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø¨Ù‡ 5 Ù†ÙØ±'],
      quick:['Ø­Ø¶ÙˆØ± Ø¯Ø± ÛŒÚ© Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù‡Ø¯ÙÙ…Ù†Ø¯','Ø¬Ù„Ø³Ù‡ coffee chat Ù‡ÙØªÚ¯ÛŒ'],
      deep:['Ø³Ø§Ø®Øª Ú¯Ø±ÙˆÙ‡ Ú©ÙˆÚ†ÛŒÙ†Ú¯ Ù‡Ù…ØªØ§','Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ù†ØªÙˆØ±ÛŒÙ†Ú¯ Ø¯ÙˆØ·Ø±ÙÙ‡']
    },
    ops:{
      easy:['ØªÙ…Ù¾Ù„ÛŒØª Ú©Ø§Ù†Ø¨Ø§Ù† Ø´Ø®ØµÛŒ','Ú†Ú©â€ŒÙ„ÛŒØ³Øª ØªØ­ÙˆÛŒÙ„ Ú©Ø§Ø±'],
      quick:['Ø§ØªÙˆÙ…Ø§Ø³ÛŒÙˆÙ† Ú¯Ø²Ø§Ø±Ø´ Ù‡ÙØªÚ¯ÛŒ','ØªØ¹Ø±ÛŒÙ SLA Ø¯Ø§Ø®Ù„ÛŒ'],
      deep:['Ø¨Ø§Ø²Ø·Ø±Ø§Ø­ÛŒ ÙØ±Ø§ÛŒÙ†Ø¯ Ú©Ù„ÛŒØ¯ÛŒ','Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ OKR Ø³Ù‡â€ŒÙ…Ø§Ù‡Ù‡']
    },
    learn:{
      easy:['ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª Ù…ÙØ§Ù‡ÛŒÙ… Ú©Ù„ÛŒØ¯ÛŒ','Ø®Ù„Ø§ØµÙ‡â€ŒÙ†ÙˆÛŒØ³ÛŒ ÛŒÚ© Ù…Ù‚Ø§Ù„Ù‡'],
      quick:['Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù‡Ø¯Ø§ÛŒØªâ€ŒØ´Ø¯Ù‡ Ø¨Ø§ Ø¯ÙˆØ³Øª','Ù…Ø±ÙˆØ± ÙˆÛŒØ¯Ø¦ÙˆÙ‡Ø§ÛŒ Ù…Ù†ØªØ®Ø¨'],
      deep:['Ù¾Ø±ÙˆÚ˜Ù‡ Ù¾Ú˜ÙˆÙ‡Ø´ÛŒ Ú©ÙˆÚ†Ú©','Ù†Ú¯Ø§Ø±Ø´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ÙÙ†ÛŒ Ø¨Ù„Ù†Ø¯']
    },
    brand:{
      easy:['Ø±Ø²ÙˆÙ…Ù‡ ÛŒÚ©â€ŒØµÙØ­Ù‡â€ŒØ§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²','Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø­Ø¶ÙˆØ± Ø¢Ù†Ù„Ø§ÛŒÙ†'],
      quick:['Ø³Ø±ÛŒ 3 Ù¾Ø³Øª ØªØ®ØµØµÛŒ','ÛŒÚ© Ø³Ø®Ù†Ø±Ø§Ù†ÛŒ Ú©ÙˆØªØ§Ù‡ Ø¶Ø¨Ø·â€ŒØ´Ø¯Ù‡'],
      deep:['ÙˆØ¨â€ŒØ³Ø§ÛŒØª Ø´Ø®ØµÛŒ Ùˆ Ù†Ù…ÙˆÙ†Ù‡â€ŒÚ©Ø§Ø±','Ø®Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡']
    }
  }[topDomain] || {easy:[],quick:[],deep:[]};

  const cap = (arr)=>arr.map(x=>`<div>â€¢ ${x}</div>`).join('');
  easy.innerHTML = cap(items.easy);
  quick.innerHTML = cap(items.quick);
  deep.innerHTML = cap(items.deep);
}

// ØªØ­Ù„ÛŒÙ„ Ø¢ÛŒÙ†Ø¯Ù‡ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ù‡Ø§
function renderFutureAnalysis(profile, decisionKey, trendKeys, domainW){
  const box = document.getElementById('futureAnalysis');
  const horizon = profile.horizon;
  const riskTol = profile.risk;
  const topDomain = Object.entries(domainW).sort((a,b)=>b[1]-a[1])[0][0];
  const domainLabel = DOMAINS.find(d=>d.id===topDomain)?.label || '';

  const trendNames = trendKeys.map(id=>TRENDS.find(t=>t.id===id)?.name).filter(Boolean).join('ØŒ ') || 'â€”';

  let html = `<p>Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ ØªØµÙ…ÛŒÙ… Â«${decisionKey||'â€”'}Â» Ùˆ Ø§ÙÙ‚ ${horizon} Ù…Ø§Ù‡Ù‡ØŒ Ù…Ø³ÛŒØ± Ø¢ÛŒÙ†Ø¯Ù‡â€ŒÛŒ ØªÙˆ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù‡Ù…â€ŒÙ¾ÙˆØ´Ø§Ù†ÛŒ Ø±Ø§ Ø¨Ø§ Ø­ÙˆØ²Ù‡â€ŒÛŒ <strong>${domainLabel}</strong> Ø¯Ø§Ø±Ø¯. Ø±ÙˆÙ†Ø¯Ù‡Ø§ÛŒ Ù…Ù†ØªØ®Ø¨ (${trendNames}) Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø§Ø²Ù‡ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ø§Ø«Ø± Ø±Ø§ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø¯Ø§Ø´Øª.</p>`;

  const recs = [
    {
      text: 'Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø±ÙˆÛŒ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ú©Ù…Ù„ Ø­ÙˆØ²Ù‡ ØºØ§Ù„Ø¨',
      reason: `Ø¨Ø± Ø§Ø³Ø§Ø³ Ú¯Ø²Ø§Ø±Ø´ ${SOURCES.find(s=>s.domain===topDomain)?.name||'Ø§Ù†Ø¯ÛŒØ´Ú©Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø±'}ØŒ ØªØ±Ú©ÛŒØ¨ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø¨Ø§ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¸Ù‡ÙˆØ± Ø§ÛŒÙ† Ø­ÙˆØ²Ù‡ØŒ Ø¨Ø§Ø²Ø¯Ù‡ÛŒ Ø±Ø§ ØªØ§ Û³Û°Ùª Ø§ÙØ²Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.`
    },
    {
      text: 'Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¨Ú©Ù‡ Ø§Ø±ØªØ¨Ø§Ø·ÛŒ Ø¯Ø± Ø¨Ø§Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù‡Ø¯Ù',
      reason: `Ø¯Ø± Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ø¨Ø§ Ø±ÛŒØ³Ú© ${riskTol==='high'?'Ø¨Ø§Ù„Ø§':'Ù…ØªÙˆØ³Ø·/Ú©Ù…'}ØŒ Ø´Ø¨Ú©Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø²ÙˆØ¯Ù‡Ù†Ú¯Ø§Ù… ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ ØªØµÙ…ÛŒÙ… Ø±Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.`
    },
    {
      text: 'Ù¾Ø§ÛŒØ´ Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±Ùˆ',
      reason: `Ø¨Ø§ Ø±ØµØ¯ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ ØªØ±Ù†Ø¯Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒØŒ Ø§Ù…Ú©Ø§Ù† ÙˆØ§Ú©Ù†Ø´ Ø³Ø±ÛŒØ¹ Ø¨Ù‡ ØªØºÛŒÛŒØ±Ø§Øª ÙØ±Ø§Ù‡Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.`
    }
  ];

  recs.forEach(r=>{
    html += `<div class="rec">ğŸ’¡ ${r.text}<div class="reason">${r.reason}</div></div>`;
  });
  box.innerHTML = html;
}

// Ø±Ù†Ø¯Ø± KPI
function renderKPI(ctx){
  const {scores, feas, riskAdj, trendAlign} = ctx;
  const top = Object.entries(scores).sort((a,b)=>b[1]-a[1])[0];
  const topLabel = DOMAINS.find(d=>d.id===top[0])?.label || 'â€”';
  kpiDomainEl.textContent = topLabel;
  kpiRiskEl.textContent = riskAdj<0.4?'Ù¾Ø§ÛŒÛŒÙ†':(riskAdj<0.7?'Ù…ØªÙˆØ³Ø·':'Ø¨Ø§Ù„Ø§');
  kpiFeasBar.style.width = Math.round(feas*100)+'%';
  kpiTrendBar.style.width = Math.round(trendAlign*100)+'%';
  kpiTrendBar.className = trendAlign<0.33?'neutral':(trendAlign<0.66?'neutral':'');
}

// Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø§ØµÙ„ÛŒ
function runAll(){
  statusEl.textContent='Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡â€¦';
  const ctx = computeScores();

  // Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§
  const warnings = buildAlerts(ctx);
  alertsEl.innerHTML = warnings.length
    ? warnings.map(w=>`<div class="alert ${w.lvl}">âš ï¸ ${w.text}</div>`).join('')
    : `<div class="alert">Ù‡Ù…Ù‡â€ŒÚ†ÛŒØ² Ø¨Ø§Ø«Ø¨Ø§Øª Ø¨Ù‡ Ù†Ø¸Ø± Ù…ÛŒâ€ŒØ±Ø³Ø¯Ø› Ø§Ø¬Ø±Ø§ÛŒ Ù…Ù†Ø¸Ù… Ø±Ø§ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡.</div>`;

  // Ø¬Ø¯ÙˆÙ„ Ø§Ù…ØªÛŒØ§Ø²
  renderScores(ctx.scores, ctx.mult, ctx.domainW, ctx.skillFit);

  // KPI
  renderKPI(ctx);

  // ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§
  const topDomain = Object.entries(ctx.scores).sort((a,b)=>b[1]-a[1])[0][0];
  const list = buildRecs(topDomain, ctx.profile);
  recsEl.innerHTML = list.map(i=>`<div class="recItem"><strong>â€¢ ${i.title}</strong><div class="why">${i.why}</div></div>`).join('');

  // Ù…Ø§ØªØ±ÛŒØ³
  renderMatrix(topDomain, ctx.profile);

  // ØªØ­Ù„ÛŒÙ„ Ø¢ÛŒÙ†Ø¯Ù‡
  renderFutureAnalysis(
    { horizon: Number(horizonEl.value), risk: riskEl.value },
    decisionEl.value,
    Array.from(selectedTrends),
    ctx.domainW
  );

  statusEl.textContent='Ø¢Ù…Ø§Ø¯Ù‡';
}

// ØªØ¹Ø§Ù…Ù„Ø§Øª
document.getElementById('run').addEventListener('click', runAll);
[decisionEl, horizonEl, riskEl, skillsEl, hoursEl, budgetEl].forEach(el=>{
  el.addEventListener('change', ()=>{ /* Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªÙ†Ø¨Ù„Ø› ÙÙ‚Ø· Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ø§Ù…Ù„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… */ });
});
// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÙˆÙ„ÛŒÙ‡
runAll();
</script>
</body>
</html>
