<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¢ÛŒÙ†Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡ X â€” Ù†Ø³Ø®Ù‡ MVP</title>
  <style>
    :root{
      --bg:#0b0f14; --bg2:#0f1520; --glass:rgba(255,255,255,0.06);
      --text:#e9efff; --muted:#9fb0cc; --accent:#7ee787; --accent2:#7aa2f7; --warn:#ffb86b; --risk:#ff6b6b;
      --chip:#1c2433; --chipText:#cfe3ff; --card:#0f1722; --border:rgba(255,255,255,0.12);
      --good:#27c498; --neutral:#b5c2d9; --bad:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: IRANSans, Segoe UI, Roboto, sans-serif;
      color:var(--text); background: radial-gradient(1200px 600px at 70% -10%, #162033, #0b0f14 60%) fixed;
      overflow-x:hidden;
    }
    /* Starfield canvas background */
    #bgCanvas{position:fixed; inset:0; z-index:-1; filter: saturate(110%) brightness(110%)}

    header{
      display:flex; align-items:center; justify-content:space-between;
      padding:20px 24px; position:sticky; top:0; background:linear-gradient(180deg, rgba(11,15,20,0.9), rgba(11,15,20,0.6) 60%, transparent);
      backdrop-filter: blur(6px); border-bottom:1px solid var(--border); z-index:2;
    }
    .brand{display:flex; gap:12px; align-items:center}
    .logo{
      width:34px;height:34px;border-radius:10px; background:
        radial-gradient(80% 80% at 30% 30%, #7ee78744, transparent 70%),
        linear-gradient(135deg, #24344a, #141c29);
      border:1px solid var(--border); box-shadow:0 0 30px #7ee78722 inset, 0 0 12px #7ee78722;
    }
    h1{font-size:18px; margin:0; letter-spacing:0.3px}
    .header-actions{display:flex; gap:8px}
    .btn{
      padding:10px 14px; border:1px solid var(--border); border-radius:10px; color:var(--text);
      background: linear-gradient(180deg, #172033, #121a28); cursor:pointer;
      transition: all .2s ease; font-size:14px;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 6px 20px rgba(0,0,0,0.25)}
    .btn.primary{border-color:#2a7b5f; background:linear-gradient(180deg, #1a3b34, #112822); color:#aef7d3}
    .btn.ghost{background:transparent}
    .container{max-width:1180px; margin:16px auto 80px; padding:0 20px}
    .grid{
      display:grid; grid-template-columns: 340px 1fr; gap:16px;
    }
    @media (max-width: 980px){ .grid{grid-template-columns: 1fr} }

    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border:1px solid var(--border); border-radius:16px; padding:16px 16px 14px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.06);
    }
    .panel h2{font-size:16px; margin:0 0 10px 0; color:#cfe3ff}
    .panel p{color:var(--muted); margin:8px 0 12px 0; line-height:1.7}
    .field{margin:10px 0}
    .field label{display:block; color:#cfe3ff; font-size:13px; margin-bottom:6px}
    .input, select, textarea{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border);
      background:#0e1420; color:var(--text); outline:none; transition:border .2s ease;
    }
    .row{display:flex; gap:10px}
    .row .col{flex:1}
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{
      border:1px solid var(--border); background:var(--chip); color:var(--chipText);
      font-size:12px; padding:6px 10px; border-radius:999px; display:inline-flex; align-items:center; gap:6px
    }
    .chip .dot{width:7px; height:7px; border-radius:999px; background:var(--accent); box-shadow:0 0 10px var(--accent)}
    .muted{color:var(--muted)}
    .section{margin-top:16px}
    .kpi{display:flex; gap:10px; flex-wrap:wrap}
    .kpi .card{
      flex:1 1 160px; background:linear-gradient(180deg, #0e1420, #0b1018);
      border:1px solid var(--border); border-radius:14px; padding:12px
    }
    .kpi .title{font-size:12px; color:#b7c7e8; margin-bottom:6px}
    .kpi .value{font-size:22px; font-weight:700}
    .kpi .trend{font-size:12px}
    .good{color:var(--good)} .bad{color:var(--bad)} .neutral{color:var(--neutral)}

    /* Radar + uncertainty */
    .viz{display:grid; grid-template-columns: 1.2fr 1fr; gap:12px}
    @media (max-width: 980px){ .viz{grid-template-columns: 1fr} }
    .canvasWrap{position:relative; background:linear-gradient(180deg, rgba(15,21,32,0.8), rgba(10,14,22,0.6)); border:1px solid var(--border); border-radius:14px; padding:8px}
    #radar{width:100%; height:380px}
    .legend{display:flex; gap:10px; flex-wrap:wrap; margin-top:8px}
    .legend .chip{background:#0e1726}
    .why{
      background: linear-gradient(180deg, #0e1522, #0c111b);
      border:1px solid var(--border); border-radius:14px; padding:12px;
      display:flex; flex-direction:column; gap:10px; max-height:420px; overflow:auto
    }
    .why h3{margin:0 0 2px 0; font-size:14px; color:#cfe3ff}
    .why .reason{display:flex; align-items:flex-start; gap:10px; border-bottom:1px dashed var(--border); padding-bottom:8px}
    .why .reason:last-child{border-bottom:none}
    .bar{height:6px; background:#122036; border-radius:8px; overflow:hidden}
    .bar > span{display:block; height:100%; background: linear-gradient(90deg, #7ee787, #7aa2f7)}
    .why .srcs{display:flex; flex-wrap:wrap; gap:8px}
    .why .srcs .chip{background:#101a2b}

    /* Timeline */
    .timeline{background:linear-gradient(180deg, #0e1522, #0c111b); border:1px solid var(--border); border-radius:14px; padding:12px}
    .timeline svg{width:100%; height:140px}
    .tick text{fill:#a9bfde; font-size:12px}

    /* Actions */
    .actions{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}
    @media (max-width: 820px){ .actions{grid-template-columns:1fr} }
    .actionCard{
      background:linear-gradient(180deg, #0f1726, #0c131f);
      border:1px solid var(--border); border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:8px
    }
    .pill{font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); color:#bcd2f0; display:inline-flex; gap:6px; align-items:center}
    .impact{color:#aef7d3} .difficulty{color:#ffd28b}
    .foot{display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:6px}

    /* Footer */
    footer{margin:30px 0 60px; color:#89a1c5; font-size:12px; text-align:center}
    .toggle{
      display:inline-flex; align-items:center; gap:8px; font-size:13px; color:#cfe3ff; cursor:pointer
    }
    .toggle input{accent-color:#7ee787; width:18px; height:18px}
    .hint{font-size:12px; color:#9fb0cc}

    /* Light theme */
    body.light{
      --bg:#f7fbff; --bg2:#eef5ff; --glass:rgba(0,0,0,0.05); --text:#0d1b2a; --muted:#3f5877;
      --chip:#e7eefc; --chipText:#0d1b2a; --card:#f0f6ff; --border:rgba(0,0,0,0.12);
      --accent:#0ea5a5; --accent2:#2563eb; --warn:#f59e0b; --risk:#ef4444;
      --good:#059669; --neutral:#64748b; --bad:#ef4444;
      background: radial-gradient(1200px 600px at 70% -10%, #e6f1ff, #f7fbff 60%) fixed;
    }
    body.light #bgCanvas{filter: none}
  </style>
</head>
<body>
  <canvas id="bgCanvas"></canvas>

  <header>
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Ø¢ÛŒÙ†Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡ X â€” Ù†Ø³Ø®Ù‡ MVP</h1>
        <div class="muted" style="font-size:12px">Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒ Ø¨Ø§ Ø´ÙˆØ§Ù‡Ø¯ Ø§Ù†Ø¯ÛŒØ´Ú©Ø¯Ù‡â€ŒÙ‡Ø§</div>
      </div>
    </div>
    <div class="header-actions">
      <button id="saveBtn" class="btn">Ø°Ø®ÛŒØ±Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆ</button>
      <button id="exportBtn" class="btn">Ø®Ø±ÙˆØ¬ÛŒ PDF</button>
      <label class="toggle">
        <input id="themeToggle" type="checkbox"/> Ø­Ø§Ù„Øª Ø±ÙˆØ´Ù†
      </label>
    </div>
  </header>

  <div class="container">
    <div class="grid">
      <!-- Left: Inputs and source chips -->
      <div class="panel">
        <h2>Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ùˆ ØªØµÙ…ÛŒÙ…</h2>
        <div class="field">
          <label>Ù‡Ø¯Ù ØªØµÙ…ÛŒÙ…</label>
          <select id="decision">
            <option value="career">ØªØºÛŒÛŒØ± Ù…Ø³ÛŒØ± Ø´ØºÙ„ÛŒ</option>
            <option value="startup">Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§Ø³ØªØ§Ø±ØªØ§Ù¾</option>
            <option value="invest">Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ø®ØµÛŒ</option>
            <option value="relocate">Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ/Ù…Ù‡Ø§Ø¬Ø±Øª</option>
            <option value="learn">ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ù‡Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯</option>
          </select>
        </div>
        <div class="row">
          <div class="col field">
            <label>ØªØ­Ù…Ù„ Ø±ÛŒØ³Ú©</label>
            <select id="risk">
              <option value="low">Ù¾Ø§ÛŒÛŒÙ†</option>
              <option value="mid" selected>Ù…ØªÙˆØ³Ø·</option>
              <option value="high">Ø¨Ø§Ù„Ø§</option>
            </select>
          </div>
          <div class="col field">
            <label>Ø§ÙÙ‚ Ø²Ù…Ø§Ù†ÛŒ</label>
            <select id="horizon">
              <option value="6">Û¶ Ù…Ø§Ù‡</option>
              <option value="12" selected>Û±Û² Ù…Ø§Ù‡</option>
              <option value="24">Û²Û´ Ù…Ø§Ù‡</option>
              <option value="36">Û³Û¶ Ù…Ø§Ù‡</option>
            </select>
          </div>
        </div>
        <div class="field">
          <label>Ø²Ù…ÛŒÙ†Ù‡/Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ</label>
          <input id="skills" class="input" placeholder="Ù…Ø«Ø§Ù„: Data, AI, Ø§Ù†Ø±Ú˜ÛŒ Ù¾Ø§Ú©ØŒ Ø·Ø±Ø§Ø­ÛŒ Ù…Ø­ØµÙˆÙ„"/>
        </div>
        <div class="field">
          <label>ØªØ±Ù†Ø¯Ù‡Ø§ÛŒ Ù…Ø¯Ù†Ø¸Ø±</label>
          <div class="chips" id="trendChips">
            <!-- generated -->
          </div>
          <div class="hint">ØªØ±Ù†Ø¯Ù‡Ø§ Ø±Ø§ Ø±ÙˆØ´Ù†/Ø®Ø§Ù…ÙˆØ´ Ú©Ù† ØªØ§ Ø§Ø«Ø±Ø´Ø§Ù† Ø¨Ø± Ø³Ù†Ø§Ø±ÛŒÙˆ Ùˆ Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒ.</div>
        </div>
        <div class="section">
          <h2>Ù…Ù†Ø§Ø¨Ø¹ Ùˆ Ø§Ù†Ø¯ÛŒØ´Ú©Ø¯Ù‡â€ŒÙ‡Ø§</h2>
          <p class="muted">Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ Ø§Ø² Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒØ§ÛŒ Ø§Ø² Ø§Ù†Ø¯ÛŒØ´Ú©Ø¯Ù‡â€ŒÙ‡Ø§/Ù…Ø±Ø§Ú©Ø² Ù¾Ú˜ÙˆÙ‡Ø´ÛŒ Ø§Ù„Ù‡Ø§Ù… Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯. Ø¯Ø± Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„ØŒ ÙˆØ²Ù†â€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÙˆØ¶ÙˆØ¹ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p>
          <div class="chips" id="sourceChips">
            <!-- 30+ sources -->
          </div>
        </div>
      </div>

      <!-- Right: Visualization and outputs -->
      <div class="panel">
        <h2>Ø¬Ù…Ø¹â€ŒØ¨Ù†Ø¯ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ</h2>
        <div class="kpi">
          <div class="card">
            <div class="title">Ø´Ø§Ø®Øµ ÙØ±ØµØª</div>
            <div id="oppVal" class="value">â€”</div>
            <div id="oppTrend" class="trend good">â€”</div>
          </div>
          <div class="card">
            <div class="title">Ø±ÛŒØ³Ú© Ø³ÛŒØ³ØªÙ…ÛŒ</div>
            <div id="riskVal" class="value">â€”</div>
            <div id="riskNote" class="trend bad">â€”</div>
          </div>
          <div class="card">
            <div class="title">Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª</div>
            <div id="uncVal" class="value">â€”</div>
            <div class="trend neutral">Ù‡Ø±Ú†Ù‡ Ø¨Ø§Ù„Ø§ØªØ±ØŒ Ø¨Ø§Ø²Ù‡ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù¾Ù‡Ù†â€ŒØªØ±</div>
          </div>
        </div>

        <div class="section viz">
          <div class="canvasWrap">
            <canvas id="radar"></canvas>
            <div class="legend">
              <span class="chip"><span class="dot"></span> Ø§Ù…ØªÛŒØ§Ø²</span>
              <span class="chip" style="--accent:#ffd28b"><span class="dot" style="background:#ffd28b; box-shadow:0 0 10px #ffd28b"></span> Ø¨Ø§Ù†Ø¯ Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª</span>
            </div>
          </div>
          <div class="why">
            <h3>Ú†Ø±Ø§ Ø§ÛŒÙ† Ù†ØªÛŒØ¬Ù‡ØŸ</h3>
            <div id="whyList">
              <!-- reasons -->
            </div>
            <div>
              <div class="muted" style="margin:4px 0 6px">Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø¤Ø«Ø±:</div>
              <div class="srcs" id="whySources"></div>
            </div>
          </div>
        </div>

        <div class="section timeline">
          <h2>Ù†Ù‚Ø´Ù‡ Ø²Ù…Ø§Ù† 2025â€“2032</h2>
          <svg id="timelineSvg" viewBox="0 0 900 140" preserveAspectRatio="xMidYMid meet"></svg>
        </div>

        <div class="section">
          <h2>Ú¯Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ</h2>
          <div class="actions" id="actions">
            <!-- 30/90/180 -->
          </div>
        </div>
      </div>
    </div>
    <footer>
      Ù†Ø³Ø®Ù‡ MVP Ù†Ù…Ø§ÛŒØ´ÛŒ. ÙˆØ²Ù†â€ŒØ¯Ù‡ÛŒ Ù…Ù†Ø§Ø¨Ø¹ØŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡ Ùˆ ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§ÛŒ ØªØ®ØµØµÛŒ Ù‚Ø§Ø¨Ù„ Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø± Ú¯Ø§Ù… Ø¨Ø¹Ø¯ÛŒ.
    </footer>
  </div>

  <script>
    // ---------------------------
    // Data: Trends and Sources
    // ---------------------------
    const TRENDS = [
      { id:'ai', name:'Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù…ÙˆÙ„Ø¯', risk:0.2, opp:0.35, unc:0.15 },
      { id:'green', name:'Ú¯Ø°Ø§Ø± Ø³Ø¨Ø² Ùˆ Ú©Ø±Ø¨Ù†â€ŒØµÙØ±', risk:0.18, opp:0.28, unc:0.14 },
      { id:'geo', name:'Ø±ÛŒØ³Ú© Ú˜Ø¦ÙˆÙ¾Ù„ÛŒØªÛŒÚ©', risk:0.35, opp:-0.05, unc:0.22 },
      { id:'supply', name:'Ø¨Ø§Ø²Ø¢Ø±Ø§ÛŒÛŒ Ø²Ù†Ø¬ÛŒØ±Ù‡ ØªØ£Ù…ÛŒÙ†', risk:0.22, opp:0.18, unc:0.12 },
      { id:'aging', name:'Ø³Ø§Ù„Ù…Ù†Ø¯ÛŒ Ø¬Ù…Ø¹ÛŒØª', risk:0.25, opp:0.05, unc:0.1 },
      { id:'bio', name:'Ù‡Ù…Ú¯Ø±Ø§ÛŒÛŒ Ø¨ÛŒÙˆ/Ø¯ÛŒØ¬ÛŒØªØ§Ù„', risk:0.15, opp:0.22, unc:0.12 },
      { id:'cyber', name:'Ø§Ù…Ù†ÛŒØª Ø³Ø§ÛŒØ¨Ø±ÛŒ', risk:0.2, opp:0.12, unc:0.12 },
      { id:'energy', name:'Ø§Ù†Ø±Ú˜ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ùˆ', risk:0.17, opp:0.25, unc:0.12 },
      { id:'urban', name:'Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯', risk:0.12, opp:0.14, unc:0.08 },
      { id:'fin', name:'ÙÛŒÙ†â€ŒØªÚ©/Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„', risk:0.22, opp:0.16, unc:0.15 },
    ];

    const SOURCES = [
      'European Commission JRC Strategic Foresight',
      'OECD Strategic Foresight',
      'World Economic Forum',
      'Brookings Institution',
      'RAND Corporation',
      'Chatham House (RIIA)',
      'CSIS',
      'Carnegie Endowment for International Peace',
      'Atlantic Council',
      'Council on Foreign Relations (CFR)',
      'Peterson Institute for International Economics (PIIE)',
      'Bruegel',
      'CEPS (Centre for European Policy Studies)',
      'SWP (German Institute for International and Security Affairs)',
      'Bertelsmann Stiftung',
      'Kiel Institute (IfW Kiel)',
      'DIW Berlin',
      'Clingendael Institute',
      'IFRI (Institut franÃ§ais des relations internationales)',
      'IISS (International Institute for Strategic Studies)',
      'SIPRI',
      'GMF (German Marshall Fund)',
      'MERICS',
      'Lowy Institute',
      'ASPI (Australian Strategic Policy Institute)',
      'NBR (The National Bureau of Asian Research)',
      'Hoover Institution',
      'AEI (American Enterprise Institute)',
      'Cato Institute',
      'Heritage Foundation',
      'Urban Institute',
      'Nesta',
      'Demos',
      'Institute for the Future (IFTF)',
      'Oxford Martin School',
      'Fraunhofer ISI',
      'Copenhagen Institute for Futures Studies (CIFS)',
      'McKinsey Global Institute (MGI)',
      'EPRS (European Parliamentary Research Service)',
      'Carnegie Europe'
    ];

    // ---------------------------
    // UI Setup
    // ---------------------------
    const trendChips = document.getElementById('trendChips');
    const sourceChips = document.getElementById('sourceChips');

    const selectedTrends = new Set(['ai','green','geo','supply']); // defaults

    function renderTrendChips(){
      trendChips.innerHTML = '';
      TRENDS.forEach(t=>{
        const on = selectedTrends.has(t.id);
        const el = document.createElement('span');
        el.className = 'chip';
        el.style.borderColor = on ? '#2a7b5f' : 'var(--border)';
        el.style.boxShadow = on ? '0 0 18px rgba(126,231,135,0.15) inset' : 'none';
        el.style.cursor = 'pointer';
        el.innerHTML = `<span class="dot" style="background:${on?'#7ee787':'#6b7280'}; box-shadow:0 0 10px ${on?'#7ee787':'#6b728033'}"></span>${t.name}`;
        el.onclick = ()=>{ if(on) selectedTrends.delete(t.id); else selectedTrends.add(t.id); renderTrendChips(); recompute(); };
        trendChips.appendChild(el);
      });
    }

    function renderSourceChips(){
      sourceChips.innerHTML = '';
      SOURCES.forEach((s,i)=>{
        const el = document.createElement('span');
        el.className = 'chip';
        el.title = s;
        el.innerHTML = `<span class="dot" style="background:${i%2? '#7aa2f7':'#7ee787'}"></span>${s}`;
        sourceChips.appendChild(el);
      });
    }

    renderTrendChips();
    renderSourceChips();

    // ---------------------------
    // Radar Chart
    // ---------------------------
    const radar = document.getElementById('radar');
    const rctx = radar.getContext('2d');
    let dpi = window.devicePixelRatio || 1;
    function resizeRadar(){
      const rect = radar.getBoundingClientRect();
      radar.width = rect.width * dpi;
      radar.height = rect.height * dpi;
      rctx.setTransform(dpi,0,0,dpi,0,0);
      drawRadar();
    }
    window.addEventListener('resize', resizeRadar);

    const DIMENSIONS = [
      { id:'career', label:'Ø´ØºÙ„ Ùˆ Ù…Ù‡Ø§Ø±Øª' },
      { id:'wealth', label:'Ø³Ø±Ù…Ø§ÛŒÙ‡ Ùˆ Ø«Ø±ÙˆØª' },
      { id:'well', label:'Ø±ÙØ§Ù‡ Ùˆ Ø³Ù„Ø§Ù…Øª' },
      { id:'impact', label:'Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ùˆ Ø§Ø«Ø±' },
      { id:'res', label:'ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ' },
    ];

    let scores = { career:0.6, wealth:0.55, well:0.58, impact:0.62, res:0.57 };
    let bands =  { career:0.12, wealth:0.1, well:0.11, impact:0.09, res:0.1 };

    function drawRadar(){
      const w = radar.width/dpi, h = radar.height/dpi;
      rctx.clearRect(0,0,w,h);
      const cx = w/2, cy = h/2 + 8;
      const radius = Math.min(w,h)*0.36;

      // grid
      rctx.save();
      rctx.strokeStyle = 'rgba(180,200,240,0.25)';
      rctx.lineWidth = 1;
      for(let g=1; g<=4; g++){
        rctx.beginPath();
        const r = radius * (g/4);
        for(let i=0;i<DIMENSIONS.length;i++){
          const a = (Math.PI*2)*i/DIMENSIONS.length - Math.PI/2;
          const x = cx + r*Math.cos(a), y = cy + r*Math.sin(a);
          i===0 ? rctx.moveTo(x,y) : rctx.lineTo(x,y);
        }
        rctx.closePath(); rctx.stroke();
      }
      // axes and labels
      DIMENSIONS.forEach((d,i)=>{
        const a = (Math.PI*2)*i/DIMENSIONS.length - Math.PI/2;
        const x = cx + radius*Math.cos(a), y = cy + radius*Math.sin(a);
        rctx.beginPath(); rctx.moveTo(cx,cy); rctx.lineTo(x,y); rctx.strokeStyle='rgba(180,200,240,0.15)'; rctx.stroke();
        // label
        const lx = cx + (radius+18)*Math.cos(a), ly = cy + (radius+18)*Math.sin(a);
        rctx.fillStyle = '#cfe3ff'; rctx.font = '12px sans-serif'; rctx.textAlign = Math.cos(a)>0.2? 'left' : (Math.cos(a)<-0.2? 'right':'center');
        rctx.fillText(d.label, lx, ly);
      });

      // uncertainty band
      rctx.beginPath();
      DIMENSIONS.forEach((d,i)=>{
        const a = (Math.PI*2)*i/DIMENSIONS.length - Math.PI/2;
        const r = radius * Math.min(1, Math.max(0, scores[d.id] + bands[d.id]));
        const x = cx + r*Math.cos(a), y = cy + r*Math.sin(a);
        i===0 ? rctx.moveTo(x,y) : rctx.lineTo(x,y);
      });
      rctx.closePath();
      rctx.fillStyle = 'rgba(255,210,139,0.18)';
      rctx.fill();

      // score polygon
      rctx.beginPath();
      DIMENSIONS.forEach((d,i)=>{
        const a = (Math.PI*2)*i/DIMENSIONS.length - Math.PI/2;
        const r = radius * Math.min(1, Math.max(0, scores[d.id]));
        const x = cx + r*Math.cos(a), y = cy + r*Math.sin(a);
        i===0 ? rctx.moveTo(x,y) : rctx.lineTo(x,y);
      });
      rctx.closePath();
      const grad = rctx.createLinearGradient(0,0,w,h);
      grad.addColorStop(0,'rgba(126,231,135,0.28)');
      grad.addColorStop(1,'rgba(122,162,247,0.28)');
      rctx.fillStyle = grad; rctx.fill();
      rctx.strokeStyle = 'rgba(126,231,135,0.7)';
      rctx.lineWidth = 2; rctx.stroke();

      rctx.restore();
    }
    resizeRadar();

    // ---------------------------
    // Starfield background (Canvas 2D)
    // ---------------------------
    const bg = document.getElementById('bgCanvas');
    const bctx = bg.getContext('2d');
    let stars = [];
    function resizeBg(){
      bg.width = innerWidth * dpi;
      bg.height = innerHeight * dpi;
      bctx.setTransform(dpi,0,0,dpi,0,0);
      stars = Array.from({length: 180}, ()=>({
        x: Math.random()*innerWidth,
        y: Math.random()*innerHeight,
        z: Math.random()*1.2 + 0.2,
        s: Math.random()*1.5 + 0.3
      }));
    }
    function tickBg(time){
      bctx.clearRect(0,0,innerWidth,innerHeight);
      stars.forEach(st=>{
        st.y += st.z*0.15; if(st.y>innerHeight) { st.y=-5; st.x=Math.random()*innerWidth; }
        bctx.fillStyle = `rgba(${180 + st.z*50}, ${210}, 255, ${0.35+st.z*0.4})`;
        bctx.beginPath(); bctx.arc(st.x, st.y, st.s, 0, Math.PI*2); bctx.fill();
      });
      requestAnimationFrame(tickBg);
    }
    resizeBg(); requestAnimationFrame(tickBg);
    addEventListener('resize', resizeBg);

    // ---------------------------
    // Timeline SVG
    // ---------------------------
    function renderTimeline(){
      const svg = document.getElementById('timelineSvg');
      const years = [2025,2026,2027,2028,2029,2030,2031,2032];
      const w = 900, h = 140, pad = 60;
      svg.innerHTML='';
      // axis
      const line = document.createElementNS('http://www.w3.org/2000/svg','line');
      line.setAttribute('x1', pad); line.setAttribute('y1', h/2);
      line.setAttribute('x2', w-pad); line.setAttribute('y2', h/2);
      line.setAttribute('stroke', '#2b3a55'); line.setAttribute('stroke-width','2');
      svg.appendChild(line);

      years.forEach((y,i)=>{
        const x = pad + i*((w-2*pad)/(years.length-1));
        const tick = document.createElementNS('http://www.w3.org/2000/svg','line');
        tick.setAttribute('x1', x); tick.setAttribute('y1', h/2 - 8);
        tick.setAttribute('x2', x); tick.setAttribute('y2', h/2 + 8);
        tick.setAttribute('stroke','#3b5177'); tick.setAttribute('stroke-width','2');
        svg.appendChild(tick);

        const txt = document.createElementNS('http://www.w3.org/2000/svg','text');
        txt.setAttribute('x', x); txt.setAttribute('y', h/2 + 28);
        txt.setAttribute('text-anchor','middle'); txt.setAttribute('class','tick');
        txt.textContent = y;
        svg.appendChild(txt);
      });

      // scenario markers
      const markers = [
        { y:2025, label:'MVP Ù…Ù‡Ø§Ø±Øª/Ù¾Ø±ÙˆØªÙˆØªØ§ÛŒÙ¾', tone:'#7ee787' },
        { y:2026, label:'Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¨Ø§Ø²Ø§Ø±/Ø´Ø¨Ú©Ù‡', tone:'#7aa2f7' },
        { y:2027, label:'Ú¯Ø³ØªØ±Ø´/ØªÙ†ÙˆØ¹â€ŒØ¨Ø®Ø´ÛŒ', tone:'#ffd28b' },
        { y:2029, label:'ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ/Ø±ÛŒØ³Ú© Ú˜Ø¦Ùˆ', tone:'#ffb4b4' },
        { y:2031, label:'Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ø³Ø§Ø²ÛŒ/ESG', tone:'#aef7d3' },
      ];
      markers.forEach(m=>{
        const i = years.indexOf(m.y);
        if(i<0) return;
        const x = pad + i*((w-2*pad)/(years.length-1));
        const cy = 56;
        const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
        c.setAttribute('cx', x); c.setAttribute('cy', cy); c.setAttribute('r','7');
        c.setAttribute('fill', m.tone); c.setAttribute('opacity','0.9');
        svg.appendChild(c);

        const lab = document.createElementNS('http://www.w3.org/2000/svg','text');
        lab.setAttribute('x', x); lab.setAttribute('y', cy - 12);
        lab.setAttribute('text-anchor','middle'); lab.setAttribute('class','tick');
        lab.textContent = m.label;
        svg.appendChild(lab);
      });
    }
    renderTimeline();

    // ---------------------------
    // Scenario logic
    // ---------------------------
    const decisionEl = document.getElementById('decision');
    const riskEl = document.getElementById('risk');
    const horizonEl = document.getElementById('horizon');
    const skillsEl = document.getElementById('skills');

    const oppVal = document.getElementById('oppVal');
    const oppTrend = document.getElementById('oppTrend');
    const riskVal = document.getElementById('riskVal');
    const riskNote = document.getElementById('riskNote');
    const uncVal = document.getElementById('uncVal');

    const whyList = document.getElementById('whyList');
    const whySources = document.getElementById('whySources');
    const actionsEl = document.getElementById('actions');

    function clamp01(x){ return Math.max(0, Math.min(1, x)); }

    function baseByDecision(dec){
      // baseline profiles for different decisions
      switch(dec){
        case 'career': return { career:0.62, wealth:0.55, well:0.60, impact:0.58, res:0.57 };
        case 'startup': return { career:0.58, wealth:0.60, well:0.52, impact:0.64, res:0.55 };
        case 'invest': return { career:0.52, wealth:0.65, well:0.56, impact:0.50, res:0.58 };
        case 'relocate': return { career:0.60, wealth:0.56, well:0.62, impact:0.55, res:0.60 };
        case 'learn': return { career:0.66, wealth:0.54, well:0.60, impact:0.58, res:0.56 };
      }
      return { career:0.58, wealth:0.58, well:0.58, impact:0.58, res:0.58 };
    }

    function computeUncertainty(riskTolerance, horizon, trendSet){
      let u = 0.1 + (horizon/36)*0.12; // longer horizon -> more uncertainty
      if(riskTolerance==='low') u += 0.04;
      if(riskTolerance==='high') u -= 0.02;
      // trends effect
      trendSet.forEach(id=>{
        const t = TRENDS.find(x=>x.id===id);
        if(!t) return;
        u += t.unc * 0.5 / (2 + trendSet.size*0.3);
      });
      return clamp01(u);
    }

    function computeScores(){
      const dec = decisionEl.value;
      const riskTol = riskEl.value;
      const horizon = Number(horizonEl.value);
      const skills = (skillsEl.value || '').toLowerCase();

      // start from baseline by decision
      scores = baseByDecision(dec);
      let opportunity = 0.58, systemicRisk = 0.38;

      // trends contribution
      selectedTrends.forEach(id=>{
        const t = TRENDS.find(x=>x.id===id);
        if(!t) return;
        opportunity += t.opp * 0.42/(1 + selectedTrends.size*0.25);
        systemicRisk += t.risk * 0.50/(1 + selectedTrends.size*0.25);

        // distribute to dimensions heuristically
        scores.career += (t.opp - t.risk*0.15)*0.20;
        scores.wealth += (t.opp - t.risk*0.10)*0.24;
        scores.impact += (t.opp)*0.22;
        scores.res += (0.12 - t.risk*0.18);
        scores.well += (0.08 - t.risk*0.06);
      });

      // skills effect
      const skillMap = [
        { key:['ai','ml','data','Ù‡ÙˆØ´','Ø¯Ø§Ø¯Ù‡'], dim:'career', delta:0.06 },
        { key:['climate','energy','esg','Ø§Ù†Ø±Ú˜ÛŒ','Ø§Ù‚Ù„ÛŒÙ…'], dim:'impact', delta:0.05 },
        { key:['product','design','Ø·Ø±Ø§Ø­ÛŒ','Ù…Ø­ØµÙˆÙ„'], dim:'career', delta:0.03 },
        { key:['security','Ø§Ù…Ù†ÛŒØª','cyber'], dim:'res', delta:0.05 },
        { key:['finance','quant','Ù…Ø§Ù„ÛŒ'], dim:'wealth', delta:0.05 },
      ];
      skillMap.forEach(m=>{
        if(m.key.some(k=>skills.includes(k))){
          scores[m.dim] += m.delta;
          opportunity += m.delta*0.6;
        }
      });

      // risk tolerance scaling
      const riskScale = riskTol==='low'? -0.04 : (riskTol==='high'? +0.03 : 0);
      systemicRisk = clamp01(systemicRisk + riskScale);

      // horizon dampen opportunity for very short horizons
      if(horizon<=6) opportunity -= 0.03;

      // normalize and set bands
      for(const k in scores) scores[k] = clamp01(scores[k]);
      const unc = computeUncertainty(riskTol, horizon, selectedTrends);

      const bandBase = unc*0.22;
      bands = {
        career: bandBase * 0.95,
        wealth: bandBase * 1.00,
        well:   bandBase * 0.9,
        impact: bandBase * 0.85,
        res:    bandBase * 0.95,
      };

      // KPIs
      oppVal.textContent = Math.round(clamp01(opportunity)*100) + '%';
      oppTrend.textContent = opportunity>0.58? 'ØµØ¹ÙˆØ¯ Ù…Ù„Ø§ÛŒÙ…' : 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯';
      oppTrend.className = 'trend ' + (opportunity>0.58? 'good':'neutral');
      riskVal.textContent = Math.round(systemicRisk*100) + '%';
      riskNote.textContent = systemicRisk>0.55? 'Ø±ÛŒØ³Ú© Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ø­Ø¯ Ù†Ø±Ù…Ø§Ù„' : (systemicRisk<0.35? 'Ø±ÛŒØ³Ú© Ú©Ù†ØªØ±Ù„â€ŒØ´Ø¯Ù‡' : 'Ø±ÛŒØ³Ú© Ù…ØªÙˆØ³Ø·');
      riskNote.className = 'trend ' + (systemicRisk>0.55? 'bad' : (systemicRisk<0.35? 'good':'neutral'));
      uncVal.textContent = Math.round(unc*100) + '%';

      drawRadar();
      renderWhy(dec, riskTol, horizon, unc);
      renderActions(dec, riskTol, horizon);
    }

    function renderWhy(dec, riskTol, horizon, unc){
      const reasons = [
        { title:'Ø§Ø«Ø± ØªØ±Ù†Ø¯Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„', detail:`ØªØ±Ú©ÛŒØ¨ ØªØ±Ù†Ø¯Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø¨Ø± ÙØ±ØµØª/Ø±ÛŒØ³Ú© Ø§Ø«Ø± Ú¯Ø°Ø§Ø´ØªÙ‡ Ø§Ø³Øª. Ø§ÙØ²Ø§ÛŒØ´ Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª: ${Math.round(unc*100)}%` , weight:0.34 },
        { title:'ØªÙ†Ø§Ø³Ø¨ ØªØµÙ…ÛŒÙ… Ø¨Ø§ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§', detail:'Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ Ø¨Ø§ ØªØµÙ…ÛŒÙ… Ù…Ø¯Ù†Ø¸Ø± Ù†Ú¯Ø§Ø´Øª Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯Ø› Ø´Ú©Ø§Ùâ€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ù‡Ø¯ÙÙ…Ù†Ø¯ Ø¯Ø± Ú¯Ø§Ù…â€ŒÙ‡Ø§ Ù¾ÙˆØ´Ø´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.', weight:0.26 },
        { title:'Ø§ÙÙ‚ Ø²Ù…Ø§Ù†ÛŒ', detail:`Ø§ÙÙ‚ ${horizon} Ù…Ø§Ù‡Ù‡ Ø¯Ø§Ù…Ù†Ù‡ Ø¨Ø§Ù†Ø¯ Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª.`, weight:0.18 },
        { title:'ØªØ­Ù…Ù„ Ø±ÛŒØ³Ú©', detail:`ØªÙ†Ø¸ÛŒÙ… Ø±ÛŒØ³Ú© ${riskTol==='low'?'Ù…Ø­Ø§ÙØ¸Ù‡â€ŒÚ©Ø§Ø±Ø§Ù†Ù‡':(riskTol==='high'?'ØªÙ‡Ø§Ø¬Ù…ÛŒ':'Ù…ØªØ¹Ø§Ø¯Ù„')} Ø¨Ø± ÙˆØ²Ù†â€ŒØ¯Ù‡ÛŒ Ø§Ø«Ø±Ú¯Ø°Ø§Ø± Ø¨ÙˆØ¯Ù‡ Ø§Ø³Øª.`, weight:0.12 },
        { title:'Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† ØªØ§Ø±ÛŒØ®ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ù…Ø´Ø§Ø¨Ù‡', detail:'Ù¾Ø±ÙˆÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ø³Ùˆ Ø¯Ø± Û²Û´ Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ø²Ø¯ÛŒÚ© Ø¯Ø§Ø´ØªÙ‡â€ŒØ§Ù†Ø¯ (Heuristic).', weight:0.10 },
      ];
      whyList.innerHTML = '';
      reasons.forEach(r=>{
        const row = document.createElement('div');
        row.className = 'reason';
        row.innerHTML = `
          <div style="min-width:8px; height:8px; background:#7ee787; border-radius:50%; margin-top:6px"></div>
          <div style="flex:1">
            <div style="color:#cfe3ff; font-size:13px; margin-bottom:4px">${r.title}</div>
            <div class="muted" style="font-size:12px; margin-bottom:8px">${r.detail}</div>
            <div class="bar"><span style="width:${Math.round(r.weight*100)}%"></span></div>
          </div>
        `;
        whyList.appendChild(row);
      });

      // attach source chips subset (simulate relevance)
      whySources.innerHTML = '';
      const hash = (decisionEl.value + riskTol + horizon).length;
      const take = 14; // show 14 contributing sources
      for(let i=0;i<take;i++){
        const s = SOURCES[(hash + i*3) % SOURCES.length];
        const chip = document.createElement('span');
        chip.className = 'chip';
        chip.innerHTML = `<span class="dot" style="background:${i%3===0?'#7ee787':(i%3===1?'#7aa2f7':'#ffd28b')}"></span>${s}`;
        whySources.appendChild(chip);
      }
    }

    function renderActions(decision, riskTol, horizon){
      const acts = [];
      // 30 days
      acts.push({
        horizon:'Û³Û° Ø±ÙˆØ²Ù‡',
        title: decision==='career' ? 'Ù†Ù…ÙˆÙ†Ù‡â€ŒÚ©Ø§Ø± Ù‡Ø¯ÙÙ…Ù†Ø¯ + Û³ Ú¯ÙØªâ€ŒÙˆÚ¯ÙˆÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ' :
               decision==='startup' ? 'Ù…ØµØ§Ø­Ø¨Ù‡ Û±Û° Ù…Ø´ØªØ±ÛŒ + ÛŒÚ© MVP Ú©Ø§ØºØ°ÛŒ' :
               decision==='invest' ? 'Ø³Ù†Ø¯ Ø®Ø·â€ŒÙ…Ø´ÛŒ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ø®ØµÛŒ (IPS) Û± ØµÙØ­Ù‡â€ŒØ§ÛŒ' :
               decision==='relocate' ? 'ØªØ­Ù„ÛŒÙ„ Û³ Ø´Ù‡Ø± Ù‡Ø¯Ù Ø¨Ø§ Ù…Ø¹ÛŒØ§Ø± Ù‡Ø²ÛŒÙ†Ù‡/Ú©ÛŒÙÛŒØª/Ø´Ø¨Ú©Ù‡' :
               'Ø¯ÙˆØ±Ù‡ Û²Û° Ø³Ø§Ø¹ØªÙ‡ Ù…Ù‡Ø§Ø±Øª Ú©Ù„ÛŒØ¯ÛŒ + ØªÙ…Ø±ÛŒÙ† Ø¹Ù…Ù„ÛŒ',
        impact:'Ø§Ø«Ø±: Ù…ØªÙˆØ³Ø·',
        difficulty:'Ø¯Ø´ÙˆØ§Ø±ÛŒ: Ú©Ù…',
        tip: decision==='startup' ? 'Ø¨Ù‡ Ù…Ø¹ÛŒØ§Ø± Â«Ø¯Ø±Ø¯/ØªÚ©Ø±Ø§Ø±/Ø¨ÙˆØ¯Ø¬Ù‡Â» Ø¨Ø±Ø§ÛŒ Ø§ÙˆÙ„ÙˆÛŒØª Ù…Ø´Ú©Ù„ Ø¨Ú†Ø³Ø¨.' :
             decision==='career' ? 'Û³ Ø´ØºÙ„ Ù‡Ø¯Ù = Û³ Ù†Ù…ÙˆÙ†Ù‡â€ŒÚ©Ø§Ø± Ù…Ø·Ø§Ø¨Ù‚ JD.' :
             'Ù…Ø±Ø­Ù„Ù‡ Ú©ÙˆÚ†Ú© ÙˆÙ„ÛŒ Ù¾ÛŒÙˆØ³ØªÙ‡Ø› Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯ Ø³Ø±ÛŒØ¹ Ø¨Ú¯ÛŒØ±.'
      });
      // 90 days
      acts.push({
        horizon:'Û¹Û° Ø±ÙˆØ²Ù‡',
        title: decision==='career' ? 'Ú¯ÙˆØ§Ù‡ÛŒ Ù…Ø¹ØªØ¨Ø± + Û² Ù¾Ø±ÙˆÚ˜Ù‡ Ù…ØªÙ†â€ŒØ¨Ø§Ø²/Ù…Ø´ØªØ±Ú©' :
               decision==='startup' ? 'MVP ÙˆØ§Ù‚Ø¹ÛŒ + Û³Û° Ú©Ø§Ø±Ø¨Ø± Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ' :
               decision==='invest' ? 'Ø±ÛŒØ³Ú©â€ŒØ³Ù†Ø¬ÛŒ Ù¾Ø±ØªÙÙˆÛŒ + Ø³Ù‚Ù Ø²ÛŒØ§Ù† ØªØ¹Ø±ÛŒÙâ€ŒØ´Ø¯Ù‡' :
               decision==='relocate' ? 'Ø³ÙØ± Ø§Ú©ØªØ´Ø§ÙÛŒ/Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø´Ø¨Ú©Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­Ù„ÛŒ' :
               'Ù¾Ø±ÙˆÚ˜Ù‡ capstone Ø¨Ø§ Ù…Ø±Ø¨ÛŒ/Ù…Ù†ØªÙˆØ±',
        impact:'Ø§Ø«Ø±: Ø¨Ø§Ù„Ø§',
        difficulty:'Ø¯Ø´ÙˆØ§Ø±ÛŒ: Ù…ØªÙˆØ³Ø·',
        tip:'Ø¨Ù‡ ÛŒÚ© Ø´Ø§Ø®Øµ Ù…ÙˆÙÙ‚ÛŒØª ÙˆØ§Ø­Ø¯ Ù…ØªØ¹Ù‡Ø¯ Ø´Ùˆ Ùˆ Ù‡Ø± Ù‡ÙØªÙ‡ Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ú©Ù†.'
      });
      // 180 days
      acts.push({
        horizon:'Û±Û¸Û° Ø±ÙˆØ²Ù‡',
        title: decision==='career' ? 'Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ø± Ù†Ù‚Ø´ Ù‡Ø¯Ù/Ø§Ø±ØªÙ‚Ø§ Ù†Ù‚Ø´ ÙØ¹Ù„ÛŒ' :
               decision==='startup' ? 'Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡ ØªÚ©Ø±Ø§Ø±Ø´ÙˆÙ†Ø¯Ù‡ + Ú†Ø±Ø®Ù‡ Ø³Ø§Ø®Øª/Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ' :
               decision==='invest' ? 'ØªÙ†ÙˆØ¹â€ŒØ¨Ø®Ø´ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ + Ù¾ÙˆØ´Ø´â€ŒØ±ÛŒØ³Ú© Ø­Ø¯Ø§Ù‚Ù„ÛŒ' :
               decision==='relocate' ? 'Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ø¨Ø§ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø§Ù„ÛŒ/Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ' :
               'Ø§Ø±Ø§Ø¦Ù‡ Ø¹Ù…ÙˆÙ…ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ + Ø´Ø¨Ú©Ù‡ Ø­Ø§Ù…ÛŒØ§Ù†',
        impact:'Ø§Ø«Ø±: Ø¨Ø³ÛŒØ§Ø± Ø¨Ø§Ù„Ø§',
        difficulty:'Ø¯Ø´ÙˆØ§Ø±ÛŒ: Ù…ØªÙˆØ³Ø·/Ø¨Ø§Ù„Ø§',
        tip: riskTol==='high' ? 'Ø¢Ø²Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§ÛŒ Ø±ÛŒØ³Ú©â€ŒÙ¾Ø°ÛŒØ± Ø±Ø§ Ø¨Ø§ Ø³Ù‚Ù Ø²ÛŒØ§Ù† Ù…Ø´Ø®Øµ Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯Ù‡.' : 'ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ Ø±Ø§ Ø¨Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø²Ù…Ø§Ù†ÛŒ/Ù…Ø§Ù„ÛŒ ØªÙ‚ÙˆÛŒØª Ú©Ù†.'
      });

      actionsEl.innerHTML = '';
      acts.forEach(a=>{
        const card = document.createElement('div'); card.className='actionCard';
        card.innerHTML = `
          <div class="pill"><span style="width:8px; height:8px; background:#7aa2f7; border-radius:50%"></span>${a.horizon}</div>
          <div style="font-weight:700">${a.title}</div>
          <div class="muted" style="font-size:13px">${a.tip}</div>
          <div class="foot">
            <span class="pill impact">âš¡ ${a.impact}</span>
            <span class="pill difficulty">ğŸ§© ${a.difficulty}</span>
          </div>
        `;
        actionsEl.appendChild(card);
      });
    }

    function recompute(){ computeScores(); }
    decisionEl.onchange = recompute;
    riskEl.onchange = recompute;
    horizonEl.onchange = recompute;
    skillsEl.oninput = ()=>{ // debounce light
      clearTimeout(skillsEl._t); skillsEl._t = setTimeout(recompute, 300);
    }

    recompute();

    // ---------------------------
    // Save / Export / Theme
    // ---------------------------
    const saveBtn = document.getElementById('saveBtn');
    const exportBtn = document.getElementById('exportBtn');
    const themeToggle = document.getElementById('themeToggle');

    // load theme
    const savedTheme = localStorage.getItem('afx_theme');
    if(savedTheme==='light'){ document.body.classList.add('light'); themeToggle.checked = true; }

    themeToggle.addEventListener('change', ()=>{
      document.body.classList.toggle('light', themeToggle.checked);
      localStorage.setItem('afx_theme', themeToggle.checked? 'light':'dark');
    });

    saveBtn.addEventListener('click', ()=>{
      const payload = {
        decision: decisionEl.value,
        risk: riskEl.value,
        horizon: horizonEl.value,
        skills: skillsEl.value,
        trends: Array.from(selectedTrends),
        timestamp: Date.now()
      };
      localStorage.setItem('afx_lastScenario', JSON.stringify(payload));
      saveBtn.textContent = 'Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ“';
      setTimeout(()=> saveBtn.textContent = 'Ø°Ø®ÛŒØ±Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆ', 1500);
    });

    exportBtn.addEventListener('click', ()=>{
      alert('Ø®Ø±ÙˆØ¬ÛŒ PDF Ø¯Ø± Ú¯Ø§Ù… Ø¨Ø¹Ø¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ Print Ø¨Ù‡ PDF Ø®Ø±ÙˆØ¬ÛŒ Ø¨Ú¯ÛŒØ±ÛŒØ¯.');
    });

    // restore last scenario if exists
    const last = localStorage.getItem('afx_lastScenario');
    if(last){
      try{
        const p = JSON.parse(last);
        decisionEl.value = p.decision || decisionEl.value;
        riskEl.value = p.risk || riskEl.value;
        horizonEl.value = p.horizon || horizonEl.value;
        skillsEl.value = p.skills || '';
        selectedTrends.clear(); (p.trends || []).forEach(t=>selectedTrends.add(t));
        renderTrendChips(); recompute();
      }catch(e){}
    }
  </script>
</body>
</html>
