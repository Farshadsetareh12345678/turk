<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¢ÛŒÙ†Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡ X â€” Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --bg1:#0b111a; --bg2:#0e1624; --panel:#0f1726; --chip:#0b1322;
    --text:#eaf1ff; --muted:#9fb0cc; --border:#22304a; --accent:#7ee787; --accent2:#7aa2f7;
    --warn:#ffcd4d; --risk:#ff6b6b; --ok:#00d2a8;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font:15px/1.8 Vazirmatn,Segoe UI,Roboto,Arial;background:
    radial-gradient(1200px 800px at 80% -10%,#1a2642 0%,rgba(11,18,32,0) 70%),linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text)}
  a{color:inherit}
  header{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 16px;background:linear-gradient(180deg,rgba(11,18,32,.92),rgba(11,18,32,.6) 70%,transparent);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
  .brand{display:flex;gap:10px;align-items:center}
  .logo{width:36px;height:36px;border-radius:10px;background:
    radial-gradient(80% 80% at 30% 30%, #7ee78744, transparent 70%),linear-gradient(135deg,#24344a,#141c29);
    border:1px solid var(--border);box-shadow:0 0 28px #7ee78722 inset,0 0 12px #7aa2f722}
  h1{margin:0;font-size:18px}
  .sub{font-size:12px;color:var(--muted)}
  .header-actions{display:flex;gap:8px;align-items:center}
  .btn{background:linear-gradient(180deg,#1e2f4a,#17243a);border:1px solid var(--border);color:var(--text);padding:9px 12px;border-radius:10px;cursor:pointer}
  .btn.primary{background:linear-gradient(180deg,#1a3b34,#112822);border-color:#2a7b5f;color:#aef7d3}
  .btn:hover{transform:translateY(-1px)}
  .toggle{display:inline-flex;align-items:center;gap:6px;font-size:13px}
  .toggle input{accent-color:var(--accent);width:18px;height:18px}

  .container{max-width:1240px;margin:16px auto 60px;padding:0 16px}
  .grid{display:grid;grid-template-columns:360px 1fr;gap:14px}
  @media (max-width:1020px){.grid{grid-template-columns:1fr}}

  .panel{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid var(--border);border-radius:16px;padding:12px 14px;box-shadow:0 8px 30px rgba(0,0,0,.25),inset 0 1px 0 rgba(255,255,255,.06)}
  .panel h2{font-size:16px;margin:0 0 8px 0;color:#cfe3ff}
  .panel p{color:var(--muted);margin:6px 0 10px 0}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .col{flex:1 1 160px}
  .input,select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#0e1420;color:var(--text);outline:none}
  label{display:block;font-size:13px;color:#cfe3ff;margin:8px 0 6px}
  .hint{font-size:12px;color:var(--muted)}
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{border:1px solid var(--border);background:var(--chip);color:#cfe3ff;font-size:12px;padding:6px 10px;border-radius:999px;display:inline-flex;align-items:center;gap:6px;cursor:pointer}
  .chip .dot{width:7px;height:7px;border-radius:999px;background:var(--accent);box-shadow:0 0 10px var(--accent)}
  .kpi{display:flex;gap:10px;flex-wrap:wrap}
  .kcard{flex:1 1 160px;background:#0b1322;border:1px solid var(--border);border-radius:14px;padding:10px}
  .kcard .t{font-size:12px;color:#b7c7e8}
  .progress{height:10px;background:#0f1a2b;border-radius:999px;overflow:hidden;border:1px solid var(--border)}
  .progress > span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#42b883);width:0%}
  .progress.neutral > span{background:linear-gradient(90deg,#7aa2f7,#c7d2fe)}
  .progress.risk > span{background:linear-gradient(90deg,#ff6b6b,#ff9f7a)}
  .alerts{display:flex;flex-direction:column;gap:8px}
  .alert{border:1px solid var(--border);border-left:4px solid var(--warn);background:rgba(255,205,77,.08);padding:8px 10px;border-radius:12px}
  .alert.danger{border-left-color:var(--risk);background:rgba(255,107,107,.08)}
  .alert.ok{border-left-color:var(--ok);background:rgba(0,210,168,.08)}
  .viz{display:grid;grid-template-columns:1.2fr 1fr;gap:12px}
  @media (max-width:1020px){.viz{grid-template-columns:1fr}}
  .canvasWrap{position:relative;background:linear-gradient(180deg,rgba(15,21,32,.8),rgba(10,14,22,.6));border:1px solid var(--border);border-radius:14px;padding:8px}
  #radar{width:100%;height:360px}
  .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
  .legend .chip{background:#0e1726}
  .why{background:linear-gradient(180deg,#0e1522,#0c111b);border:1px solid var(--border);border-radius:14px;padding:10px;display:flex;flex-direction:column;gap:8px;max-height:400px;overflow:auto}
  .why h3{margin:0 0 2px 0;font-size:14px;color:#cfe3ff}
  .reason{display:flex;gap:10px;border-bottom:1px dashed var(--border);padding-bottom:8px}
  .reason:last-child{border-bottom:none}
  .bar{height:6px;background:#122036;border-radius:8px;overflow:hidden}
  .bar > span{display:block;height:100%;background:linear-gradient(90deg,#7ee787,#7aa2f7)}
  .srcs{display:flex;flex-wrap:wrap;gap:8px}
  .timeline{background:linear-gradient(180deg,#0e1522,#0c111b);border:1px solid var(--border);border-radius:14px;padding:10px}
  .timeline svg{width:100%;height:140px}
  .tick text{fill:#a9bfde;font-size:12px}
  .actions{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  @media (max-width:900px){.actions{grid-template-columns:1fr}}
  .actionCard{background:linear-gradient(180deg,#0f1726,#0c131f);border:1px solid var(--border);border-radius:14px;padding:10px;display:flex;flex-direction:column;gap:6px}
  .pill{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);color:#bcd2f0;display:inline-flex;gap:6px;align-items:center}
  .impact{color:#aef7d3}.difficulty{color:#ffd28b}
  .matrix{margin-top:8px;border:1px solid var(--border);border-radius:12px;overflow:hidden}
  .matrix table{width:100%;border-collapse:collapse;font-size:12px}
  .matrix th,.matrix td{padding:8px 10px;border-bottom:1px solid var(--border)}
  .matrix th{background:#0f1624;color:#cfe3ff;position:sticky;top:0}
  .analysisBox{background:linear-gradient(180deg,#0e1522,#0c111b);border:1px solid var(--border);border-radius:14px;padding:12px;line-height:1.9}
  .analysisBox .rec{margin-top:10px;padding:8px;border-left:3px solid var(--accent);background:rgba(126,231,135,.06);border-radius:8px}
  .analysisBox .reason{font-size:12px;color:var(--muted);margin-top:4px}
  footer{margin:20px 0 50px;text-align:center;color:#89a1c5;font-size:12px}
  .sr{position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>Ø¢ÛŒÙ†Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡ X â€” Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ</h1>
      <div class="sub">Ø³Ù†Ø§Ø±ÛŒÙˆØ³Ø§Ø² Ø´Ø®ØµÛŒ Ø¨Ø§ Ù¾Ø´ØªÙˆØ§Ù†Ù‡ Ø§Ù†Ø¯ÛŒØ´Ú©Ø¯Ù‡â€ŒÙ‡Ø§ØŒ Ù‡Ø´Ø¯Ø§Ø± Ø±ÛŒØ³Ú©ØŒ Ùˆ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø¹Ù…Ù„ÛŒ</div>
    </div>
  </div>
  <div class="header-actions">
    <button id="saveBtn" class="btn" aria-label="Ø°Ø®ÛŒØ±Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆ">Ø°Ø®ÛŒØ±Ù‡</button>
    <button id="exportBtn" class="btn" aria-label="Ú†Ø§Ù¾ Ùˆ Ø®Ø±ÙˆØ¬ÛŒ PDF">Ú†Ø§Ù¾/PDF</button>
    <label class="toggle" for="themeToggle">
      <input id="themeToggle" type="checkbox" /> Ø­Ø§Ù„Øª Ø±ÙˆØ´Ù†
    </label>
  </div>
</header>

<div class="container">
  <div class="grid" role="region" aria-label="Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ùˆ Ù†ØªØ§ÛŒØ¬">
    <!-- Sidebar -->
    <div class="panel" aria-labelledby="profile-title">
      <h2 id="profile-title">Ù¾Ø±ÙˆÙØ§ÛŒÙ„ØŒ ØªØµÙ…ÛŒÙ… Ùˆ Ù…Ù†Ø§Ø¨Ø¹</h2>

      <label for="decision">Ø¹Ù†ÙˆØ§Ù† ØªØµÙ…ÛŒÙ…</label>
      <input id="decision" class="input" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: ØªØºÛŒÛŒØ± Ù…Ø³ÛŒØ± Ø¨Ù‡ Ø¹Ù„Ù… Ø¯Ø§Ø¯Ù‡">

      <div class="row">
        <div class="col">
          <label for="risk">ØªØ­Ù…Ù„ Ø±ÛŒØ³Ú©</label>
          <select id="risk">
            <option value="low">Ú©Ù…</option>
            <option value="mid" selected>Ù…ØªÙˆØ³Ø·</option>
            <option value="high">Ø²ÛŒØ§Ø¯</option>
          </select>
        </div>
        <div class="col">
          <label for="horizon">Ø§ÙÙ‚ Ø²Ù…Ø§Ù†ÛŒ</label>
          <select id="horizon">
            <option value="6">Û¶ Ù…Ø§Ù‡</option>
            <option value="12" selected>Û±Û² Ù…Ø§Ù‡</option>
            <option value="24">Û²Û´ Ù…Ø§Ù‡</option>
            <option value="36">Û³Û¶ Ù…Ø§Ù‡</option>
          </select>
        </div>
      </div>

      <label>ØªØ±Ù†Ø¯Ù‡Ø§ÛŒ Ù…Ø¯Ù†Ø¸Ø±</label>
      <div id="trendChips" class="chips" aria-label="Ø§Ù†ØªØ®Ø§Ø¨ ØªØ±Ù†Ø¯Ù‡Ø§"></div>
      <div class="hint">Ø±ÙˆØ´Ù†/Ø®Ø§Ù…ÙˆØ´ Ú©Ù† ØªØ§ Ø§Ø«Ø± Ø±ÙˆÛŒ Ø±ÛŒØ³Ú©/ÙØ±ØµØª/Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒ.</div>

      <label for="profileText">Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§/Ø±Ø²ÙˆÙ…Ù‡/Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§</label>
      <textarea id="profileText" class="input" placeholder="AI, Data, Python, Ø§Ù†Ø±Ú˜ÛŒ Ù¾Ø§Ú©ØŒ Ù„ÛŒÙ†Ú© GitHub/LinkedIn..."></textarea>
      <div class="row">
        <button id="analyzeBtn" class="btn" aria-label="ØªØ­Ù„ÛŒÙ„ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§">ØªØ­Ù„ÛŒÙ„ Ù…Ù‡Ø§Ø±Øª</button>
        <div id="skillNote" class="hint" aria-live="polite">ØªØ­Ù„ÛŒÙ„ Ù…Ø­Ù„ÛŒ Ùˆ Ø³Ø±ÛŒØ¹</div>
      </div>

      <h2 style="margin-top:10px">Ø§Ù†Ø¯ÛŒØ´Ú©Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ ÙˆØ²Ù†â€ŒØ¯Ù‡ÛŒ Ø¯Ø§Ù…Ù†Ù‡â€ŒÙ‡Ø§</h2>
      <p class="hint">ÙˆØ²Ù†â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØµÙ…ÛŒÙ…/ØªØ±Ù†Ø¯ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ùˆ Ø¨Ù‡â€ŒØµÙˆØ±Øª ØªÙˆØ¶ÛŒØ­â€ŒÙ¾Ø°ÛŒØ± Ø¯Ø± Ù…Ø§ØªØ±ÛŒØ³ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p>
      <div class="matrix" style="margin-bottom:10px">
        <table id="matrixTable">
          <thead>
            <tr><th>Ø¯Ø§Ù…Ù†Ù‡</th><th>ÙˆØ²Ù† Ù¾Ø§ÛŒÙ‡</th><th>ÙˆØ²Ù† Ù¾ÙˆÛŒØ§</th><th>ØªÙˆØ¶ÛŒØ­</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="chips" id="sourceChips" aria-label="Ø§Ù†Ø¯ÛŒØ´Ú©Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¤Ø«Ø±"></div>

      <h2 style="margin-top:10px">Ø¢Ø³ØªØ§Ù†Ù‡ Ù‡Ø´Ø¯Ø§Ø±</h2>
      <div class="row">
        <div class="col">
          <label for="thrRisk">Ø¢Ø³ØªØ§Ù†Ù‡ Ø±ÛŒØ³Ú© Ø³ÛŒØ³ØªÙ…ÛŒ</label>
          <input id="thrRisk" class="input" type="number" min="0" max="1" step="0.01" value="0.6" />
        </div>
        <div class="col">
          <label for="thrUnc">Ø¢Ø³ØªØ§Ù†Ù‡ Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª</label>
          <input id="thrUnc" class="input" type="number" min="0" max="1" step="0.01" value="0.7" />
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="simulate" class="btn primary" aria-label="Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ">Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ</button>
        <span id="status" class="hint" aria-live="polite">Ø¢Ù…Ø§Ø¯Ù‡</span>
      </div>
    </div>

    <!-- Main -->
    <div class="panel" aria-labelledby="results-title">
      <h2 id="results-title">Ù†ØªØ§ÛŒØ¬ Ùˆ ØªØ­Ù„ÛŒÙ„</h2>

      <div class="kpi" role="group" aria-label="Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ">
        <div class="kcard">
          <div class="t">Ø´Ø§Ø®Øµ ÙØ±ØµØª</div>
          <div id="oppVal" style="font-weight:700">â€”</div>
          <div class="progress"><span id="oppBar" style="width:0%"></span></div>
        </div>
        <div class="kcard">
          <div class="t">Ø±ÛŒØ³Ú© Ø³ÛŒØ³ØªÙ…ÛŒ</div>
          <div id="riskVal" style="font-weight:700">â€”</div>
          <div class="progress risk"><span id="riskBar" style="width:0%"></span></div>
        </div>
        <div class="kcard">
          <div class="t">Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª</div>
          <div id="uncVal" style="font-weight:700">â€”</div>
          <div class="progress neutral"><span id="uncBar" style="width:0%"></span></div>
        </div>
        <div class="kcard">
          <div class="t">Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ±ÛŒ (Ù…Ù†Ø§Ø¨Ø¹/Ù…Ù‡Ø§Ø±Øª)</div>
          <div id="feasVal" style="font-weight:700">â€”</div>
          <div class="progress"><span id="feasBar" style="width:0%"></span></div>
        </div>
      </div>

      <div class="section alerts" style="margin-top:10px">
        <div id="alertsBox"></div>
      </div>

      <div class="viz section" aria-label="ØªØµÙˆÛŒØ±Ø³Ø§Ø²ÛŒâ€ŒÙ‡Ø§">
        <div class="canvasWrap">
          <canvas id="radar" aria-label="Ù†Ù…ÙˆØ¯Ø§Ø± Ø±Ø§Ø¯Ø§Ø±ÛŒ Ø§Ø¨Ø¹Ø§Ø¯"></canvas>
          <div class="legend">
            <span class="chip"><span class="dot"></span> Ø§Ù…ØªÛŒØ§Ø²</span>
            <span class="chip"><span class="dot" style="background:#ffd28b"></span> Ø¨Ø§Ù†Ø¯ Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª</span>
          </div>
        </div>
        <div class="why" aria-label="Ø¯Ù„ÛŒÙ„ Ù†ØªØ§ÛŒØ¬">
          <h3>Ú†Ø±Ø§ Ø§ÛŒÙ† Ù†ØªÛŒØ¬Ù‡ØŸ</h3>
          <div id="whyList"></div>
          <div>
            <div class="hint" style="margin:4px 0 6px">Ù…Ù†Ø§Ø¨Ø¹/Ø§Ù†Ø¯ÛŒØ´Ú©Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¤Ø«Ø±:</div>
            <div class="srcs" id="whySources"></div>
          </div>
        </div>
      </div>

      <div class="timeline section" aria-label="Ù†Ù‚Ø´Ù‡ Ø²Ù…Ø§Ù†">
        <h2>Ù†Ù‚Ø´Ù‡ Ø²Ù…Ø§Ù† 2025â€“2032</h2>
        <svg id="timelineSvg" viewBox="0 0 900 140" preserveAspectRatio="xMidYMid meet"></svg>
      </div>

      <div class="section" aria-label="Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ù†Ø§Ù…ØªÙ‚Ø§Ø±Ù†">
        <h2>Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ù†Ø§Ù…ØªÙ‚Ø§Ø±Ù†</h2>
        <div id="scenarios" class="actions"></div>
      </div>

      <div class="section" aria-label="Ú¯Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ">
        <h2>Ú¯Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ 30/90/180 Ø±ÙˆØ²Ù‡</h2>
        <div id="actions" class="actions"></div>
      </div>

      <div class="section" aria-label="Ù…Ø§ØªØ±ÛŒØ³ Ù…Ù†Ø§Ø¨Ø¹">
        <h2>Ù…Ø§ØªØ±ÛŒØ³ ÙˆØ²Ù†â€ŒØ¯Ù‡ÛŒ Ù…Ù†Ø§Ø¨Ø¹</h2>
        <div class="matrix">
          <table id="sourceTable">
            <thead>
              <tr><th>Ø§Ù†Ø¯ÛŒØ´Ú©Ø¯Ù‡</th><th>Ø¯Ø§Ù…Ù†Ù‡ ØºØ§Ù„Ø¨</th><th>ÙˆØ²Ù† Ù†Ù‡Ø§ÛŒÛŒ</th><th>Ø§Ø«Ø± Ø¨Ø± ØªØµÙ…ÛŒÙ…</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="section" aria-label="ØªØ­Ù„ÛŒÙ„ Ø¢ÛŒÙ†Ø¯Ù‡ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ù‡Ø§">
        <h2>ØªØ­Ù„ÛŒÙ„ Ø¢ÛŒÙ†Ø¯Ù‡ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ù‡Ø§</h2>
        <div id="futureAnalysis" class="analysisBox"></div>
      </div>
    </div>
  </div>

  <footer>Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ù†Ù…Ø§ÛŒØ´ÛŒ â€” Ø¢Ù…Ø§Ø¯Ù‡ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡ Ùˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø±Ø³Ù…ÛŒ. Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ´Ø§Ø±: Ù‡Ù…ÛŒÙ† ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯Ø± GitHub Pages Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡.</footer>
</div>

<script>
  // ---------- Data ----------
  const DOMAINS = [
    { id:'tech', label:'ÙÙ†Ø§ÙˆØ±ÛŒ/Ø¯Ø§Ø¯Ù‡' },
    { id:'econ', label:'Ø§Ù‚ØªØµØ§Ø¯/Ø¨Ø§Ø²Ø§Ø±' },
    { id:'geo',  label:'Ú˜Ø¦Ùˆ/Ø§Ù…Ù†ÛŒØª' },
    { id:'clim', label:'Ø§Ù‚Ù„ÛŒÙ…/Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ' },
    { id:'soc',  label:'Ø¬Ø§Ù…Ø¹Ù‡/Ú©Ø§Ø±' },
  ];

  const TRENDS = [
    { id:'ai',      name:'Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù…ÙˆÙ„Ø¯',       risk:0.2,  opp:0.35, unc:0.15, domain:'tech' },
    { id:'green',   name:'Ú¯Ø°Ø§Ø± Ø³Ø¨Ø²/Ú©Ø±Ø¨Ù†â€ŒØµÙØ±',     risk:0.18, opp:0.28, unc:0.14, domain:'clim' },
    { id:'geo',     name:'Ø±ÛŒØ³Ú© Ú˜Ø¦ÙˆÙ¾Ù„ÛŒØªÛŒÚ©',        risk:0.35, opp:-0.05,unc:0.22, domain:'geo'  },
    { id:'supply',  name:'Ø²Ù†Ø¬ÛŒØ±Ù‡ ØªØ£Ù…ÛŒÙ† Ù†Ùˆ',       risk:0.22, opp:0.18, unc:0.12, domain:'econ' },
    { id:'aging',   name:'Ø³Ø§Ù„Ù…Ù†Ø¯ÛŒ Ø¬Ù…Ø¹ÛŒØª',         risk:0.25, opp:0.05, unc:0.10, domain:'soc'  },
    { id:'bio',     name:'Ø¨ÛŒÙˆ/Ø¯ÛŒØ¬ÛŒØªØ§Ù„',           risk:0.15, opp:0.22, unc:0.12, domain:'tech' },
    { id:'cyber',   name:'Ø§Ù…Ù†ÛŒØª Ø³Ø§ÛŒØ¨Ø±ÛŒ',          risk:0.20, opp:0.12, unc:0.12, domain:'geo'  },
    { id:'energy',  name:'Ø§Ù†Ø±Ú˜ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ùˆ',          risk:0.17, opp:0.25, unc:0.12, domain:'clim' },
    { id:'urban',   name:'Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯',         risk:0.12, opp:0.14, unc:0.08, domain:'tech' },
    { id:'fin',     name:'ÙÛŒÙ†â€ŒØªÚ©/Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„', risk:0.22, opp:0.16, unc:0.15, domain:'econ' },
  ];

  const SOURCES = [
    { name:'European Commission JRC Strategic Foresight', domain:'econ', w:0.8 },
    { name:'OECD Strategic Foresight', domain:'econ', w:0.8 },
    { name:'World Economic Forum', domain:'econ', w:0.7 },
    { name:'Brookings Institution', domain:'econ', w:0.7 },
    { name:'RAND Corporation', domain:'geo', w:0.8 },
    { name:'Chatham House (RIIA)', domain:'geo', w:0.8 },
    { name:'CSIS', domain:'geo', w:0.85 },
    { name:'Carnegie Endowment for International Peace', domain:'geo', w:0.75 },
    { name:'Atlantic Council', domain:'geo', w:0.75 },
    { name:'Council on Foreign Relations (CFR)', domain:'geo', w:0.7 },
    { name:'Peterson Institute for International Economics', domain:'econ', w:0.75 },
    { name:'Bruegel', domain:'econ', w:0.8 },
    { name:'CEPS', domain:'econ', w:0.7 },
    { name:'SWP (German Institute for International and Security Affairs)', domain:'geo', w:0.8 },
    { name:'Bertelsmann Stiftung', domain:'soc', w:0.65 },
    { name:'Kiel Institute (IfW Kiel)', domain:'econ', w:0.7 },
    { name:'DIW Berlin', domain:'econ', w:0.7 },
    { name:'Clingendael Institute', domain:'geo', w:0.7 },
    { name:'IFRI', domain:'geo', w:0.7 },
    { name:'IISS', domain:'geo', w:0.75 },
    { name:'SIPRI', domain:'geo', w:0.75 },
    { name:'GMF (German Marshall Fund)', domain:'geo', w:0.7 },
    { name:'MERICS', domain:'geo', w:0.7 },
    { name:'Lowy Institute', domain:'geo', w:0.7 },
    { name:'ASPI', domain:'geo', w:0.7 },
    { name:'NBR', domain:'geo', w:0.7 },
    { name:'Nesta', domain:'tech', w:0.7 },
    { name:'IFTF (Institute for the Future)', domain:'tech', w:0.75 },
    { name:'Oxford Martin School', domain:'tech', w:0.75 },
    { name:'Fraunhofer ISI', domain:'tech', w:0.8 },
    { name:'Copenhagen Institute for Futures Studies', domain:'tech', w:0.75 },
    { name:'McKinsey Global Institute (MGI)', domain:'econ', w:0.8 },
    { name:'EPRS (European Parliamentary Research Service)', domain:'econ', w:0.7 },
    { name:'Carnegie Europe', domain:'geo', w:0.7 },
    { name:'Urban Institute', domain:'soc', w:0.6 },
    { name:'Demos', domain:'soc', w:0.6 },
    { name:'AEI', domain:'econ', w:0.6 }
  ];

  // ---------- UI Elements ----------
  const decisionEl = document.getElementById('decision');
  const riskEl = document.getElementById('risk');
  const horizonEl = document.getElementById('horizon');
  const profileText = document.getElementById('profileText');
  const analyzeBtn = document.getElementById('analyzeBtn');
  const skillNote = document.getElementById('skillNote');

  const trendChips = document.getElementById('trendChips');
  const selectedTrends = new Set(['ai','green','geo','supply']); // default

  const matrixTableBody = document.querySelector('#matrixTable tbody');
  const sourceChips = document.getElementById('sourceChips');

  const oppVal = document.getElementById('oppVal');
  const oppBar = document.getElementById('oppBar');
  const riskVal = document.getElementById('riskVal');
  const riskBar = document.getElementById('riskBar');
  const uncVal = document.getElementById('uncVal');
  const uncBar = document.getElementById('uncBar');
  const feasVal = document.getElementById('feasVal');
  const feasBar = document.getElementById('feasBar');

  const alertsBox = document.getElementById('alertsBox');

  const radar = document.getElementById('radar');
  const rctx = radar.getContext('2d');

  const whyList = document.getElementById('whyList');
  const whySources = document.getElementById('whySources');
  const timelineSvg = document.getElementById('timelineSvg');
  const scenariosEl = document.getElementById('scenarios');
  const actionsEl = document.getElementById('actions');
  const sourceTableBody = document.querySelector('#sourceTable tbody');
  const futureAnalysis = document.getElementById('futureAnalysis');

  const thrRiskEl = document.getElementById('thrRisk');
  const thrUncEl = document.getElementById('thrUnc');
  const statusEl = document.getElementById('status');

  const saveBtn = document.getElementById('saveBtn');
  const exportBtn = document.getElementById('exportBtn');
  const themeToggle = document.getElementById('themeToggle');

  // ---------- Helpers ----------
  const dpi = window.devicePixelRatio || 1;
  function clamp01(x){ return Math.max(0, Math.min(1, x)); }
  function pct(x){ return Math.round(clamp01(x)*100); }

  function renderTrendChips(){
    trendChips.innerHTML = '';
    TRENDS.forEach(t=>{
      const on = selectedTrends.has(t.id);
      const el = document.createElement('span');
      el.className = 'chip';
      el.setAttribute('role','checkbox');
      el.setAttribute('aria-checked', on ? 'true':'false');
      el.style.borderColor = on ? '#2a7b5f' : 'var(--border)';
      el.style.boxShadow = on ? '0 0 18px rgba(126,231,135,0.15) inset' : 'none';
      el.innerHTML = `<span class="dot" style="background:${on?'#7ee787':'#6b7280'}"></span>${t.name}`;
      el.addEventListener('click', ()=>{
        if(on) selectedTrends.delete(t.id); else selectedTrends.add(t.id);
        renderTrendChips();
      });
      trendChips.appendChild(el);
    });
  }
  function renderSourceChips(){
    sourceChips.innerHTML='';
    SOURCES.forEach(s=>{
      const clr = s.domain==='econ'?'#7ee787': s.domain==='geo'?'#ffb4b4': s.domain==='tech'?'#7aa2f7': s.domain==='clim'?'#ffd28b':'#c0a6ff';
      const chip = document.createElement('span'); chip.className='chip'; chip.title=s.name;
      chip.innerHTML = `<span class="dot" style="background:${clr}"></span>${s.name}`;
      sourceChips.appendChild(chip);
    });
  }

  // ---------- Radar ----------
  const DIMENSIONS = [
    { id:'career', label:'Ø´ØºÙ„/Ù…Ù‡Ø§Ø±Øª' },
    { id:'wealth', label:'Ø«Ø±ÙˆØª/Ø³Ø±Ù…Ø§ÛŒÙ‡' },
    { id:'well', label:'Ø±ÙØ§Ù‡/Ø³Ù„Ø§Ù…Øª' },
    { id:'impact', label:'Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ/Ø§Ø«Ø±' },
    { id:'res', label:'ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ' },
  ];
  let scores = { career:0.6, wealth:0.55, well:0.58, impact:0.62, res:0.57 };
  let bands  = { career:0.12, wealth:0.1,  well:0.11, impact:0.09, res:0.1  };

  function resizeRadar(){
    const rect = radar.getBoundingClientRect();
    radar.width = rect.width * dpi;
    radar.height = rect.height * dpi;
    rctx.setTransform(dpi,0,0,dpi,0,0);
    drawRadar();
  }
  window.addEventListener('resize', resizeRadar);

  function drawRadar(){
    const w = radar.width/dpi, h = radar.height/dpi;
    rctx.clearRect(0,0,w,h);
    const cx = w/2, cy = h/2 + 8;
    const R = Math.min(w,h)*0.36;

    rctx.save();
    rctx.strokeStyle = 'rgba(180,200,240,0.25)';
    for(let r=1; r<=4; r++){
      rctx.beginPath();
      const rr = R * (r/4);
      DIMENSIONS.forEach((d,i)=>{
        const ang = (Math.PI*2)*i/DIMENSIONS.length - Math.PI/2;
        const x=cx+rr*Math.cos(ang), y=cy+rr*Math.sin(ang);
        i===0? rctx.moveTo(x,y) : rctx.lineTo(x,y);
      });
      rctx.closePath(); rctx.stroke();
    }
    DIMENSIONS.forEach((d,i)=>{
      const ang=(Math.PI*2)*i/DIMENSIONS.length - Math.PI/2;
      const x=cx+R*Math.cos(ang), y=cy+R*Math.sin(ang);
      rctx.beginPath(); rctx.moveTo(cx,cy); rctx.lineTo(x,y);
      rctx.strokeStyle='rgba(180,200,240,0.18)'; rctx.stroke();
      const lx=cx+(R+18)*Math.cos(ang), ly=cy+(R+18)*Math.sin(ang);
      rctx.fillStyle='#cfe3ff'; rctx.font='12px sans-serif';
      rctx.textAlign = Math.cos(ang)>0.2? 'left' : (Math.cos(ang)<-0.2?'right':'center');
      rctx.fillText(d.label,lx,ly);
    });

    // uncertainty band
    rctx.beginPath();
    DIMENSIONS.forEach((d,i)=>{
      const v = clamp01(scores[d.id] + bands[d.id]);
      const ang=(Math.PI*2)*i/DIMENSIONS.length - Math.PI/2;
      const x=cx+R*v*Math.cos(ang), y=cy+R*v*Math.sin(ang);
      i===0? rctx.moveTo(x,y) : rctx.lineTo(x,y);
    });
    rctx.closePath();
    rctx.fillStyle='rgba(255,210,139,0.18)'; rctx.fill();

    // polygon
    rctx.beginPath();
    DIMENSIONS.forEach((d,i)=>{
      const v = clamp01(scores[d.id]);
      const ang=(Math.PI*2)*i/DIMENSIONS.length - Math.PI/2;
      const x=cx+R*v*Math.cos(ang), y=cy+R*v*Math.sin(ang);
      i===0? rctx.moveTo(x,y) : rctx.lineTo(x,y);
    });
    rctx.closePath();
    const grad=rctx.createLinearGradient(0,0,w,h);
    grad.addColorStop(0,'rgba(126,231,135,0.28)');
    grad.addColorStop(1,'rgba(122,162,247,0.28)');
    rctx.fillStyle=grad; rctx.fill();
    rctx.strokeStyle='rgba(126,231,135,0.7)'; rctx.lineWidth=2; rctx.stroke();

    rctx.restore();
  }

  // ---------- Domain weights ----------
  function decisionPrefs(dec){
    switch(dec){
      case 'career': return { tech:0.32, econ:0.22, soc:0.18, geo:0.14, clim:0.14 };
      case 'startup':return { tech:0.30, econ:0.28, soc:0.12, geo:0.14, clim:0.16 };
      case 'invest': return { econ:0.36, geo:0.22, tech:0.20, clim:0.12, soc:0.10 };
      case 'relocate':return{ soc:0.26, econ:0.22, geo:0.22, tech:0.16, clim:0.14 };
      case 'learn':  return { tech:0.36, econ:0.18, soc:0.20, geo:0.12, clim:0.14 };
      default:       return { tech:0.28, econ:0.24, geo:0.18, clim:0.16, soc:0.14 };
    }
  }
  function dynamicDomainWeights(dec, trendSet){
    const base = decisionPrefs(dec);
    const w = { tech:base.tech||0, econ:base.econ||0, geo:base.geo||0, clim:base.clim||0, soc:base.soc||0 };
    trendSet.forEach(id=>{
      const t = TRENDS.find(x=>x.id===id); if(!t) return;
      w[t.domain] += 0.06; // emphasize aligned domain
    });
    const sum = Object.values(w).reduce((a,b)=>a+b,0)||1;
    for(const k in w) w[k]=w[k]/sum;
    return w;
  }
  function renderDomainMatrix(domainWeights, dec){
    matrixTableBody.innerHTML='';
    const notes = { econ:'Ø±Ø´Ø¯/ØªÙˆØ±Ù…/Ø¨Ù‡Ø±Ù‡ Ùˆ Ø¨Ø§Ø²Ø§Ø±Ù‡Ø§', geo:'Ø¯Ø±Ú¯ÛŒØ±ÛŒâ€ŒÙ‡Ø§/ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ùˆ Ø§Ù…Ù†ÛŒØª', tech:'Ø¨Ù‡Ø±Ù‡â€ŒÙˆØ±ÛŒ/Ø§ØªÙˆÙ…Ø§Ø³ÛŒÙˆÙ† Ùˆ Ø±Ù‚Ø§Ø¨Øª', clim:'Ù…Ù‚Ø±Ø±Ø§Øª/ESG Ùˆ Ø§Ù†Ø±Ú˜ÛŒ', soc:'Ø¬Ù…Ø¹ÛŒØª/Ù…Ù‡Ø§Ø±Øª Ùˆ Ø¹Ø¯Ø§Ù„Øª' };
    DOMAINS.forEach(d=>{
      const tr=document.createElement('tr');
      const base = decisionPrefs(dec)[d.id]||0;
      const dyn  = domainWeights[d.id]||0;
      tr.innerHTML = `<td>${d.label}</td><td>${base.toFixed(2)}</td><td>${dyn.toFixed(2)}</td><td>${notes[d.id]}</td>`;
      matrixTableBody.appendChild(tr);
    });
  }
  function renderSourceTable(domainWeights){
    sourceTableBody.innerHTML='';
    SOURCES.forEach(s=>{
      const dw = domainWeights[s.domain]||0.2;
      const finalW = (s.w * (0.6 + 0.4*dw));
      const tr = document.createElement('tr');
      const label = DOMAINS.find(d=>d.id===s.domain)?.label || s.domain;
      tr.innerHTML = `<td>${s.name}</td><td>${label}</td><td>${finalW.toFixed(2)}</td><td>${finalW>0.65?'Ø§Ø«Ø± Ù‚ÙˆÛŒ':'Ø§Ø«Ø± Ù…ØªÙˆØ³Ø·'}</td>`;
      sourceTableBody.appendChild(tr);
    });
  }

  // ---------- Skills parsing ----------
  const SKILL_MAP = [
    { keys:['ai','ml','machine learning','Ù‡ÙˆØ´','python','pytorch','tensorflow','data','Ø¯Ø§Ø¯Ù‡'], dim:'career', delta:0.06, domain:'tech' },
    { keys:['climate','energy','esg','Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ','Ø§Ù†Ø±Ú˜ÛŒ','Ø§Ù‚Ù„ÛŒÙ…','Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ'], dim:'impact', delta:0.05, domain:'clim' },
    { keys:['product','design','ux','ui','figma','Ø·Ø±Ø§Ø­ÛŒ','Ù…Ø­ØµÙˆÙ„'], dim:'career', delta:0.03, domain:'tech' },
    { keys:['security','Ø§Ù…Ù†ÛŒØª','cyber','devsecops'], dim:'res', delta:0.05, domain:'geo' },
    { keys:['finance','quant','valuation','Ù…Ø§Ù„ÛŒ','Ù¾Ø±ØªÙÙˆ'], dim:'wealth', delta:0.05, domain:'econ' },
    { keys:['health','Ø³Ù„Ø§Ù…Øª','bio','biology'], dim:'well', delta:0.03, domain:'soc' },
  ];
  function analyzeSkills(text){
    const t = (text||'').toLowerCase();
    return SKILL_MAP.filter(s=> s.keys.some(k=>t.includes(k)));
  }
  analyzeBtn.addEventListener('click', ()=>{
    const hits = analyzeSkills(profileText.value);
    if(hits.length===0) skillNote.textContent = 'Ù…Ù‡Ø§Ø±Øª Ù…Ø´Ø®ØµÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ú†Ù†Ø¯ Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†.';
    else {
      const labs = Array.from(new Set(hits.flatMap(h=>h.keys.slice(0,1))));
      skillNote.textContent = `Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ: ${labs.slice(0,6).join(', ')}${hits.length>6? ' +' + (hits.length-6) : ''}`;
    }
  });

  // ---------- Timeline ----------
  function renderTimeline(){
    const years=[2025,2026,2027,2028,2029,2030,2031,2032];
    const w=900,h=140,pad=60; timelineSvg.innerHTML='';
    const line=document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1',pad); line.setAttribute('y1',h/2);
    line.setAttribute('x2',w-pad); line.setAttribute('y2',h/2);
    line.setAttribute('stroke','#2b3a55'); line.setAttribute('stroke-width','2');
    timelineSvg.appendChild(line);
    years.forEach((y,i)=>{
      const x = pad + i*((w-2*pad)/(years.length-1));
      const tick=document.createElementNS('http://www.w3.org/2000/svg','line');
      tick.setAttribute('x1',x); tick.setAttribute('y1',h/2-8);
      tick.setAttribute('x2',x); tick.setAttribute('y2',h/2+8);
      tick.setAttribute('stroke','#3b5177'); tick.setAttribute('stroke-width','2');
      timelineSvg.appendChild(tick);
      const txt=document.createElementNS('http://www.w3.org/2000/svg','text');
      txt.setAttribute('x',x); txt.setAttribute('y',h/2+28);
      txt.setAttribute('text-anchor','middle'); txt.setAttribute('class','tick');
      txt.textContent=y; timelineSvg.appendChild(txt);
    });
    const markers=[
      { y:2025, label:'MVP/Ù¾Ø±ÙˆØªÙˆØªØ§ÛŒÙ¾ Ù…Ù‡Ø§Ø±Øª', tone:'#7ee787' },
      { y:2026, label:'Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¨Ø§Ø²Ø§Ø±/Ø´Ø¨Ú©Ù‡', tone:'#7aa2f7' },
      { y:2027, label:'Ú¯Ø³ØªØ±Ø´/ØªÙ†ÙˆØ¹â€ŒØ¨Ø®Ø´ÛŒ', tone:'#ffd28b' },
      { y:2029, label:'ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ/Ø±ÛŒØ³Ú© Ú˜Ø¦Ùˆ', tone:'#ffb4b4' },
      { y:2031, label:'Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯/ESG', tone:'#aef7d3' },
    ];
    markers.forEach(m=>{
      const i = years.indexOf(m.y); if(i<0) return;
      const x = pad + i*((w-2*pad)/(years.length-1));
      const cy=56;
      const c=document.createElementNS('http://www.w3.org/2000/svg','circle');
      c.setAttribute('cx',x); c.setAttribute('cy',cy); c.setAttribute('r','7'); c.setAttribute('fill',m.tone);
      timelineSvg.appendChild(c);
      const lab=document.createElementNS('http://www.w3.org/2000/svg','text');
      lab.setAttribute('x',x); lab.setAttribute('y',cy-12);
      lab.setAttribute('text-anchor','middle'); lab.setAttribute('class','tick');
      lab.textContent=m.label; timelineSvg.appendChild(lab);
    });
  }

  // ---------- Alerts ----------
  function renderAlerts(systemicRisk, unc, activeTrends){
    alertsBox.innerHTML='';
    const thrR = parseFloat(thrRiskEl.value)||0.6;
    const thrU = parseFloat(thrUncEl.value)||0.7;
    const ids = new Set(activeTrends);

    const push = (cls, txt) => {
      const el=document.createElement('div'); el.className='alert '+cls; el.innerHTML = `âš ï¸ ${txt}`; alertsBox.appendChild(el);
    };

    if(systemicRisk>=thrR) push('danger','Ø±ÛŒØ³Ú© Ø³ÛŒØ³ØªÙ…ÛŒ Ø¨Ø§Ù„Ø§Ø³Øª. Ù¾ÙˆØ´Ø´â€ŒØ±ÛŒØ³Ú© Ùˆ Ú¯Ø²ÛŒÙ†Ù‡ ØªÙˆÙ‚Ù Ø³Ø±ÛŒØ¹ ØªØ¹Ø±ÛŒÙ Ú©Ù†.');
    if(unc>=thrU) push('warn','Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª Ø²ÛŒØ§Ø¯ Ø§Ø³ØªØ› Ø¢Ø²Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú©ØŒ ØªØµÙ…ÛŒÙ…â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„â€ŒØ¨Ø±Ú¯Ø´Øª.');
    if(ids.has('geo') && ids.has('energy')) push('warn','ØªØ±Ú©ÛŒØ¨ Ú˜Ø¦Ùˆ + Ø§Ù†Ø±Ú˜ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù†ÙˆØ³Ø§Ù† Ø²ÛŒØ±Ø³Ø§Ø®Øª/Ù‚ÛŒÙ…Øª Ø¨Ø³Ø§Ø²Ø¯. Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ù†.');
    if(ids.has('ai') && ids.has('cyber')) push('warn','Ø§ØªÙˆÙ…Ø§Ø³ÛŒÙˆÙ† + Ø±ÛŒØ³Ú© Ø³Ø§ÛŒØ¨Ø±ÛŒ: Ú©Ù†ØªØ±Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ/Ù…Ù…ÛŒØ²ÛŒ Ø¯Ø§Ø¯Ù‡ Ø±Ø§ ØªÙ‚ÙˆÛŒØª Ú©Ù†.');

    if(!alertsBox.children.length){
      const ok=document.createElement('div'); ok.className='alert ok';
      ok.textContent='ÙˆØ¶Ø¹ÛŒØª Ù¾Ø§ÛŒØ¯Ø§Ø±: Ù‡Ø´Ø¯Ø§Ø± ÙØ¹Ø§Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ù¾Ø§ÛŒØ´ Ù…Ø³ØªÙ…Ø± Ø§Ø¯Ø§Ù…Ù‡ ÛŒØ§Ø¨Ø¯.'; alertsBox.appendChild(ok);
    }
  }

  // ---------- Actions ----------
  function renderActions(decision, riskTol){
    const acts=[];
    acts.push({
      horizon:'Û³Û° Ø±ÙˆØ²Ù‡',
      title: decision==='career' ? 'Ù†Ù…ÙˆÙ†Ù‡â€ŒÚ©Ø§Ø± Ù‡Ø¯ÙÙ…Ù†Ø¯ + Û³ Ú¯ÙØªâ€ŒÙˆÚ¯ÙˆÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ' :
             decision==='startup'? 'Ù…ØµØ§Ø­Ø¨Ù‡ Û±Û° Ù…Ø´ØªØ±ÛŒ + MVP Ú©Ø§ØºØ°ÛŒ' :
             decision==='invest' ? 'IPS ÛŒÚ©â€ŒØµÙØ­Ù‡â€ŒØ§ÛŒ + Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Ø±ÛŒØ³Ú©' :
             decision==='relocate'? 'ØªØ­Ù„ÛŒÙ„ Û³ Ø´Ù‡Ø± Ø¨Ø§ Ù…Ø§ØªØ±ÛŒØ³ Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ' :
             'Ø¯ÙˆØ±Ù‡ Û²Û° Ø³Ø§Ø¹ØªÙ‡ Ù…Ù‡Ø§Ø±Øª Ú©Ù„ÛŒØ¯ÛŒ + ØªÙ…Ø±ÛŒÙ†',
      tip: decision==='startup'? 'Ù…Ø¹ÛŒØ§Ø± Ø¯Ø±Ø¯/ØªÚ©Ø±Ø§Ø±/Ø¨ÙˆØ¯Ø¬Ù‡ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÙˆÙ„ÙˆÛŒØª Ù…Ø´Ú©Ù„ Ø¨Ø³Ù†Ø¬.' :
           decision==='career' ? 'Û³ Ø´ØºÙ„ Ù‡Ø¯Ù = Û³ Ù†Ù…ÙˆÙ†Ù‡â€ŒÚ©Ø§Ø± Ù…Ø·Ø§Ø¨Ù‚ JD.' :
           'Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯ Ø³Ø±ÛŒØ¹ Ø¨Ú¯ÛŒØ± Ùˆ Ù…Ø³ÛŒØ± Ø±Ø§ Ø§ØµÙ„Ø§Ø­ Ú©Ù†.',
      impact:'Ø§Ø«Ø±: Ù…ØªÙˆØ³Ø·', difficulty:'Ø¯Ø´ÙˆØ§Ø±ÛŒ: Ú©Ù…'
    });
    acts.push({
      horizon:'Û¹Û° Ø±ÙˆØ²Ù‡',
      title: decision==='career' ? 'Ú¯ÙˆØ§Ù‡ÛŒ Ù…Ø¹ØªØ¨Ø± + Û² Ù¾Ø±ÙˆÚ˜Ù‡ Ù…Ø´ØªØ±Ú©/Ù…ØªÙ†â€ŒØ¨Ø§Ø²' :
             decision==='startup'? 'MVP ÙˆØ§Ù‚Ø¹ÛŒ + Û³Û° Ú©Ø§Ø±Ø¨Ø± Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ' :
             decision==='invest' ? 'ØªÙ†ÙˆØ¹â€ŒØ¨Ø®Ø´ÛŒ + Ø³Ù‚Ù Ø²ÛŒØ§Ù† ØªØ¹Ø±ÛŒÙâ€ŒØ´Ø¯Ù‡' :
             decision==='relocate'? 'Ø³ÙØ± Ø§Ú©ØªØ´Ø§ÙÛŒ + Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø´Ø¨Ú©Ù‡ Ù…Ø­Ù„ÛŒ' :
             'Ù¾Ø±ÙˆÚ˜Ù‡ capstone Ø¨Ø§ Ù…Ù†ØªÙˆØ±',
      tip:'ÛŒÚ© Ø´Ø§Ø®Øµ Ù…ÙˆÙÙ‚ÛŒØª ÙˆØ§Ø­Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù† Ùˆ Ù‡ÙØªÚ¯ÛŒ Ù¾Ø§ÛŒØ´ Ú©Ù†.',
      impact:'Ø§Ø«Ø±: Ø¨Ø§Ù„Ø§', difficulty:'Ø¯Ø´ÙˆØ§Ø±ÛŒ: Ù…ØªÙˆØ³Ø·'
    });
    acts.push({
      horizon:'Û±Û¸Û° Ø±ÙˆØ²Ù‡',
      title: decision==='career' ? 'Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ø± Ù†Ù‚Ø´ Ù‡Ø¯Ù/Ø§Ø±ØªÙ‚Ø§' :
             decision==='startup'? 'MRR Ø¨Ø§ Ú†Ø±Ø®Ù‡ Ø³Ø§Ø®Øª/Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ' :
             decision==='invest' ? 'Ù¾ÙˆØ´Ø´â€ŒØ±ÛŒØ³Ú© Ø­Ø¯Ø§Ù‚Ù„ÛŒ + Ø¨Ø§Ø²Ù…ØªÙˆØ§Ø²Ù†â€ŒØ³Ø§Ø²ÛŒ' :
             decision==='relocate'? 'Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ø¨Ø§ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø§Ù„ÛŒ/Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ' :
             'Ø§Ø±Ø§Ø¦Ù‡ Ø¹Ù…ÙˆÙ…ÛŒ + Ø´Ø¨Ú©Ù‡ Ø­Ø§Ù…ÛŒØ§Ù†',
      tip: riskTol==='high' ? 'Ø¢Ø²Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§ÛŒ Ø¢Ù¾Ø³Ø§ÛŒØ¯ Ø¨Ø§ Ø³Ù‚Ù Ø²ÛŒØ§Ù† Ù…Ø´Ø®Øµ.' : 'Ø°Ø®ÛŒØ±Ù‡ Ø²Ù…Ø§Ù†ÛŒ/Ù…Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±.',
      impact:'Ø§Ø«Ø±: Ø¨Ø³ÛŒØ§Ø± Ø¨Ø§Ù„Ø§', difficulty:'Ø¯Ø´ÙˆØ§Ø±ÛŒ: Ù…ØªÙˆØ³Ø·/Ø¨Ø§Ù„Ø§'
    });

    actionsEl.innerHTML='';
    acts.forEach(a=>{
      const card=document.createElement('div'); card.className='actionCard';
      card.innerHTML=`
        <div class="pill"><span style="width:8px;height:8px;background:#7aa2f7;border-radius:50%"></span>${a.horizon}</div>
        <div style="font-weight:700">${a.title}</div>
        <div class="hint">${a.tip}</div>
        <div class="row" style="justify-content:space-between;margin-top:4px">
          <span class="pill impact">âš¡ ${a.impact}</span>
          <span class="pill difficulty">ğŸ§© ${a.difficulty}</span>
        </div>`;
      actionsEl.appendChild(card);
    });
  }

  // ---------- Scenarios ----------
  function renderScenarios(dec, risk, opp, unc){
    const baseP = clamp01(0.6 - (unc-0.4)*0.5);
    const upP   = clamp01(0.2 + (opp-0.55)*0.4);
    const downP = clamp01(0.2 + (risk-0.45)*0.5);
    const sum = baseP+upP+downP || 1;
    const P = { up: upP/sum, base: baseP/sum, down: downP/sum };

    const defs = [
      { id:'up',   label:'Upside (Ø§Ø«Ø± Ø²ÛŒØ§Ø¯/Ø§Ø­ØªÙ…Ø§Ù„ Ú©Ù…)', color:'#aef7d3', prob:P.up,
        tip:'Ø¢Ø²Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§ÛŒ Ú©Ù…â€ŒÙ‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§ Ø¢Ù¾Ø³Ø§ÛŒØ¯ Ø¨Ø²Ø±Ú¯Ø› Ù…Ø²ÛŒØª Ø¯Ø§Ø¯Ù‡/Ù…Ø§Ù„Ú©ÛŒØª ÙÚ©Ø±ÛŒ Ø¨Ø³Ø§Ø².' },
      { id:'base', label:'Base (Ù…Ø­ØªÙ…Ù„â€ŒØªØ±ÛŒÙ†)',            color:'#7aa2f7', prob:P.base,
        tip:'Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ø±ØŒ Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±Ùˆ Ø±Ø§ Ù‡ÙØªÚ¯ÛŒ Ø±ØµØ¯ Ú©Ù†.' },
      { id:'down', label:'Downside (Ø±ÛŒØ³Ú© Ø¯Ù†Ø¨Ø§Ù„Ù‡)',       color:'#ffb4b4', prob:P.down,
        tip:'Ù¾ÙˆØ´Ø´â€ŒØ±ÛŒØ³Ú©ØŒ Ú©Ø§Ù‡Ø´ Ù‡Ø²ÛŒÙ†Ù‡ Ø«Ø§Ø¨ØªØŒ Ú¯Ø²ÛŒÙ†Ù‡ ØªÙˆÙ‚Ù Ø³Ø±ÛŒØ¹.' },
    ];

    scenariosEl.innerHTML='';
    defs.forEach(s=>{
      const card=document.createElement('div'); card.className='actionCard';
      card.innerHTML=`
        <div class="pill"><span style="width:8px;height:8px;background:${s.color};border-radius:50%"></span>${s.label} â€” Ø§Ø­ØªÙ…Ø§Ù„: ${(s.prob*100|0)}%</div>
        <div class="hint">${s.tip}</div>`;
      scenariosEl.appendChild(card);
    });
  }

  // ---------- Why Panel ----------
  function renderWhy(dec, riskTol, horizon, unc, domainW){
    const reasons = [
      { title:'ÙˆØ²Ù†â€ŒØ¯Ù‡ÛŒ Ø¯Ø§Ù…Ù†Ù‡â€ŒÙ‡Ø§', detail:`Tech:${(domainW.tech||0).toFixed(2)} Econ:${(domainW.econ||0).toFixed(2)} Geo:${(domainW.geo||0).toFixed(2)} Clim:${(domainW.clim||0).toFixed(2)} Soc:${(domainW.soc||0).toFixed(2)}`, weight:0.30 },
      { title:'Ø§Ø«Ø± ØªØ±Ù†Ø¯Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„', detail:`ØªØ±Ù†Ø¯Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ ÙØ±ØµØª/Ø±ÛŒØ³Ú© Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯Ù‡â€ŒØ§Ù†Ø¯. Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª ÙØ¹Ù„ÛŒ: ${pct(unc)}%`, weight:0.26 },
      { title:'ØªÙ†Ø§Ø³Ø¨ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§', detail:'Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒâ€ŒØ´Ø¯Ù‡ Ø¨Ù‡ Ø§Ø¨Ø¹Ø§Ø¯ Ø§Ù…ØªÛŒØ§Ø² Ù†Ú¯Ø§Ø´Øª Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯.', weight:0.20 },
      { title:'Ø§ÙÙ‚ Ø²Ù…Ø§Ù†ÛŒ', detail:`Ø§ÙÙ‚ ${horizon} Ù…Ø§Ù‡Ù‡ Ø¯Ø§Ù…Ù†Ù‡ Ø¨Ø§Ù†Ø¯ Ø¹Ø¯Ù…â€ŒÙ‚Ø·Ø¹ÛŒØª Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª.`, weight:0.14 },
      { title:'ØªØ­Ù…Ù„ Ø±ÛŒØ³Ú©', detail:`ØªÙ†Ø¸ÛŒÙ… ${riskTol==='low'?'Ù…Ø­Ø§ÙØ¸Ù‡â€ŒÚ©Ø§Ø±Ø§Ù†Ù‡':(riskTol==='high'?'ØªÙ‡Ø§Ø¬Ù…ÛŒ':'Ù…ØªØ¹Ø§Ø¯Ù„')} Ø¯Ø± ÙˆØ²Ù†â€ŒØ¯Ù‡ÛŒ Ù„Ø­Ø§Ø¸ Ø´Ø¯.`, weight:0.10 },
    ];
    whyList.innerHTML='';
    reasons.forEach(r=>{
      const row=document.createElement('div'); row.className='reason';
      row.innerHTML=`
        <div style="min-width:8px;height:8px;background:#7ee787;border-radius:50%;margin-top:6px"></div>
        <div style="flex:1">
          <div style="color:#cfe3ff;font-size:13px;margin-bottom:4px">${r.title}</div>
          <div class="hint" style="margin-bottom:8px">${r.detail}</div>
          <div class="bar"><span style="width:${Math.round(r.weight*100)}%"></span></div>
        </div>`;
      whyList.appendChild(row);
    });

    // Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø¤Ø«Ø± (Ù…Ø±ØªØ¨â€ŒØ´Ø¯Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø§Ù…Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø± ÙˆØ²Ù†)
    whySources.innerHTML='';
    const sortedDomains = Object.entries(domainW).sort((a,b)=>b[1]-a[1]).map(x=>x[0]);
    const pool = SOURCES.slice().sort((a,b)=> sortedDomains.indexOf(a.domain) - sortedDomains.indexOf(b.domain));
    pool.slice(0,16).forEach(s=>{
      const clr = s.domain==='econ'?'#7ee787': s.domain==='geo'?'#ffb4b4': s.domain==='tech'?'#7aa2f7': s.domain==='clim'?'#ffd28b':'#c0a6ff';
      const chip=document.createElement('span'); chip.className='chip';
      chip.innerHTML=`<span class="dot" style="background:${clr}"></span>${s.name}`;
      whySources.appendChild(chip);
    });
  }

  // ---------- Future Analysis ----------
  function renderFutureText(profile, decisionKey, trendKeys, domainW){
    const topDomain = Object.entries(domainW).sort((a,b)=>b[1]-a[1])[0][0];
    const domainLabel = DOMAINS.find(d=>d.id===topDomain)?.label || '';
    const trends = trendKeys.map(id=>TRENDS.find(t=>t.id===id)?.name).filter(Boolean).join('ØŒ ') || 'â€”';
    const riskLabel = profile.risk==='high'?'Ø¨Ø§Ù„Ø§':(profile.risk==='low'?'Ú©Ù…':'Ù…ØªÙˆØ³Ø·');
    const src = (SOURCES.find(s=>s.domain===topDomain)?.name)||'Ø§Ù†Ø¯ÛŒØ´Ú©Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø±';

    let html = `<p>Ø§Ú¯Ø± Ø§ÛŒÙ† Ù…Ø³ÛŒØ± Â«${decisionKey||'â€”'}Â» Ø±Ø§ Ø¨Ø§ Ø§ÙÙ‚ ${profile.horizon} Ù…Ø§Ù‡Ù‡ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡ÛŒØŒ Ù…Ø­ØªÙ…Ù„â€ŒØªØ±ÛŒÙ† Ú©Ø§Ù†ÙˆÙ† Ø§Ø«Ø± ØªÙˆ Ø­ÙˆØ²Ù‡ <strong>${domainLabel}</strong> Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯. ØªØ±Ù†Ø¯Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„ (${trends}) Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø§Ø²Ù‡ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù†Ù‚Ø´ Ø±Ø§ Ø¨Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯. Ø¨Ø§ Ø±ÛŒØ³Ú© ${riskLabel}ØŒ ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù†Ø³Ø¨Øª Ø§Ø«Ø±/Ù‡Ø²ÛŒÙ†Ù‡ Ø±Ø§ Ø¯Ø§Ø±Ù†Ø¯:</p>`;

    const recs = [
      { t:'ØªÙ‚ÙˆÛŒØª Ù…Ù‡Ø§Ø±Øª Ù…Ú©Ù…Ù„ Ø¯Ø± Ø­ÙˆØ²Ù‡ ØºØ§Ù„Ø¨', r:`Ø¨Ø± Ø§Ø³Ø§Ø³ ${src}ØŒ ØªØ±Ú©ÛŒØ¨ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø¨Ø§ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¸Ù‡ÙˆØ± Ø­ÙˆØ²Ù‡ ØºØ§Ù„Ø¨ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ø§Ø²Ø¯Ù‡ÛŒ Ø±Ø§ ØªØ§ Ø­Ø¯ÙˆØ¯ Û³Û°Ùª Ø§ÙØ²Ø§ÛŒØ´ Ø¯Ù‡Ø¯. Ù…Ø³ÛŒØ± ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ ÙØ´Ø±Ø¯Ù‡ Û¸â€“Û±Û° Ù‡ÙØªÙ‡â€ŒØ§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†.` },
      { t:'Ø´Ø¨Ú©Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù‡Ø¯ÙÙ…Ù†Ø¯ Ø²ÙˆØ¯Ù‡Ù†Ú¯Ø§Ù…', r:`Ø¯Ø± Ù…Ø­ÛŒØ·â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ Ø±ÛŒØ³Ú© ${riskLabel}ØŒ Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚ÙˆÛŒØŒ ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ ØªØµÙ…ÛŒÙ… Ø±Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯. Ù‡Ø± Ù‡ÙØªÙ‡ Û² Ø§Ø±ØªØ¨Ø§Ø· Ø¬Ø¯ÛŒØ¯ + Û± Ú¯ÙØªâ€ŒÙˆÚ¯ÙˆÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ.` },
      { t:'Ù¾Ø§ÛŒØ´ Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±Ùˆ', r:'Ù…Ø§Ù‡Ø§Ù†Ù‡ ÛŒÚ© Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ú©ÙˆÚ†Ú© Ø§Ø² Û³ Ø´Ø§Ø®Øµ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ ØªØ±Ù†Ø¯Ù‡Ø§ Ø¨Ø³Ø§Ø² (Ù…Ø«Ù„Ø§Ù‹ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ø± AI/Ø§Ù†Ø±Ú˜ÛŒ Ù¾Ø§Ú©/Ø´Ø§Ø®Øµ Ø±ÛŒØ³Ú© Ú˜Ø¦Ùˆ) ØªØ§ Ø²ÙˆØ¯ØªØ± Ø§Ø² Ø¨Ø§Ø²Ø§Ø± ÙˆØ§Ú©Ù†Ø´ Ù†Ø´Ø§Ù† Ø¯Ù‡ÛŒ.' },
      { t:'Ø¢Ø²Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ú¯Ø´Øª', r:'Ø¨Ù‡â€ŒØ¬Ø§ÛŒ ØªØ¹Ù‡Ø¯ Ø³Ù†Ú¯ÛŒÙ†ØŒ Ø¢Ø²Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§ÛŒ Û²â€“Û³ Ù‡ÙØªÙ‡â€ŒØ§ÛŒ Ø¨Ø§ Ù…Ø¹ÛŒØ§Ø± Ù…ÙˆÙÙ‚ÛŒØª Ø±ÙˆØ´Ù† Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯Ù‡ Ùˆ Ø¨Ø±Ø§Ø³Ø§Ø³ Ø¯Ø§Ø¯Ù‡ ØªØµÙ…ÛŒÙ… Ø¨Ú¯ÛŒØ±.' },
    ];

    futureAnalysis.innerHTML='';
    futureAnalysis.innerHTML += html;
    recs.forEach(x=>{
      const item = document.createElement('div'); item.className='rec';
      item.innerHTML = `ğŸ’¡ ${x.t}<div class="reason">${x.r}</div>`;
      futureAnalysis.appendChild(item);
    });
  }

  // ---------- Simulation pipeline ----------
  function compute(){
    const decRaw = (decisionEl.value||'').trim();
    const decision = decRaw.toLowerCase().includes('Ø§Ø³ØªØ§Ø±ØªØ§Ù¾') ? 'startup'
                   : decRaw.toLowerCase().includes('Ø³Ø±Ù…Ø§ÛŒÙ‡') ? 'invest'
                   : decRaw.toLowerCase().includes('Ù…Ù‡Ø§Ø¬') ? 'relocate'
                   : decRaw.toLowerCase().includes('ÛŒØ§Ø¯') ? 'learn'
                   : 'career';

    const riskTol = riskEl.value;
    const horizon = Number(horizonEl.value);
    const activeTrends = Array.from(selectedTrends);

    // domain weights
    const domainW = dynamicDomainWeights(decision, selectedTrends);
    renderDomainMatrix(domainW, decision);
    renderSourceTable(domainW);

    // baseline scores by decision
    const base = (()=>{
      switch(decision){
        case 'career': return { career:0.62, wealth:0.55, well:0.60, impact:0.58, res:0.57 };
        case 'startup':return { career:0.58, wealth:0.60, well:0.52, impact:0.64, res:0.55 };
        case 'invest': return { career:0.52, wealth:0.65, well:0.56, impact:0.50, res:0.58 };
        case 'relocate':return { career:0.60, wealth:0.56, well:0.62, impact:0.55, res:0.60 };
        case 'learn':  return { career:0.66, wealth:0.54, well:0.60, impact:0.58, res:0.56 };
        default: return { career:0.58, wealth:0.58, well:0.58, impact:0.58, res:0.58 };
      }
    })();

    scores = {...base};
    let opportunity = 0.58, systemicRisk = 0.38;

    // trend contributions with domain modulation
    activeTrends.forEach(id=>{
      const t = TRENDS.find(x=>x.id===id); if(!t) return;
      const domFactor = (domainW[t.domain]||0.2) + 0.6; // 0.6..1.6
      opportunity += t.opp * 0.36 * domFactor/(1 + activeTrends.length*0.25);
      systemicRisk += t.risk * 0.42 * domFactor/(1 + activeTrends.length*0.25);

      scores.career += (t.opp - t.risk*0.12)*0.18*domFactor;
      scores.wealth += (t.opp - t.risk*0.10)*0.22*domFactor;
      scores.impact += (t.opp)*0.20*domFactor;
      scores.res    += (0.10 - t.risk*0.16)*domFactor;
      scores.well   +=
