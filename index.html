<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>تصمیم‌یار آینده‌نگر (نسخه کامل)</title>
<style>
:root{
  --bg:#0b1220; --panel:#0e1522; --muted:#9fb0c3; --text:#e7edf5; --accent:#7ee787; --border:#22304a; --danger:#ff6b6b; --warn:#ffb020;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:radial-gradient(1200px 800px at 80% -10%,#1a2642 0%,rgba(11,18,32,0) 70%),var(--bg);color:var(--text);font:15px/1.7 Vazirmatn,Segoe UI,Roboto,Arial}
.container{max-width:1100px;margin:24px auto;padding:0 16px}
h1{font-size:26px;margin:8px 0 18px}
h2{font-size:18px;margin:18px 0 10px}
h3{font-size:16px;margin:14px 0 8px;color:#cfe6ff}
.section{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:900px){.row{grid-template-columns:1fr}}
.input{display:flex;flex-direction:column;gap:6px}
.input label{font-weight:600}
.input input[type="text"], .input select, .input textarea, .pill{
  background:#0b1322;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:10px
}
.input textarea{min-height:72px}
.small{font-size:12px;color:var(--muted)}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
@media (max-width:700px){.grid{grid-template-columns:1fr 1fr}}
.sliderRow{display:grid;grid-template-columns:120px 1fr 40px;gap:8px;align-items:center}
code.badge{background:#0b1322;border:1px solid var(--border);padding:2px 8px;border-radius:999px;color:var(--muted)}
.kpi{display:flex;gap:12px;flex-wrap:wrap}
.kpi .card{flex:1 1 200px;background:#0b1322;border:1px solid var(--border);border-radius:12px;padding:10px}
.table{width:100%;border-collapse:separate;border-spacing:0 6px}
.table th,.table td{padding:10px;background:#0b1322;border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
.table th:first-child,.table td:first-child{border-right:1px solid var(--border);border-radius:10px 0 0 10px}
.table th:last-child,.table td:last-child{border-left:1px solid var(--border);border-radius:0 10px 10px 0}
.alert{padding:10px;border-radius:10px;border:1px solid var(--border);background:#101828}
.alert.warn{border-color:#4b3a0d;background:rgba(255,176,32,0.07);color:#ffd78a}
.alert.danger{border-color:#4a1a1a;background:rgba(255,107,107,0.07);color:#ffb5b5}
.btn{background:linear-gradient(180deg,#1f6f5d,#145346);border:1px solid #1e5c4c;color:white;padding:10px 14px;border-radius:10px;cursor:pointer}
.btn:disabled{opacity:.6;cursor:not-allowed}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border-radius:16px;border:1px solid var(--border);background:#0b1322;cursor:pointer}
.chip input{margin:0}
.progress{height:8px;background:#0f1a2b;border-radius:6px;overflow:hidden;border:1px solid var(--border)}
.progress > span{display:block;height:100%;background:linear-gradient(90deg,#7ee787,#42b883);width:0%}
.bad{background:linear-gradient(90deg,#ff6b6b,#ff9f7a)!important}
.neutral{background:linear-gradient(90deg,#a0b3c6,#c1cfdb)!important}
.recList{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media (max-width:900px){.recList{grid-template-columns:1fr}}
.recItem{border:1px dashed var(--border);border-radius:12px;padding:10px;background:#0b1322}
.recItem .why{color:var(--muted);font-size:12px;margin-top:6px}
.matrix{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
@media (max-width:900px){.matrix{grid-template-columns:1fr 1fr}}
.box{border:1px solid var(--border);border-radius:12px;padding:10px;background:#0b1322}
.analysisBox{background:linear-gradient(180deg,#0e1522,#0c111b);border:1px solid var(--border);border-radius:14px;padding:12px;line-height:1.9}
.analysisBox .rec{margin-top:10px;padding:8px;border-left:3px solid var(--accent);background:rgba(126,231,135,0.06);border-radius:8px}
.analysisBox .reason{font-size:12px;color:var(--muted);margin-top:4px}
.footer{color:#8ea3b7;font-size:12px;margin-top:6px}
hr.sep{border:none;border-top:1px dashed var(--border);margin:12px 0}
</style>
</head>
<body>
<div class="container">
  <h1>تصمیم‌یار آینده‌نگر</h1>
  <div class="section">
    <div class="row">
      <div class="input">
        <label>عنوان تصمیم</label>
        <input id="decision" type="text" placeholder="مثلاً: تغییر مسیر شغلی به دیتا ساینس" />
        <span class="small">کوتاه و مشخص بنویس.</span>
      </div>
      <div class="row">
        <div class="input">
          <label>افق تصمیم (ماه)</label>
          <input id="horizon" type="number" min="1" max="60" value="12" />
          <span class="small">بازه‌ای که می‌خواهی در آن نتیجه ببینی.</span>
        </div>
        <div class="input">
          <label>تحمل ریسک</label>
          <select id="risk">
            <option value="low">کم</option>
            <option value="medium" selected>متوسط</option>
            <option value="high">زیاد</option>
          </select>
        </div>
      </div>
    </div>
    <hr class="sep" />
    <h2>دامنه‌های اولویت‌دار و وزن‌دهی</h2>
    <div id="domainWeights" class="grid"></div>
    <div class="footer">جمع وزن‌ها اهمیت نسبی حوزه‌ها را نشان می‌دهد؛ تعادلی که منطق تصمیم تو را واقع‌گرایانه می‌کند.</div>
  </div>

  <div class="section">
    <h2>ترندها و پیشران‌ها</h2>
    <div id="trendChips" class="chips"></div>
    <div class="footer">ترندها روی امتیاز حوزه‌ها اثر ضرب‌کننده دارند؛ با تمرکز انتخاب کن.</div>
  </div>

  <div class="section">
    <div class="row">
      <div>
        <h2>مهارت‌ها</h2>
        <div class="input">
          <label>فهرست مهارت‌های فعلی</label>
          <textarea id="skills" placeholder="مثلاً: Python, SQL, ارتباط با مشتری, مدیریت پروژه"></textarea>
          <span class="small">مهارت‌ها را با کاما جدا کن.</span>
        </div>
      </div>
      <div>
        <h2>منابع در دسترس</h2>
        <div class="grid">
          <label class="pill"><input id="res-time" type="checkbox" /> زمان هفتگی کافی</label>
          <label class="pill"><input id="res-budget" type="checkbox" /> بودجه آموزشی</label>
          <label class="pill"><input id="res-network" type="checkbox" /> شبکه ارتباطی</label>
        </div>
        <div class="row" style="margin-top:10px">
          <div class="input">
            <label>ساعت آزاد هفتگی</label>
            <input id="hours" type="number" min="0" value="6" />
          </div>
          <div class="input">
            <label>بودجه ماهانه (یورو)</label>
            <input id="budget" type="number" min="0" value="150" />
          </div>
        </div>
      </div>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
      <button id="run" class="btn">محاسبه و پیشنهاد</button>
      <code class="badge" id="status">آماده</code>
    </div>
  </div>

  <div class="section">
    <h2>خلاصه تحلیلی</h2>
    <div class="kpi">
      <div class="card">
        <div class="small">ریسک کلی</div>
        <div id="kpiRisk" style="font-weight:700">—</div>
      </div>
      <div class="card">
        <div class="small">دامنه غالب</div>
        <div id="kpiDomain" style="font-weight:700">—</div>
      </div>
      <div class="card">
        <div class="small">قدرت امکان‌پذیری</div>
        <div class="progress"><span id="kpiFeas" style="width:0%"></span></div>
      </div>
      <div class="card">
        <div class="small">هم‌ترازی ترند</div>
        <div class="progress"><span id="kpiTrend" class="neutral" style="width:0%"></span></div>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>هشدارهای ریسک</h2>
    <div id="alerts" class="grid"></div>
  </div>

  <div class="section">
    <h2>امتیاز حوزه‌ها</h2>
    <table class="table" id="scoreTable">
      <thead>
        <tr><th>حوزه</th><th>امتیاز</th><th>توضیح</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h2>گام‌های پیشنهادی ۶ هفته‌ای</h2>
    <div id="recs" class="recList"></div>
  </div>

  <div class="section">
    <h2>ماتریس منابع</h2>
    <div class="matrix">
      <div class="box"><strong>کم‌هزینه/کم‌زمان:</strong><div id="mx-easy"></div></div>
      <div class="box"><strong>پراثر/کم‌زمان:</strong><div id="mx-quick"></div></div>
      <div class="box"><strong>سرمایه‌گذاری عمیق:</strong><div id="mx-deep"></div></div>
    </div>
  </div>

  <div class="section">
    <h2>تحلیل آینده و پیشنهادها</h2>
    <div id="futureAnalysis" class="analysisBox"></div>
  </div>

  <div class="footer">ساخته شده برای کمک به تصمیم‌گیری‌های معنادار؛ جایی که انتخاب‌ها با آینده گفت‌وگو می‌کنند.</div>
</div>

<script>
// داده‌های پایه
const DOMAINS = [
  { id:'tech', label:'فناوری و داده' },
  { id:'market', label:'بازار و محصول' },
  { id:'people', label:'افراد و شبکه' },
  { id:'ops', label:'عملیات و اجرا' },
  { id:'learn', label:'یادگیری و پژوهش' },
  { id:'brand', label:'برند شخصی' }
];

const TRENDS = [
  { id:'ai', name:'هوش مصنوعی مولد', impact:{ tech:1.25, market:1.08, ops:1.1, learn:1.18, brand:1.05 } },
  { id:'data', name:'حاکمیت داده و حریم خصوصی', impact:{ tech:1.12, ops:1.15, market:1.05 } },
  { id:'remote', name:'دورکاری و تیم‌های توزیع‌شده', impact:{ people:1.12, ops:1.1, brand:1.05 } },
  { id:'fin', name:'فناوری مالی', impact:{ market:1.12, tech:1.08 } },
  { id:'sust', name:'پایداری و ESG', impact:{ market:1.08, ops:1.1, brand:1.06 } },
  { id:'ed', name:'EdTech و یادگیری تطبیقی', impact:{ learn:1.2, tech:1.06, brand:1.04 } }
];

const SOURCES = [
  { domain:'tech', name:'McKinsey Tech Trends' },
  { domain:'market', name:'Gartner Market Guide' },
  { domain:'people', name:'Deloitte Human Capital' },
  { domain:'ops', name:'MIT Sloan Ops Review' },
  { domain:'learn', name:'OECD Skills Outlook' },
  { domain:'brand', name:'HBR Personal Branding' }
];

// ساخت UI وزن‌ها
const weightsEl = document.getElementById('domainWeights');
const sliders = {};
DOMAINS.forEach(d=>{
  const wrap = document.createElement('div');
  wrap.className='box';
  wrap.innerHTML = `
    <div class="sliderRow">
      <div>${d.label}</div>
      <input type="range" min="0" max="100" value="${d.id==='tech'||d.id==='learn'?60:40}" id="w-${d.id}" />
      <div><span id="v-${d.id}">0</span>%</div>
    </div>`;
  weightsEl.appendChild(wrap);
  sliders[d.id]=wrap.querySelector(`#w-${d.id}`);
  const v=wrap.querySelector(`#v-${d.id}`);
  const sync=()=>{v.textContent=sliders[d.id].value;}
  sliders[d.id].addEventListener('input',sync); sync();
});

// ترندها
const trendChips = document.getElementById('trendChips');
const selectedTrends = new Set();
TRENDS.forEach(t=>{
  const lbl = document.createElement('label');
  lbl.className='chip';
  lbl.innerHTML = `<input type="checkbox" value="${t.id}" /> ${t.name}`;
  lbl.querySelector('input').addEventListener('change',e=>{
    if(e.target.checked) selectedTrends.add(t.id); else selectedTrends.delete(t.id);
  });
  trendChips.appendChild(lbl);
});

// عناصر
const decisionEl = document.getElementById('decision');
const horizonEl = document.getElementById('horizon');
const riskEl = document.getElementById('risk');
const skillsEl = document.getElementById('skills');
const hoursEl = document.getElementById('hours');
const budgetEl = document.getElementById('budget');
const statusEl = document.getElementById('status');

// خروجی‌ها
const kpiRiskEl = document.getElementById('kpiRisk');
const kpiDomainEl = document.getElementById('kpiDomain');
const kpiFeasBar = document.getElementById('kpiFeas');
const kpiTrendBar = document.getElementById('kpiTrend');
const alertsEl = document.getElementById('alerts');
const scoreTableBody = document.querySelector('#scoreTable tbody');
const recsEl = document.getElementById('recs');

// ابزارک‌ها
function parseSkills(){
  return skillsEl.value.split(/[,\n]/).map(s=>s.trim()).filter(Boolean).map(s=>s.toLowerCase());
}
function norm(x, min, max){ return max===min?0: (x-min)/(max-min); }
function clamp(x,min,max){ return Math.max(min, Math.min(max,x)); }

// محاسبات اصلی
function computeScores(){
  const domainW = {};
  let sumW=0;
  DOMAINS.forEach(d=>{
    domainW[d.id]=Number(sliders[d.id].value)/100;
    sumW += domainW[d.id];
  });
  // نرمال‌سازی نرم (بدون جمع الزامی = 1)
  const risk = riskEl.value;
  const horizon = Number(horizonEl.value);
  const skills = parseSkills();
  const hours = Number(hoursEl.value)||0;
  const budget = Number(budgetEl.value)||0;

  // تاثیر ترندها
  const mult = {};
  DOMAINS.forEach(d=>mult[d.id]=1);
  selectedTrends.forEach(tr=>{
    const t = TRENDS.find(x=>x.id===tr);
    if(!t) return;
    Object.entries(t.impact).forEach(([k,v])=>{ mult[k] *= v; });
  });

  // سازگاری مهارت
  const skillHints = {
    tech:['python','sql','ml','ai','cloud','api','etl','javascript','typescript'],
    market:['product','بازاریابی','marketing','seo','discovery','pmf','pricing'],
    people:['communication','ارتباط','negotiation','coaching','leadership','mentoring'],
    ops:['project','مدیریت پروژه','kanban','scrum','automation','devops'],
    learn:['research','تحقیق','statistics','آمار','teaching','teaching assistant','writing'],
    brand:['content','نوشتن','linkedin','twitter','community','speaking','presentation']
  };
  const skillFit = {};
  DOMAINS.forEach(d=>{
    const ref = skillHints[d.id]||[];
    const match = skills.filter(s=>ref.some(r=>s.includes(r))).length;
    skillFit[d.id] = clamp(0.6 + match*0.08, 0.6, 1.2);
  });

  // امکان‌پذیری منابع
  const hasTime = document.getElementById('res-time').checked;
  const hasBudget = document.getElementById('res-budget').checked;
  const hasNetwork = document.getElementById('res-network').checked;
  const feas = clamp(
    (hasTime?0.25:0) + (hasBudget?0.25:0) + (hasNetwork?0.2:0) +
    clamp(hours/12,0,0.2) + clamp(budget/200,0,0.1),
    0, 1
  );

  // ریسک پایه
  const baseRisk = {low:0.25, medium:0.5, high:0.75}[risk];
  const riskAdj = clamp(baseRisk + (selectedTrends.size>=3?0.05:0) + (horizon>=18?0.05:0), 0, 1);

  // امتیاز نهایی هر حوزه
  const scores = {};
  DOMAINS.forEach(d=>{
    const s = (0.5*domainW[d.id] + 0.25*feas + 0.25*norm(skillFit[d.id],0.6,1.2)) * mult[d.id];
    scores[d.id]= Number((s*100).toFixed(1));
  });

  // KPI ترند
  const trendAlign = clamp(Object.values(mult).reduce((a,b)=>a+b,0)/DOMAINS.length - 1, 0, 0.4) / 0.4; // 0..1

  return { domainW, mult, skillFit, scores, feas, riskAdj, trendAlign,
           profile:{risk, horizon, hours, budget, hasTime, hasBudget, hasNetwork, skills} };
}

// هشدارها
function buildAlerts(ctx){
  const arr=[];
  const {profile, feas, riskAdj} = ctx;
  if(profile.horizon<6) arr.push({lvl:'warn', text:'افق زیر ۶ ماه: انتظار نتیجه بزرگ غیرواقعی است. دامنه گام‌ها را کوچک کن.'});
  if(!profile.hasTime && profile.hours<5) arr.push({lvl:'danger', text:'کمبود زمان: برای پیشرفت پایدار حداقل ۵–۸ ساعت در هفته لازم است.'});
  if(!profile.hasBudget && profile.budget<50) arr.push({lvl:'warn', text:'بودجه آموزشی محدود: از منابع رایگان و پروژه‌های عملی استفاده کن.'});
  if(riskAdj>0.7 && selectedTrends.size>=3) arr.push({lvl:'warn', text:'پراکندگی ترندها در ریسک بالا: تمرکز را به ۱–۲ ترند کاهش بده.'});
  if(feas<0.35) arr.push({lvl:'danger', text:'امکان‌پذیری پایین: ابتدا منابع پایه (زمان/بودجه/شبکه) را تقویت کن.'});
  return arr;
}

// جدول امتیاز
function renderScores(scores, mult, domainW, skillFit){
  scoreTableBody.innerHTML='';
  const entries = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  entries.forEach(([id,score])=>{
    const tr=document.createElement('tr');
    const d=DOMAINS.find(x=>x.id===id);
    const why = `وزن: ${(domainW[id]*100).toFixed(0)}% | ترند: ${(mult[id]).toFixed(2)}× | مهارت: ${(skillFit[id]).toFixed(2)}×`;
    tr.innerHTML=`<td>${d.label}</td><td>${score}</td><td>${why}</td>`;
    scoreTableBody.appendChild(tr);
  });
}

// توصیه‌های ۶ هفته‌ای
function buildRecs(topDomain, profile){
  const list=[];
  const week = (t)=>`تا ${t} روز`;
  const push=(title, why)=>list.push({title, why});
  if(topDomain==='tech'){
    push('پروژه عملی کوچک با داده واقعی', `یک دیتاست عمومی انتخاب کن، خروجی قابل نمایش GitHub ${week(10)}`);
    push('مدرک کوتاه‌مدت کاربردی', `یک میکرولِرنینگ ۱۵–۲۰ ساعته متناسب با هدف تو ${week(20)}`);
  } else if(topDomain==='market'){
    push('مصاحبه اکتشافی با ۱۰ کاربر', `یادگیری عمیق مسئله مشتری و ترسیم فرضیات PMF ${week(14)}`);
    push('MVP سبک‌وزن', `یک صفحه لندینگ + فرم علاقه‌مندی برای سنجش تقاضا ${week(28)}`);
  } else if(topDomain==='people'){
    push('شبکه‌سازی هدفمند ۲۰ تماس', `Warm intro از دوستان درجه دو LinkedIn ${week(21)}`);
    push('یک جلسه مشاوره معکوس', `از یک منتور بخواه روی مسیرت فیدبک دهد ${week(10)}`);
  } else if(topDomain==='ops'){
    push('پیاده‌سازی کانبان شخصی', `پیشبرد کار با WIP محدود + بازبینی هفتگی ${week(7)}`);
    push('اتوماسیون یک تسک تکراری', `صرفه‌جویی حداقل ۲ ساعت هفتگی با اسکریپت ساده ${week(21)}`);
  } else if(topDomain==='learn'){
    push('نقشه یادگیری ۸ هفته‌ای', `سرفصل‌های هفتگی + پروژه پایانی قابل ارائه ${week(7)}`);
    push('ثبت و به‌اشتراک‌گذاری یادگیری', `هر هفته یک یادداشت منتشر کن برای تثبیت و برند ${week(14)}`);
  } else if(topDomain==='brand'){
    push('راه‌اندازی ویترین آنلاین', `به‌روز کردن LinkedIn/GitHub/وب‌سایت و نمونه‌کار ${week(10)}`);
    push('سری محتوای ۴ بخشی', `یک موضوع محوری و انتشار منظم برای اعتبارسازی ${week(28)}`);
  }
  // تنظیم با ریسک
  if(profile.risk==='low') list.push({title:'خرده‌پیشرفت روزانه ۳۰ دقیقه',
    why:'تداوم کم‌ریسک اما پایدار؛ عادت‌سازی مهم‌تر از شدت است.'});
  if(profile.risk==='high') list.push({title:'فرضیه بزرگ با Pilot سریع',
    why:'یک آزمایش جسورانه اما کوتاه‌مدت برای کشف بازده نامتقارن.'});
  return list;
}

// ماتریس منابع
function renderMatrix(topDomain, profile){
  const easy = document.getElementById('mx-easy');
  const quick = document.getElementById('mx-quick');
  const deep = document.getElementById('mx-deep');
  const items = {
    tech:{
      easy:['مرور ۳ ریپوی برتر GitHub','حل 10 مسئله Leet ساده'],
      quick:['نمونه API کوچک با مستندات','دیپلوی یک سرویس کوچک'],
      deep:['دوره تخصصی 40 ساعته','ساخت پروژه پرتفوی با تست']
    },
    market:{
      easy:['تحلیل ۳ رقیب با جدول ساده','ساخت پرسشنامه ۸ سوالی'],
      quick:['صفحه لندینگ و A/B ساده','کمپین کوچک ایمیل 50 نفر'],
      deep:['Case Study کامل مشتری','Roadmap سه‌ماهه محصول']
    },
    people:{
      easy:['بهبود پروفایل LinkedIn','پیام شخصی‌سازی شده به 5 نفر'],
      quick:['حضور در یک رویداد هدفمند','جلسه coffee chat هفتگی'],
      deep:['ساخت گروه کوچینگ همتا','برنامه منتورینگ دوطرفه']
    },
    ops:{
      easy:['تمپلیت کانبان شخصی','چک‌لیست تحویل کار'],
      quick:['اتوماسیون گزارش هفتگی','تعریف SLA داخلی'],
      deep:['بازطراحی فرایند کلیدی','پیاده‌سازی OKR سه‌ماهه']
    },
    learn:{
      easy:['فلش‌کارت مفاهیم کلیدی','خلاصه‌نویسی یک مقاله'],
      quick:['مطالعه هدایت‌شده با دوست','مرور ویدئوهای منتخب'],
      deep:['پروژه پژوهشی کوچک','نگارش یادداشت فنی بلند']
    },
    brand:{
      easy:['رزومه یک‌صفحه‌ای به‌روز','پاک‌سازی حضور آنلاین'],
      quick:['سری 3 پست تخصصی','یک سخنرانی کوتاه ضبط‌شده'],
      deep:['وب‌سایت شخصی و نمونه‌کار','خبرنامه ماهانه']
    }
  }[topDomain] || {easy:[],quick:[],deep:[]};

  const cap = (arr)=>arr.map(x=>`<div>• ${x}</div>`).join('');
  easy.innerHTML = cap(items.easy);
  quick.innerHTML = cap(items.quick);
  deep.innerHTML = cap(items.deep);
}

// تحلیل آینده و پیشنهادها
function renderFutureAnalysis(profile, decisionKey, trendKeys, domainW){
  const box = document.getElementById('futureAnalysis');
  const horizon = profile.horizon;
  const riskTol = profile.risk;
  const topDomain = Object.entries(domainW).sort((a,b)=>b[1]-a[1])[0][0];
  const domainLabel = DOMAINS.find(d=>d.id===topDomain)?.label || '';

  const trendNames = trendKeys.map(id=>TRENDS.find(t=>t.id===id)?.name).filter(Boolean).join('، ') || '—';

  let html = `<p>با توجه به تصمیم «${decisionKey||'—'}» و افق ${horizon} ماهه، مسیر آینده‌ی تو بیشترین هم‌پوشانی را با حوزه‌ی <strong>${domainLabel}</strong> دارد. روندهای منتخب (${trendNames}) در این بازه بیشترین اثر را خواهند داشت.</p>`;

  const recs = [
    {
      text: 'سرمایه‌گذاری روی مهارت‌های مکمل حوزه غالب',
      reason: `بر اساس گزارش ${SOURCES.find(s=>s.domain===topDomain)?.name||'اندیشکده‌های معتبر'}، ترکیب مهارت‌های فعلی با مهارت‌های نوظهور این حوزه، بازدهی را تا ۳۰٪ افزایش می‌دهد.`
    },
    {
      text: 'ایجاد شبکه ارتباطی در بازارهای هدف',
      reason: `در سناریوهای با ریسک ${riskTol==='high'?'بالا':'متوسط/کم'}، شبکه‌سازی زودهنگام تاب‌آوری تصمیم را افزایش می‌دهد.`
    },
    {
      text: 'پایش شاخص‌های پیشرو',
      reason: `با رصد ماهانه شاخص‌های مرتبط با ترندهای انتخابی، امکان واکنش سریع به تغییرات فراهم می‌شود.`
    }
  ];

  recs.forEach(r=>{
    html += `<div class="rec">💡 ${r.text}<div class="reason">${r.reason}</div></div>`;
  });
  box.innerHTML = html;
}

// رندر KPI
function renderKPI(ctx){
  const {scores, feas, riskAdj, trendAlign} = ctx;
  const top = Object.entries(scores).sort((a,b)=>b[1]-a[1])[0];
  const topLabel = DOMAINS.find(d=>d.id===top[0])?.label || '—';
  kpiDomainEl.textContent = topLabel;
  kpiRiskEl.textContent = riskAdj<0.4?'پایین':(riskAdj<0.7?'متوسط':'بالا');
  kpiFeasBar.style.width = Math.round(feas*100)+'%';
  kpiTrendBar.style.width = Math.round(trendAlign*100)+'%';
  kpiTrendBar.className = trendAlign<0.33?'neutral':(trendAlign<0.66?'neutral':'');
}

// رویداد اصلی
function runAll(){
  statusEl.textContent='در حال محاسبه…';
  const ctx = computeScores();

  // هشدارها
  const warnings = buildAlerts(ctx);
  alertsEl.innerHTML = warnings.length
    ? warnings.map(w=>`<div class="alert ${w.lvl}">⚠️ ${w.text}</div>`).join('')
    : `<div class="alert">همه‌چیز باثبات به نظر می‌رسد؛ اجرای منظم را ادامه بده.</div>`;

  // جدول امتیاز
  renderScores(ctx.scores, ctx.mult, ctx.domainW, ctx.skillFit);

  // KPI
  renderKPI(ctx);

  // توصیه‌ها
  const topDomain = Object.entries(ctx.scores).sort((a,b)=>b[1]-a[1])[0][0];
  const list = buildRecs(topDomain, ctx.profile);
  recsEl.innerHTML = list.map(i=>`<div class="recItem"><strong>• ${i.title}</strong><div class="why">${i.why}</div></div>`).join('');

  // ماتریس
  renderMatrix(topDomain, ctx.profile);

  // تحلیل آینده
  renderFutureAnalysis(
    { horizon: Number(horizonEl.value), risk: riskEl.value },
    decisionEl.value,
    Array.from(selectedTrends),
    ctx.domainW
  );

  statusEl.textContent='آماده';
}

// تعاملات
document.getElementById('run').addEventListener('click', runAll);
[decisionEl, horizonEl, riskEl, skillsEl, hoursEl, budgetEl].forEach(el=>{
  el.addEventListener('change', ()=>{ /* محاسبه تنبل؛ فقط با دکمه محاسبه کامل می‌کنیم */ });
});
// محاسبه اولیه
runAll();
</script>
</body>
</html>
